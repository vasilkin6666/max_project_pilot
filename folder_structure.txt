# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–∫–∏: E:\GUAP\max_project_pilot

## –î–µ—Ä–µ–≤–æ –∫–∞—Ç–∞–ª–æ–≥–æ–≤

```
max_project_pilot/
  .env
  README.md
  app/
    __init__.py
    api/
      __init__.py
      miniapp.py
      notifications.py
      projects.py
      websocket.py
    bot/
      __init__.py
      handlers.py
    config.py
    db.py
    logger.py
    models.py
    services.py
    static/
    templates/
      miniapp.html
    utils.py
  main.py
  requirements.txt
  webapp/
    index.html
    js/
      api.js
```

## –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤

### .env

```txt```
BOT_TOKEN=f9LHodD0cOKTlb3nlkLwZ_zwBGlbLSE4nWjnbWoP6tvBs3HQbTMLAGyVR2aP8cfg37-NusW0KG_CdvMtxNN1
APP_HOST=https://your-domain.com
APP_PORT=8000
DATABASE_URL=sqlite+aiosqlite:///./data/db.sqlite3
WEBHOOK_PATH=/webhook

```

### README.md

```md```
# max_project_pilot
MAX Project Pilot

```

### main.py

```py```
import asyncio
import uvicorn
from app import app
from app.bot import run_bot
from app.config import settings
from app.models import Base
from app.db import engine

async def create_tables():
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)
    print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞: data/db.sqlite3")

async def main():
    # –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—ã
    await create_tables()

    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ –≤ —Ñ–æ–Ω–µ
    bot_task = asyncio.create_task(run_bot())

    # –ó–∞–ø—É—Å–∫–∞–µ–º API
    config = uvicorn.Config(
        app,
        host="0.0.0.0",
        port=settings.APP_PORT,
        reload=True,
        log_level="info"
    )
    server = uvicorn.Server(config)

    await asyncio.gather(
        server.serve(),
        bot_task,
        return_exceptions=True
    )

if __name__ == "__main__":
    asyncio.run(main())

```

### requirements.txt

```txt```
maxapi==0.9.7
fastapi==0.115.0
uvicorn[standard]==0.30.6
sqlalchemy==2.0.35
aiosqlite==0.20.0
pydantic==2.9.2
pydantic-settings==2.5.2
python-dotenv==1.0.1
jinja2==3.1.4
aiofiles==24.1.0
loguru==0.7.2

```

### app\__init__.py

```py```
from fastapi import FastAPI
from fastapi.staticfiles import StaticFiles
from fastapi.templating import Jinja2Templates
from fastapi.middleware.cors import CORSMiddleware
import os

app = FastAPI(title="MAX Project Pilot API", version="1.0.0")

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS –¥–ª—è –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —É–∫–∞–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–æ–º–µ–Ω
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
os.makedirs("app/static", exist_ok=True)
os.makedirs("app/templates", exist_ok=True)

# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏ —à–∞–±–ª–æ–Ω—ã
app.mount("/static", StaticFiles(directory="app/static"), name="static")
templates = Jinja2Templates(directory="app/templates")

# –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç—ã
from app.api.projects import router as projects_router
from app.api.notifications import router as notifications_router
from app.api.miniapp import router as miniapp_router

app.include_router(projects_router)
app.include_router(notifications_router)
app.include_router(miniapp_router)

@app.get("/")
async def root():
    return {"message": "MAX Project Pilot API", "status": "running"}

```

### app\config.py

```py```
from pydantic_settings import BaseSettings
from dotenv import load_dotenv

load_dotenv()

class Settings(BaseSettings):
    BOT_TOKEN: str
    APP_HOST: str = "http://localhost:8000"
    APP_PORT: int = 8000
    DATABASE_URL: str = "sqlite+aiosqlite:///./data/db.sqlite3"
    WEBHOOK_PATH: str = "/webhook"

    class Config:
        env_file = ".env"
        case_sensitive = False

    @property
    def WEBHOOK_URL(self) -> str:
        return f"{self.APP_HOST}{self.WEBHOOK_PATH}"

settings = Settings()

```

### app\db.py

```py```
import os
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine, async_sessionmaker
from sqlalchemy.orm import DeclarativeBase
from sqlalchemy.pool import StaticPool

os.makedirs("data", exist_ok=True)

engine = create_async_engine(
    "sqlite+aiosqlite:///./data/db.sqlite3",
    echo=False,
    future=True,
    poolclass=StaticPool,
    connect_args={"check_same_thread": False}
)

AsyncSessionLocal = async_sessionmaker(
    engine,
    class_=AsyncSession,
    expire_on_commit=False,
    autoflush=False,
    autocommit=False
)

class Base(DeclarativeBase):
    pass

# Dependency –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –ë–î
async def get_db():
    async with AsyncSessionLocal() as session:
        try:
            yield session
            await session.commit()
        except Exception:
            await session.rollback()
            raise
        finally:
            await session.close()

```

### app\logger.py

```py```
from loguru import logger
import sys
import os

os.makedirs("logs", exist_ok=True)

logger.remove()
logger.add(
    sys.stdout,
    level="INFO",
    format="<green>{time:HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> - <level>{message}</level>"
)
logger.add(
    "logs/app.log",
    rotation="10 MB",
    retention="7 days",
    level="DEBUG",
    format="{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {name}:{function}:{line} - {message}"
)

```

### app\models.py

```py```
from sqlalchemy import Column, Integer, String, Text, DateTime, ForeignKey, Boolean, Enum
from sqlalchemy.orm import relationship
from datetime import datetime
import enum
from app.db import Base

class NotificationType(enum.Enum):
    TASK_CREATED = "task_created"
    TASK_COMPLETED = "task_completed"
    TASK_ASSIGNED = "task_assigned"
    USER_JOINED = "user_joined"
    PROJECT_UPDATED = "project_updated"

class User(Base):
    __tablename__ = "users"

    id = Column(Integer, primary_key=True, index=True)
    max_id = Column(String(50), unique=True, nullable=False, index=True)
    full_name = Column(String(120), nullable=False)
    created_at = Column(DateTime, default=datetime.utcnow)

    projects = relationship("ProjectMember", back_populates="user", cascade="all, delete-orphan")
    assigned_tasks = relationship("TaskAssignee", back_populates="user", cascade="all, delete-orphan")
    notifications = relationship("Notification", back_populates="user", cascade="all, delete-orphan")

class Project(Base):
    __tablename__ = "projects"

    id = Column(Integer, primary_key=True, index=True)
    hash = Column(String(12), unique=True, nullable=False, index=True)
    title = Column(String(200), nullable=False)
    description = Column(Text)
    is_private = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    owner_id = Column(Integer, ForeignKey("users.id"), nullable=False)

    owner = relationship("User")
    members = relationship("ProjectMember", back_populates="project", cascade="all, delete-orphan")
    tasks = relationship("Task", back_populates="project", cascade="all, delete-orphan")
    notifications = relationship("Notification", back_populates="project", cascade="all, delete-orphan")

class ProjectMember(Base):
    __tablename__ = "project_members"

    id = Column(Integer, primary_key=True, index=True)
    project_id = Column(Integer, ForeignKey("projects.id"), nullable=False)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    role = Column(String(20), default="member")
    joined_at = Column(DateTime, default=datetime.utcnow)
    notifications_enabled = Column(Boolean, default=True)

    project = relationship("Project", back_populates="members")
    user = relationship("User", back_populates="projects")

class Task(Base):
    __tablename__ = "tasks"

    id = Column(Integer, primary_key=True, index=True)
    project_id = Column(Integer, ForeignKey("projects.id"), nullable=False)
    title = Column(String(300), nullable=False)
    description = Column(Text)
    priority = Column(String(10), default="medium")
    due_date = Column(DateTime, nullable=True)
    status = Column(String(20), default="todo")
    created_at = Column(DateTime, default=datetime.utcnow)
    completed_at = Column(DateTime, nullable=True)

    project = relationship("Project", back_populates="tasks")
    assignees = relationship("TaskAssignee", back_populates="task", cascade="all, delete-orphan")

class TaskAssignee(Base):
    __tablename__ = "task_assignees"

    id = Column(Integer, primary_key=True, index=True)
    task_id = Column(Integer, ForeignKey("tasks.id"), nullable=False)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)

    task = relationship("Task", back_populates="assignees")
    user = relationship("User", back_populates="assigned_tasks")

class Notification(Base):
    __tablename__ = "notifications"

    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    project_id = Column(Integer, ForeignKey("projects.id"), nullable=False)
    type = Column(Enum(NotificationType), nullable=False)
    title = Column(String(200), nullable=False)
    message = Column(Text, nullable=False)
    is_read = Column(Boolean, default=False)
    created_at = Column(DateTime, default=datetime.utcnow)
    data = Column(Text)  # JSON —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

    user = relationship("User", back_populates="notifications")
    project = relationship("Project", back_populates="notifications")

```

### app\services.py

```py```
from sqlalchemy import select, update, and_
from sqlalchemy.orm import selectinload
from app.db import AsyncSessionLocal
from app.models import User, Project, ProjectMember, Task, TaskAssignee, Notification, NotificationType
from app.utils import generate_hash
from datetime import datetime
import json

# –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨
async def get_or_create_user(max_id: str, full_name: str) -> User:
    async with AsyncSessionLocal() as db:
        result = await db.execute(
            select(User).where(User.max_id == max_id)
        )
        user = result.scalar_one_or_none()

        if not user:
            user = User(max_id=max_id, full_name=full_name or "–ê–Ω–æ–Ω–∏–º")
            db.add(user)
            await db.commit()
            await db.refresh(user)

        return user

# –°–û–ó–î–ê–¢–¨ –ü–†–û–ï–ö–¢
async def create_project(owner: User, title: str, description: str = "", is_private: bool = True) -> Project:
    async with AsyncSessionLocal() as db:
        project = Project(
            hash=generate_hash(),
            title=title,
            description=description,
            is_private=is_private,
            owner_id=owner.id
        )
        db.add(project)
        await db.flush()

        # –î–æ–±–∞–≤–ª—è–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–∞–∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞
        member = ProjectMember(project_id=project.id, user_id=owner.id, role="owner")
        db.add(member)

        await db.commit()
        await db.refresh(project)
        return project

# –°–û–ó–î–ê–¢–¨ –ó–ê–î–ê–ß–£
async def create_task(project_id: int, title: str, description: str = "", priority: str = "medium", due_date: datetime = None):
    async with AsyncSessionLocal() as db:
        task = Task(
            project_id=project_id,
            title=title,
            description=description,
            priority=priority,
            due_date=due_date
        )
        db.add(task)
        await db.commit()
        await db.refresh(task)
        return task

# –ü–†–û–ï–ö–¢–´ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
async def get_user_projects(user_id: int):
    async with AsyncSessionLocal() as db:
        result = await db.execute(
            select(ProjectMember)
            .where(ProjectMember.user_id == user_id)
            .options(
                selectinload(ProjectMember.project).selectinload(Project.members),
                selectinload(ProjectMember.project).selectinload(Project.tasks)
            )
        )
        members = result.scalars().all()
        return members

# –ü–†–û–ï–ö–¢ –ü–û –•–≠–®–£
async def get_project_by_hash(hash_: str):
    async with AsyncSessionLocal() as db:
        result = await db.execute(
            select(Project)
            .where(Project.hash == hash_)
            .options(
                selectinload(Project.members).selectinload(ProjectMember.user),
                selectinload(Project.tasks).selectinload(Task.assignees).selectinload(TaskAssignee.user)
            )
        )
        return result.scalar_one_or_none()

# –£–ß–ê–°–¢–ù–ò–ö–ò –ü–†–û–ï–ö–¢–ê
async def get_project_members(project_id: int):
    async with AsyncSessionLocal() as db:
        result = await db.execute(
            select(ProjectMember)
            .where(ProjectMember.project_id == project_id)
            .options(selectinload(ProjectMember.user))
        )
        return result.scalars().all()

# –ó–ê–î–ê–ß–ò –ü–†–û–ï–ö–¢–ê
async def get_project_tasks(project_id: int):
    async with AsyncSessionLocal() as db:
        result = await db.execute(
            select(Task)
            .where(Task.project_id == project_id)
            .options(selectinload(Task.assignees).selectinload(TaskAssignee.user))
        )
        return result.scalars().all()

# –î–û–ë–ê–í–ò–¢–¨ –£–ß–ê–°–¢–ù–ò–ö–ê –í –ü–†–û–ï–ö–¢
async def add_user_to_project(user_id: int, project_id: int, role: str = "member"):
    async with AsyncSessionLocal() as db:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–º
        result = await db.execute(
            select(ProjectMember)
            .where(and_(
                ProjectMember.project_id == project_id,
                ProjectMember.user_id == user_id
            ))
        )
        existing_member = result.scalar_one_or_none()

        if existing_member:
            return existing_member

        member = ProjectMember(project_id=project_id, user_id=user_id, role=role)
        db.add(member)
        await db.commit()
        await db.refresh(member)
        return member

# –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
async def create_notification(user_id: int, project_id: int, type: NotificationType, title: str, message: str, data: dict = None):
    async with AsyncSessionLocal() as db:
        notification = Notification(
            user_id=user_id,
            project_id=project_id,
            type=type,
            title=title,
            message=message,
            data=json.dumps(data) if data else None
        )
        db.add(notification)
        await db.commit()
        await db.refresh(notification)
        return notification

async def get_user_notifications(user_id: int, limit: int = 10):
    async with AsyncSessionLocal() as db:
        result = await db.execute(
            select(Notification)
            .where(Notification.user_id == user_id)
            .options(selectinload(Notification.project))
            .order_by(Notification.created_at.desc())
            .limit(limit)
        )
        return result.scalars().all()

async def mark_notification_as_read(notification_id: int):
    async with AsyncSessionLocal() as db:
        await db.execute(
            update(Notification)
            .where(Notification.id == notification_id)
            .values(is_read=True)
        )
        await db.commit()

async def mark_all_notifications_as_read(user_id: int):
    async with AsyncSessionLocal() as db:
        await db.execute(
            update(Notification)
            .where(Notification.user_id == user_id)
            .values(is_read=True)
        )
        await db.commit()

# –°–ò–°–¢–ï–ú–ù–´–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
async def notify_task_completed(task_id: int, completed_by_user_id: int):
    """–°–æ–∑–¥–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞"""
    async with AsyncSessionLocal() as db:
        # –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–∞—á—É –∏ –ø—Ä–æ–µ–∫—Ç
        result = await db.execute(
            select(Task)
            .where(Task.id == task_id)
            .options(selectinload(Task.project).selectinload(Project.members))
        )
        task = result.scalar_one_or_none()

        if not task:
            return

        # –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–≤–µ—Ä—à–∏–ª –∑–∞–¥–∞—á—É
        user_result = await db.execute(
            select(User).where(User.id == completed_by_user_id)
        )
        completed_by_user = user_result.scalar_one_or_none()

        # –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
        for member in task.project.members:
            if member.notifications_enabled and member.user_id != completed_by_user_id:
                await create_notification(
                    user_id=member.user_id,
                    project_id=task.project_id,
                    type=NotificationType.TASK_COMPLETED,
                    title="‚úÖ –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞",
                    message=f"{completed_by_user.full_name} –≤—ã–ø–æ–ª–Ω–∏–ª(–∞) –∑–∞–¥–∞—á—É ¬´{task.title}¬ª –≤ –ø—Ä–æ–µ–∫—Ç–µ ¬´{task.project.title}¬ª",
                    data={"task_id": task_id, "completed_by_user_id": completed_by_user_id}
                )

async def notify_task_assigned(task_id: int, assigned_to_user_id: int):
    """–°–æ–∑–¥–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏"""
    async with AsyncSessionLocal() as db:
        # –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–∞—á—É
        result = await db.execute(
            select(Task)
            .where(Task.id == task_id)
            .options(selectinload(Task.project))
        )
        task = result.scalar_one_or_none()

        if not task:
            return

        # –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await create_notification(
            user_id=assigned_to_user_id,
            project_id=task.project_id,
            type=NotificationType.TASK_ASSIGNED,
            title="üéØ –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞",
            message=f"–í–∞–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –∑–∞–¥–∞—á–∞ ¬´{task.title}¬ª –≤ –ø—Ä–æ–µ–∫—Ç–µ ¬´{task.project.title}¬ª",
            data={"task_id": task_id}
        )

async def notify_user_joined(project_id: int, joined_user_id: int):
    """–°–æ–∑–¥–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ–º —É—á–∞—Å—Ç–Ω–∏–∫–µ –ø—Ä–æ–µ–∫—Ç–∞"""
    async with AsyncSessionLocal() as db:
        # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–µ–∫—Ç –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        project_result = await db.execute(
            select(Project)
            .where(Project.id == project_id)
            .options(selectinload(Project.members))
        )
        project = project_result.scalar_one_or_none()

        user_result = await db.execute(select(User).where(User.id == joined_user_id))
        joined_user = user_result.scalar_one_or_none()

        if not project or not joined_user:
            return

        # –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ (–∫—Ä–æ–º–µ –Ω–æ–≤–æ–≥–æ)
        for member in project.members:
            if member.notifications_enabled and member.user_id != joined_user_id:
                await create_notification(
                    user_id=member.user_id,
                    project_id=project_id,
                    type=NotificationType.USER_JOINED,
                    title="üë• –ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫",
                    message=f"{joined_user.full_name} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è(–∞—Å—å) –∫ –ø—Ä–æ–µ–∫—Ç—É ¬´{project.title}¬ª",
                    data={"joined_user_id": joined_user_id}
                )

# –ù–ê–°–¢–†–û–ô–ö–ò –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
async def toggle_user_notifications(user_id: int, project_id: int, enabled: bool):
    async with AsyncSessionLocal() as db:
        await db.execute(
            update(ProjectMember)
            .where(and_(
                ProjectMember.user_id == user_id,
                ProjectMember.project_id == project_id
            ))
            .values(notifications_enabled=enabled)
        )
        await db.commit()

async def get_notification_settings(user_id: int, project_id: int):
    async with AsyncSessionLocal() as db:
        result = await db.execute(
            select(ProjectMember)
            .where(and_(
                ProjectMember.user_id == user_id,
                ProjectMember.project_id == project_id
            ))
        )
        member = result.scalar_one_or_none()
        return member.notifications_enabled if member else True

```

### app\utils.py

```py```
import secrets
import string
from datetime import datetime, timedelta

def generate_hash(length: int = 12) -> str:
    alphabet = string.ascii_letters + string.digits
    return ''.join(secrets.choice(alphabet) for _ in range(length))

def format_date(dt: datetime | None) -> str:
    if not dt:
        return "‚Äî"
    return dt.strftime("%d.%m.%Y %H:%M")

def is_overdue(due: datetime | None) -> bool:
    return due and due < datetime.utcnow()

def format_project_info(project) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–µ–∫—Ç–µ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è"""
    members_count = len(project.members) if project.members else 0
    tasks_count = len(project.tasks) if project.tasks else 0

    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–¥–∞—á–∞–º
    tasks_todo = len([t for t in (project.tasks or []) if t.status == "todo"])
    tasks_in_progress = len([t for t in (project.tasks or []) if t.status == "in_progress"])
    tasks_done = len([t for t in (project.tasks or []) if t.status == "done"])

    return (
        f"üöÄ **{project.title}**\n\n"
        f"{project.description or 'üìù –ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}\n\n"
        f"üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**\n"
        f"‚Ä¢ üë• –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: {members_count}\n"
        f"‚Ä¢ üìã –í—Å–µ–≥–æ –∑–∞–¥–∞—á: {tasks_count}\n"
        f"‚Ä¢ ‚è≥ –ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é: {tasks_todo}\n"
        f"‚Ä¢ üîß –í —Ä–∞–±–æ—Ç–µ: {tasks_in_progress}\n"
        f"‚Ä¢ ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: {tasks_done}\n"
        f"üîê {'üîí –ü—Ä–∏–≤–∞—Ç–Ω—ã–π' if project.is_private else 'üåê –ü—É–±–ª–∏—á–Ω—ã–π'}\n"
        f"üìÖ –°–æ–∑–¥–∞–Ω: {format_date(project.created_at)}\n"
        f"üîó –•—ç—à: `{project.hash}`"
    )

def format_project_preview(project, index: int = None) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–µ–∫—Ç–µ –¥–ª—è —Å–ø–∏—Å–∫–∞"""
    members_count = len(project.members) if project.members else 0
    tasks_count = len(project.tasks) if project.tasks else 0
    tasks_done = len([t for t in (project.tasks or []) if t.status == "done"])

    prefix = f"{index}. " if index is not None else ""

    return (
        f"{prefix}**{project.title}**\n"
        f"   üìã {tasks_count} –∑–∞–¥–∞—á ({tasks_done} ‚úÖ) | üë• {members_count} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n"
        f"   {project.description[:50] + '...' if project.description and len(project.description) > 50 else project.description or 'üìù –ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}"
    )

def escape_markdown(text: str) -> str:
    """–≠–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —Å–∏–º–≤–æ–ª—ã Markdown"""
    escape_chars = r'_*[]()~`>#+-=|{}.!'
    return ''.join(f'\\{char}' if char in escape_chars else char for char in text)

```

### app\api\__init__.py

```py```
from fastapi import APIRouter

router = APIRouter(prefix="/api", tags=["api"])

@router.get("/")
async def api_root():
    return {"message": "MAX Project Pilot API", "version": "1.0.0"}

```

### app\api\miniapp.py

```py```
from fastapi import APIRouter, HTTPException, Depends
from sqlalchemy.ext.asyncio import AsyncSession
from app.db import get_db
from app.services import (
    get_or_create_user,
    get_user_projects,
    create_project,
    get_project_by_hash,
    create_task,
    get_project_tasks,
    add_user_to_project,
    notify_task_completed,
    notify_task_assigned
)
from app.models import Task, Project
from pydantic import BaseModel
from datetime import datetime

router = APIRouter(prefix="/api/miniapp", tags=["miniapp"])

# –ú–æ–¥–µ–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
class CreateProjectRequest(BaseModel):
    title: str
    description: str = ""
    is_private: bool = True

class CreateTaskRequest(BaseModel):
    project_hash: str
    title: str
    description: str = ""
    priority: str = "medium"
    due_date: datetime = None

class CompleteTaskRequest(BaseModel):
    task_id: int

# –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–µ–∫—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
@router.get("/user/{max_id}/projects")
async def get_user_projects_api(max_id: str, db: AsyncSession = Depends(get_db)):
    user = await get_or_create_user(max_id, "MiniApp User")
    projects_data = await get_user_projects(user.id)

    return {
        "user": {
            "id": user.id,
            "max_id": user.max_id,
            "full_name": user.full_name
        },
        "projects": [
            {
                "id": member.project.id,
                "hash": member.project.hash,
                "title": member.project.title,
                "description": member.project.description,
                "is_private": member.project.is_private,
                "created_at": member.project.created_at.isoformat(),
                "role": member.role,
                "stats": {
                    "members_count": len(member.project.members),
                    "tasks_count": len(member.project.tasks),
                    "tasks_todo": len([t for t in member.project.tasks if t.status == "todo"]),
                    "tasks_in_progress": len([t for t in member.project.tasks if t.status == "in_progress"]),
                    "tasks_done": len([t for t in member.project.tasks if t.status == "done"])
                }
            }
            for member in projects_data
        ]
    }

# –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
@router.post("/user/{max_id}/projects")
async def create_project_api(
    max_id: str,
    request: CreateProjectRequest,
    db: AsyncSession = Depends(get_db)
):
    user = await get_or_create_user(max_id, "MiniApp User")
    project = await create_project(
        user,
        request.title,
        request.description,
        request.is_private
    )

    return {
        "status": "success",
        "project": {
            "id": project.id,
            "hash": project.hash,
            "title": project.title,
            "description": project.description,
            "is_private": project.is_private,
            "created_at": project.created_at.isoformat()
        }
    }

# –ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏ –ø—Ä–æ–µ–∫—Ç–∞
@router.get("/projects/{project_hash}/tasks")
async def get_project_tasks_api(project_hash: str, db: AsyncSession = Depends(get_db)):
    project = await get_project_by_hash(project_hash)
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    tasks = await get_project_tasks(project.id)

    return {
        "project": {
            "id": project.id,
            "title": project.title,
            "hash": project.hash
        },
        "tasks": [
            {
                "id": task.id,
                "title": task.title,
                "description": task.description,
                "priority": task.priority,
                "status": task.status,
                "due_date": task.due_date.isoformat() if task.due_date else None,
                "created_at": task.created_at.isoformat(),
                "assignees": [
                    {
                        "user_id": assignee.user.id,
                        "max_id": assignee.user.max_id,
                        "full_name": assignee.user.full_name
                    }
                    for assignee in task.assignees
                ]
            }
            for task in tasks
        ]
    }

# –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
@router.post("/tasks")
async def create_task_api(request: CreateTaskRequest, db: AsyncSession = Depends(get_db)):
    project = await get_project_by_hash(request.project_hash)
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    task = await create_task(
        project.id,
        request.title,
        request.description,
        request.priority,
        request.due_date
    )

    return {
        "status": "success",
        "task": {
            "id": task.id,
            "title": task.title,
            "description": task.description,
            "priority": task.priority,
            "status": task.status,
            "project_hash": request.project_hash
        }
    }

# –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É
@router.post("/tasks/{task_id}/complete")
async def complete_task_api(
    task_id: int,
    request: CompleteTaskRequest,
    db: AsyncSession = Depends(get_db)
):
    # –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
    # –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—Ö
    return {
        "status": "success",
        "message": f"Task {task_id} completed",
        "task_id": task_id
    }

# –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ–µ–∫—Ç
@router.post("/projects/{project_hash}/invite/{max_id}")
async def invite_to_project_api(
    project_hash: str,
    max_id: str,
    db: AsyncSession = Depends(get_db)
):
    project = await get_project_by_hash(project_hash)
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    user = await get_or_create_user(max_id, "Invited User")
    member = await add_user_to_project(user.id, project.id)

    return {
        "status": "success",
        "message": f"User {max_id} added to project",
        "project": project.title,
        "role": member.role
    }

```

### app\api\notifications.py

```py```
from fastapi import APIRouter, HTTPException, Depends
from sqlalchemy.ext.asyncio import AsyncSession
from app.db import get_db
from app.services import (
    notify_task_completed,
    notify_task_assigned,
    notify_user_joined,
    get_project_by_hash
)

router = APIRouter(prefix="/api/notifications", tags=["notifications"])

@router.post("/task_completed")
async def api_task_completed(
    task_id: int,
    completed_by_user_id: int,
    db: AsyncSession = Depends(get_db)
):
    """API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏"""
    await notify_task_completed(task_id, completed_by_user_id)
    return {"status": "success", "message": "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã"}

@router.post("/task_assigned")
async def api_task_assigned(
    task_id: int,
    assigned_to_user_id: int,
    db: AsyncSession = Depends(get_db)
):
    """API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏"""
    await notify_task_assigned(task_id, assigned_to_user_id)
    return {"status": "success", "message": "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ"}

@router.post("/user_joined")
async def api_user_joined(
    project_id: int,
    joined_user_id: int,
    db: AsyncSession = Depends(get_db)
):
    """API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤–æ–º —É—á–∞—Å—Ç–Ω–∏–∫–µ"""
    await notify_user_joined(project_id, joined_user_id)
    return {"status": "success", "message": "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã"}

```

### app\api\projects.py

```py```
from fastapi import APIRouter, HTTPException, Depends
from sqlalchemy.ext.asyncio import AsyncSession
from app.db import get_db
from app.services import get_project_by_hash, get_project_tasks, get_project_members

router = APIRouter(prefix="/api/projects", tags=["projects"])

@router.get("/health")
async def health():
    return {"status": "ok", "service": "MAX Project Pilot", "version": "1.0.0"}

@router.get("/{project_hash}/tasks")
async def get_project_tasks_api(project_hash: str, db: AsyncSession = Depends(get_db)):
    project = await get_project_by_hash(project_hash)
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    tasks = await get_project_tasks(project.id)
    return {
        "project": {
            "id": project.id,
            "title": project.title,
            "hash": project.hash
        },
        "tasks": [
            {
                "id": task.id,
                "title": task.title,
                "description": task.description,
                "priority": task.priority,
                "status": task.status,
                "due_date": task.due_date.isoformat() if task.due_date else None,
                "created_at": task.created_at.isoformat(),
                "assignees": [
                    {
                        "user_id": assignee.user.id,
                        "full_name": assignee.user.full_name
                    }
                    for assignee in task.assignees
                ]
            }
            for task in tasks
        ]
    }

@router.get("/{project_hash}/members")
async def get_project_members_api(project_hash: str, db: AsyncSession = Depends(get_db)):
    project = await get_project_by_hash(project_hash)
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    members = await get_project_members(project.id)
    return {
        "project": {
            "id": project.id,
            "title": project.title,
            "hash": project.hash
        },
        "members": [
            {
                "user_id": member.user.id,
                "max_id": member.user.max_id,
                "full_name": member.user.full_name,
                "role": member.role,
                "joined_at": member.joined_at.isoformat()
            }
            for member in members
        ]
    }

@router.get("/{project_hash}/info")
async def get_project_info(project_hash: str, db: AsyncSession = Depends(get_db)):
    project = await get_project_by_hash(project_hash)
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    tasks = await get_project_tasks(project.id)
    members = await get_project_members(project.id)

    return {
        "project": {
            "id": project.id,
            "title": project.title,
            "description": project.description,
            "hash": project.hash,
            "is_private": project.is_private,
            "created_at": project.created_at.isoformat(),
            "owner_id": project.owner_id
        },
        "stats": {
            "tasks_total": len(tasks),
            "tasks_todo": len([t for t in tasks if t.status == "todo"]),
            "tasks_in_progress": len([t for t in tasks if t.status == "in_progress"]),
            "tasks_done": len([t for t in tasks if t.status == "done"]),
            "members_count": len(members)
        }
    }

```

### app\api\websocket.py

```py```
# app/api/websocket.py
from fastapi import WebSocket, WebSocketDisconnect

class ConnectionManager:
    def __init__(self):
        self.active_connections: dict[str, WebSocket] = {}

    async def connect(self, websocket: WebSocket, user_id: str):
        await websocket.accept()
        self.active_connections[user_id] = websocket

    def disconnect(self, user_id: str):
        if user_id in self.active_connections:
            del self.active_connections[user_id]

    async def send_personal_message(self, message: str, user_id: str):
        if user_id in self.active_connections:
            await self.active_connections[user_id].send_text(message)

manager = ConnectionManager()

```

### app\bot\__init__.py

```py```
from maxapi import Bot
from app.config import settings
from app.bot.handlers import dp
import asyncio
import logging

logger = logging.getLogger(__name__)

bot = Bot(token=settings.BOT_TOKEN)

async def run_bot():
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ Long Polling"""
    try:
        logger.info("üöÄ –ó–∞–ø—É—Å–∫ MAX Project Pilot –±–æ—Ç–∞...")
        # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä drop_pending_updates - –µ–≥–æ –Ω–µ—Ç –≤ maxapi
        await bot.delete_webhook()
        logger.info("‚úÖ –í–µ–±—Ö—É–∫ —É–¥–∞–ª–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª–ª–∏–Ω–≥...")
        await dp.start_polling(bot)
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: {e}")
        raise

```

### app\bot\handlers.py

```py```
import logging
from maxapi import Dispatcher, F
from maxapi.filters.command import Command
from maxapi.filters.callback_payload import CallbackPayload
from maxapi.types import MessageCreated, MessageCallback, CallbackButton
from maxapi.utils.inline_keyboard import InlineKeyboardBuilder
from app.services import (
    get_or_create_user,
    get_user_notifications,
    mark_notification_as_read,
    mark_all_notifications_as_read,
    get_user_projects,
    toggle_user_notifications,
    get_notification_settings
)
from app.models import NotificationType

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

dp = Dispatcher()

class Action(CallbackPayload, prefix="mpp"):
    action: str
    data: str = ""

# –°–¢–ê–†–¢ - —Ç–æ–ª—å–∫–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
@dp.message_created(Command('start'))
async def cmd_start(event: MessageCreated):
    try:
        user = await get_or_create_user(str(event.from_user.user_id), event.from_user.full_name or "–ê–Ω–æ–Ω–∏–º")

        kb = InlineKeyboardBuilder()
        kb.row(
            CallbackButton(text="üîî –ú–æ–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", payload=Action(action="notifications").pack()),
            CallbackButton(text="‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏", payload=Action(action="settings").pack())
        )
        kb.row(
            CallbackButton(text="üìã –ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã", payload=Action(action="projects").pack())
        )

        await event.message.answer(
            text=f"üëã –ü—Ä–∏–≤–µ—Ç, {user.full_name}!\n\n"
                 "üîî **MAX Project Pilot - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**\n\n"
                 "–Ø –±—É–¥—É –ø—Ä–∏—Å—ã–ª–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ:\n"
                 "‚Ä¢ ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö\n"
                 "‚Ä¢ üéØ –ù–æ–≤—ã—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è—Ö\n"
                 "‚Ä¢ üë• –ù–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–∞—Ö\n"
                 "‚Ä¢ üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö\n\n"
                 "–í–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏!",
            attachments=[kb.as_markup()]
        )
    except Exception as e:
        logger.error(f"Start error: {e}")
        await event.message.answer("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.")

# –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
@dp.message_callback(Action.filter(F.action == "notifications"))
async def show_notifications(event: MessageCallback, payload: Action):
    try:
        user = await get_or_create_user(str(event.from_user.user_id), event.from_user.full_name or "–ê–Ω–æ–Ω–∏–º")
        notifications = await get_user_notifications(user.id, limit=10)

        kb = InlineKeyboardBuilder()

        if not notifications:
            text = "üì≠ –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n\n–ù–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å, –∫–æ–≥–¥–∞ –≤ –≤–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö —á—Ç–æ-—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç!"
        else:
            text = "üîî **–ü–æ—Å–ª–µ–¥–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**\n\n"
            unread_count = 0

            for i, notification in enumerate(notifications[:5], 1):
                emoji = "üîµ" if not notification.is_read else "‚ö™"
                if not notification.is_read:
                    unread_count += 1

                text += f"{emoji} **{notification.title}**\n"
                text += f"   {notification.message}\n"
                text += f"   üìÖ {notification.created_at.strftime('%d.%m %H:%M')}\n\n"

            if unread_count > 0:
                kb.row(CallbackButton(
                    text="‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ",
                    payload=Action(action="mark_all_read").pack()
                ))

            if len(notifications) > 5:
                text += f"... –∏ –µ—â—ë {len(notifications) - 5} —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"

        kb.row(CallbackButton(text="üîÑ –û–±–Ω–æ–≤–∏—Ç—å", payload=Action(action="notifications").pack()))
        kb.row(CallbackButton(text="üè† –î–æ–º–æ–π", payload=Action(action="start").pack()))

        await event.bot.edit_message(
            message_id=event.message.body.mid,
            text=text,
            attachments=[kb.as_markup()]
        )

    except Exception as e:
        logger.error(f"Notifications error: {e}")
        await event.answer(notification="‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π")

# –û–¢–ú–ï–¢–ò–¢–¨ –í–°–ï –ö–ê–ö –ü–†–û–ß–ò–¢–ê–ù–ù–´–ï
@dp.message_callback(Action.filter(F.action == "mark_all_read"))
async def mark_all_read(event: MessageCallback, payload: Action):
    try:
        user = await get_or_create_user(str(event.from_user.user_id), event.from_user.full_name or "–ê–Ω–æ–Ω–∏–º")
        await mark_all_notifications_as_read(user.id)

        await event.answer(notification="‚úÖ –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ")
        await show_notifications(event, payload)  # –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫

    except Exception as e:
        logger.error(f"Mark all read error: {e}")
        await event.answer(notification="‚ùå –û—à–∏–±–∫–∞")

# –ù–ê–°–¢–†–û–ô–ö–ò –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
@dp.message_callback(Action.filter(F.action == "settings"))
async def show_settings(event: MessageCallback, payload: Action):
    try:
        user = await get_or_create_user(str(event.from_user.user_id), event.from_user.full_name or "–ê–Ω–æ–Ω–∏–º")
        projects = await get_user_projects(user.id)

        kb = InlineKeyboardBuilder()

        if not projects:
            text = "‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**\n\n–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."
        else:
            text = "‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**\n\n–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:\n\n"

            for i, member in enumerate(projects[:8], 1):
                project = member.project
                is_enabled = await get_notification_settings(user.id, project.id)
                status = "üîî" if is_enabled else "üîï"
                text += f"{i}. {status} {project.title}\n"

                # –ö–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
                kb.add(CallbackButton(
                    text=f"{i}",
                    payload=Action(action="project_settings", data=project.hash).pack()
                ))

        kb.row(CallbackButton(text="üè† –î–æ–º–æ–π", payload=Action(action="start").pack()))

        await event.bot.edit_message(
            message_id=event.message.body.mid,
            text=text,
            attachments=[kb.as_markup()]
        )

    except Exception as e:
        logger.error(f"Settings error: {e}")
        await event.answer(notification="‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫")

# –ù–ê–°–¢–†–û–ô–ö–ò –ö–û–ù–ö–†–ï–¢–ù–û–ì–û –ü–†–û–ï–ö–¢–ê
@dp.message_callback(Action.filter(F.action == "project_settings"))
async def project_settings(event: MessageCallback, payload: Action):
    try:
        user = await get_or_create_user(str(event.from_user.user_id), event.from_user.full_name or "–ê–Ω–æ–Ω–∏–º")
        project = await get_project_by_hash(payload.data)

        if not project:
            await event.answer(notification="‚ùå –ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return

        current_setting = await get_notification_settings(user.id, project.id)

        kb = InlineKeyboardBuilder()

        if current_setting:
            kb.row(CallbackButton(
                text="üîï –û—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
                payload=Action(action="toggle_notifications", data=f"{project.hash}:false").pack()
            ))
            status_text = "üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã"
        else:
            kb.row(CallbackButton(
                text="üîî –í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
                payload=Action(action="toggle_notifications", data=f"{project.hash}:true").pack()
            ))
            status_text = "üîï –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã"

        kb.row(CallbackButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", payload=Action(action="settings").pack()))
        kb.row(CallbackButton(text="üè† –î–æ–º–æ–π", payload=Action(action="start").pack()))

        text = f"‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**\n\n"
        text += f"**–ü—Ä–æ–µ–∫—Ç:** {project.title}\n"
        text += f"**–°—Ç–∞—Ç—É—Å:** {status_text}\n\n"
        text += "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–∞—é—Ç:\n"
        text += "‚Ä¢ ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á\n"
        text += "‚Ä¢ üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–¥–∞—á\n"
        text += "‚Ä¢ üë• –ù–æ–≤—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏\n"
        text += "‚Ä¢ üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ"

        await event.bot.edit_message(
            message_id=event.message.body.mid,
            text=text,
            attachments=[kb.as_markup()]
        )

    except Exception as e:
        logger.error(f"Project settings error: {e}")
        await event.answer(notification="‚ùå –û—à–∏–±–∫–∞")

# –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
@dp.message_callback(Action.filter(F.action == "toggle_notifications"))
async def toggle_notifications(event: MessageCallback, payload: Action):
    try:
        project_hash, enabled_str = payload.data.split(":")
        enabled = enabled_str.lower() == "true"

        user = await get_or_create_user(str(event.from_user.user_id), event.from_user.full_name or "–ê–Ω–æ–Ω–∏–º")
        project = await get_project_by_hash(project_hash)

        if not project:
            await event.answer(notification="‚ùå –ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return

        await toggle_user_notifications(user.id, project.id, enabled)

        status = "–≤–∫–ª—é—á–µ–Ω—ã" if enabled else "–æ—Ç–∫–ª—é—á–µ–Ω—ã"
        await event.answer(notification=f"‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è {status} –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ ¬´{project.title}¬ª")

        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø—Ä–æ–µ–∫—Ç–∞
        await project_settings(event, Action(action="project_settings", data=project_hash))

    except Exception as e:
        logger.error(f"Toggle notifications error: {e}")
        await event.answer(notification="‚ùå –û—à–∏–±–∫–∞")

# –°–ü–ò–°–û–ö –ü–†–û–ï–ö–¢–û–í (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä)
@dp.message_callback(Action.filter(F.action == "projects"))
async def show_projects(event: MessageCallback, payload: Action):
    try:
        user = await get_or_create_user(str(event.from_user.user_id), event.from_user.full_name or "–ê–Ω–æ–Ω–∏–º")
        projects = await get_user_projects(user.id)

        kb = InlineKeyboardBuilder()

        if not projects:
            text = "üìÇ **–ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã**\n\n–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤.\n\n–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!"
        else:
            text = "üìÇ **–ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã**\n\n"
            for i, member in enumerate(projects[:10], 1):
                project = member.project
                members_count = len(project.members) if project.members else 0
                tasks_count = len(project.tasks) if project.tasks else 0

                text += f"{i}. **{project.title}**\n"
                text += f"   üë• {members_count} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ | üìã {tasks_count} –∑–∞–¥–∞—á\n"
                text += f"   üîó –•—ç—à: `{project.hash}`\n\n"

        kb.row(CallbackButton(text="üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", payload=Action(action="notifications").pack()))
        kb.row(CallbackButton(text="üè† –î–æ–º–æ–π", payload=Action(action="start").pack()))

        await event.bot.edit_message(
            message_id=event.message.body.mid,
            text=text,
            attachments=[kb.as_markup()]
        )

    except Exception as e:
        logger.error(f"Projects error: {e}")
        await event.answer(notification="‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤")

# –û–ë–†–ê–ë–û–¢–ö–ê –¢–ï–ö–°–¢–û–í–´–• –°–û–û–ë–©–ï–ù–ò–ô
@dp.message_created(F.message.body.text.len() > 0)
async def handle_text_messages(event: MessageCreated):
    text = event.message.body.text.strip()

    # –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ö—ç—à –ø—Ä–æ–µ–∫—Ç–∞ (12 —Å–∏–º–≤–æ–ª–æ–≤)
    if len(text) == 12 and text.isalnum():
        await event.message.answer(
            "üîó –î–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –ø—Ä–æ–µ–∫—Ç–∞–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.\n\n"
            "–í –±–æ—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö –≤ –≤–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö!"
        )
    else:
        await event.message.answer(
            "ü§ñ –Ø –±–æ—Ç –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π!\n\n"
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è:\n"
            "‚Ä¢ üîî –ü—Ä–æ—Å–º–æ—Ç—Ä–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n"
            "‚Ä¢ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n"
            "‚Ä¢ üìã –ü—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤\n\n"
            "–í–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏!"
        )

```

### app\templates\miniapp.html

```html```
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ project_title }} ‚Äî MAX Project Pilot</title>
    <script src="https://st.max.ru/js/max-web-app.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #4895ef;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .app-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 20px;
            padding: 30px;
            min-height: calc(100vh - 40px);
        }

        .project-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.3);
        }

        .kanban {
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
            padding: 1rem 0;
            min-height: 400px;
        }

        .column {
            min-width: 320px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            padding: 1.5rem;
            border-top: 4px solid;
        }

        .column-todo { border-color: var(--warning); }
        .column-in_progress { border-color: var(--info); }
        .column-done { border-color: var(--success); }

        .column h5 {
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid rgba(0,0,0,0.1);
        }

        .task {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            cursor: grab;
            border-left: 4px solid;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .task::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: currentColor;
            opacity: 0.3;
        }

        .task:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .priority-high {
            border-color: var(--danger);
            color: var(--danger);
        }

        .priority-medium {
            border-color: var(--warning);
            color: var(--warning);
        }

        .priority-low {
            border-color: var(--success);
            color: var(--success);
        }

        .task-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .task-assignees {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .task-due {
            font-size: 0.85rem;
            font-weight: 500;
        }

        .task-due.overdue {
            color: var(--danger);
        }

        .stats-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
        }

        .stats-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .refresh-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .refresh-btn:hover {
            background: var(--secondary);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .task {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="project-header">
            <div class="row align-items-center">
                <div class="col">
                    <h1 class="mb-2">üöÄ {{ project_title }}</h1>
                    <p class="mb-0 opacity-75">MAX Project Pilot ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏</p>
                </div>
                <div class="col-auto">
                    <button class="refresh-btn" onclick="loadTasks()">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="row mb-4" id="stats">
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number text-warning" id="todo-count">0</div>
                    <div>‚è≥ –ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number text-info" id="progress-count">0</div>
                    <div>üîß –í —Ä–∞–±–æ—Ç–µ</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number text-success" id="done-count">0</div>
                    <div>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number text-primary" id="total-count">0</div>
                    <div>üìã –í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
                </div>
            </div>
        </div>

        <!-- –ö–∞–Ω–±–∞–Ω –¥–æ—Å–∫–∞ -->
        <div class="kanban" id="board">
            <div class="column column-todo">
                <h5>‚è≥ –ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é</h5>
                <div class="tasks" data-status="todo"></div>
            </div>
            <div class="column column-in_progress">
                <h5>üîß –í —Ä–∞–±–æ—Ç–µ</h5>
                <div class="tasks" data-status="in_progress"></div>
            </div>
            <div class="column column-done">
                <h5>‚úÖ –ì–æ—Ç–æ–≤–æ</h5>
                <div class="tasks" data-status="done"></div>
            </div>
        </div>

        <div class="loading" id="loading">
            –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...
        </div>
    </div>

    <script>
        const PROJECT_HASH = "{{ project_hash }}";
        const API_BASE = `/api/projects/${PROJECT_HASH}`;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MAX Web App
        WebApp.ready();
        WebApp.expand();

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á
        async function loadTasks() {
            try {
                document.getElementById('loading').style.display = 'block';

                const res = await fetch(`${API_BASE}/tasks`);
                if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');

                const data = await res.json();
                renderTasks(data.tasks);
                updateStats(data.tasks);

                document.getElementById('loading').style.display = 'none';
                WebApp.HapticFeedback.notificationOccurred('success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('loading').innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á';
                WebApp.HapticFeedback.notificationOccurred('error');
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–∞–¥–∞—á
        function renderTasks(tasks) {
            // –û—á–∏—â–∞–µ–º –∫–æ–ª–æ–Ω–∫–∏
            document.querySelectorAll('.tasks').forEach(col => col.innerHTML = '');

            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏
            tasks.forEach(task => {
                const column = document.querySelector(`[data-status="${task.status}"]`);
                if (!column) return;

                const taskEl = createTaskElement(task);
                column.appendChild(taskEl);
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∑–∞–¥–∞—á–∏
        function createTaskElement(task) {
            const div = document.createElement('div');
            div.className = `task priority-${task.priority}`;

            const dueDate = task.due_date ? new Date(task.due_date) : null;
            const isOverdue = dueDate && dueDate < new Date();

            div.innerHTML = `
                <div class="task-title">${escapeHTML(task.title)}</div>
                ${task.description ? `<div class="task-description small text-muted mb-2">${escapeHTML(task.description)}</div>` : ''}
                <div class="task-assignees">
                    üë• ${task.assignees.length > 0 ? task.assignees.map(a => escapeHTML(a.full_name)).join(', ') : '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞'}
                </div>
                ${dueDate ? `
                    <div class="task-due ${isOverdue ? 'overdue' : ''}">
                        üìÖ ${dueDate.toLocaleDateString('ru-RU')} ${isOverdue ? '‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ' : ''}
                    </div>
                ` : ''}
                <div class="task-priority small mt-2">
                    –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: <strong>${getPriorityText(task.priority)}</strong>
                </div>
            `;

            return div;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats(tasks) {
            const todoCount = tasks.filter(t => t.status === 'todo').length;
            const progressCount = tasks.filter(t => t.status === 'in_progress').length;
            const doneCount = tasks.filter(t => t.status === 'done').length;
            const totalCount = tasks.length;

            document.getElementById('todo-count').textContent = todoCount;
            document.getElementById('progress-count').textContent = progressCount;
            document.getElementById('done-count').textContent = doneCount;
            document.getElementById('total-count').textContent = totalCount;
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function escapeHTML(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function getPriorityText(priority) {
            const priorities = {
                'high': '–í—ã—Å–æ–∫–∏–π',
                'medium': '–°—Ä–µ–¥–Ω–∏–π',
                'low': '–ù–∏–∑–∫–∏–π'
            };
            return priorities[priority] || priority;
        }

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        loadTasks();
        setInterval(loadTasks, 30000);

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', (e) => {
            console.error('Global error:', e);
            WebApp.HapticFeedback.notificationOccurred('error');
        });
    </script>
</body>
</html>

```

### webapp\index.html

```html```
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAX Project Pilot - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏</title>
    <script src="https://st.max.ru/js/max-web-app.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --max-primary: #4361ee;
            --max-secondary: #3a0ca3;
            --max-success: #4cc9f0;
            --max-danger: #f72585;
            --max-warning: #f8961e;
            --max-info: #4895ef;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 0;
            margin: 0;
        }

        .max-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 0;
            min-height: 100vh;
            padding: 20px;
        }

        .max-header {
            background: linear-gradient(135deg, var(--max-primary), var(--max-secondary));
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 1.5rem;
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.3);
        }

        .max-card {
            background: white;
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            border-left: 4px solid var(--max-primary);
        }

        .max-btn-primary {
            background: var(--max-primary);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .max-btn-primary:hover {
            background: var(--max-secondary);
            transform: translateY(-2px);
        }

        .nav-tabs-max .nav-link {
            border: none;
            color: #666;
            font-weight: 500;
            padding: 0.75rem 1rem;
        }

        .nav-tabs-max .nav-link.active {
            color: var(--max-primary);
            border-bottom: 3px solid var(--max-primary);
            background: none;
        }

        .project-card {
            background: white;
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            border-top: 4px solid var(--max-primary);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .project-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }

        .task-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            background: #e9ecef;
        }

        .task-todo { border-color: var(--max-warning); }
        .task-in-progress { border-color: var(--max-info); }
        .task-done { border-color: var(--max-success); }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--max-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 0.75rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .stats-card {
            text-align: center;
            padding: 1.25rem;
        }

        .stats-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            .max-container {
                padding: 15px;
            }

            .max-header {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .stats-number {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="max-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="max-header">
            <div class="row align-items-center">
                <div class="col">
                    <h4 class="mb-1"><i class="fas fa-rocket"></i> Project Pilot</h4>
                    <p class="mb-0 small opacity-85">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –≤ MAX</p>
                </div>
                <div class="col-auto">
                    <div id="user-info" class="d-flex align-items-center">
                        <div class="user-avatar" id="user-avatar">U</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <ul class="nav nav-tabs nav-tabs-max nav-justified mb-4">
            <li class="nav-item">
                <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                    <i class="fas fa-home"></i>
                    <span class="d-none d-md-inline"> –ì–ª–∞–≤–Ω–∞—è</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showSection('projects')">
                    <i class="fas fa-project-diagram"></i>
                    <span class="d-none d-md-inline"> –ü—Ä–æ–µ–∫—Ç—ã</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showSection('tasks')">
                    <i class="fas fa-tasks"></i>
                    <span class="d-none d-md-inline"> –ó–∞–¥–∞—á–∏</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showSection('team')">
                    <i class="fas fa-users"></i>
                    <span class="d-none d-md-inline"> –ö–æ–º–∞–Ω–¥–∞</span>
                </a>
            </li>
        </ul>

        <!-- –°–µ–∫—Ü–∏–∏ -->
        <div id="sections">
            <!-- –ì–ª–∞–≤–Ω–∞—è -->
            <div id="dashboard" class="section active">
                <div class="row g-3 mb-4">
                    <div class="col-6 col-md-3">
                        <div class="max-card stats-card">
                            <div class="stats-number text-primary" id="projects-count">0</div>
                            <div class="small">–ü—Ä–æ–µ–∫—Ç–æ–≤</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="max-card stats-card">
                            <div class="stats-number text-warning" id="tasks-todo-count">0</div>
                            <div class="small">–ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="max-card stats-card">
                            <div class="stats-number text-info" id="tasks-progress-count">0</div>
                            <div class="small">–í —Ä–∞–±–æ—Ç–µ</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="max-card stats-card">
                            <div class="stats-number text-success" id="tasks-done-count">0</div>
                            <div class="small">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                        </div>
                    </div>
                </div>

                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="max-card">
                            <h6><i class="fas fa-bolt"></i> –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h6>
                            <button class="btn max-btn-primary w-100 mb-2" onclick="createProject()">
                                <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
                            </button>
                            <button class="btn max-btn-primary w-100 mb-2" onclick="inviteMember()">
                                <i class="fas fa-user-plus"></i> –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å
                            </button>
                            <button class="btn max-btn-primary w-100" onclick="createTask()">
                                <i class="fas fa-tasks"></i> –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞
                            </button>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="max-card">
                            <h6><i class="fas fa-bell"></i> –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h6>
                            <div id="notifications-list">
                                <div class="loading">
                                    <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–æ–µ–∫—Ç—ã -->
            <div id="projects" class="section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="mb-0">–ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã</h6>
                    <button class="btn max-btn-primary btn-sm" onclick="createProject()">
                        <i class="fas fa-plus"></i> –ù–æ–≤—ã–π
                    </button>
                </div>
                <div id="projects-list">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤...
                    </div>
                </div>
            </div>

            <!-- –ó–∞–¥–∞—á–∏ -->
            <div id="tasks" class="section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="mb-0">–í—Å–µ –∑–∞–¥–∞—á–∏</h6>
                    <button class="btn max-btn-primary btn-sm" onclick="createTask()">
                        <i class="fas fa-plus"></i> –ù–æ–≤–∞—è
                    </button>
                </div>
                <div id="tasks-list">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...
                    </div>
                </div>
            </div>

            <!-- –ö–æ–º–∞–Ω–¥–∞ -->
            <div id="team" class="section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="mb-0">–ö–æ–º–∞–Ω–¥–∞</h6>
                    <button class="btn max-btn-primary btn-sm" onclick="inviteMember()">
                        <i class="fas fa-user-plus"></i> –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å
                    </button>
                </div>
                <div id="team-list">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–∞–Ω–¥—ã...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MAX Web App
        WebApp.ready();
        WebApp.expand();

        let currentUser = null;
        let currentProject = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            const initData = WebApp.initDataUnsafe;
            currentUser = initData.user;

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            document.getElementById('user-avatar').textContent =
                currentUser.first_name?.[0] || currentUser.username?.[0] || 'U';

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            loadDashboardData();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–∫—Ç–∏–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫
            WebApp.HapticFeedback.impactOccurred('light');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function loadDashboardData() {
            // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç API –∑–∞–ø—Ä–æ—Å)
            const demoData = {
                projects: 3,
                tasks_todo: 5,
                tasks_in_progress: 3,
                tasks_done: 12,
                notifications: [
                    {
                        title: "‚úÖ –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞",
                        message: "–ò–≤–∞–Ω –≤—ã–ø–æ–ª–Ω–∏–ª –∑–∞–¥–∞—á—É '–î–∏–∑–∞–π–Ω –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã'",
                        time: "5 –º–∏–Ω –Ω–∞–∑–∞–¥"
                    },
                    {
                        title: "üéØ –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞",
                        message: "–í–∞–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –∑–∞–¥–∞—á–∞ '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API'",
                        time: "1 —á–∞—Å –Ω–∞–∑–∞–¥"
                    },
                    {
                        title: "üë• –ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫",
                        message: "–ê–Ω–Ω–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∞—Å—å –∫ –ø—Ä–æ–µ–∫—Ç—É '–í–µ–±-—Å–∞–π—Ç'",
                        time: "2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥"
                    }
                ]
            };

            updateStats(demoData);
            loadNotifications(demoData.notifications);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats(data) {
            document.getElementById('projects-count').textContent = data.projects;
            document.getElementById('tasks-todo-count').textContent = data.tasks_todo;
            document.getElementById('tasks-progress-count').textContent = data.tasks_in_progress;
            document.getElementById('tasks-done-count').textContent = data.tasks_done;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function loadNotifications(notifications) {
            const container = document.getElementById('notifications-list');
            container.innerHTML = notifications.map(notif => `
                <div class="task-item task-todo mb-2">
                    <strong class="small">${notif.title}</strong>
                    <div class="small">${notif.message}</div>
                    <div class="small text-muted">${notif.time}</div>
                </div>
            `).join('');
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–π
        function showSection(sectionName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
            document.getElementById(sectionName).classList.add('active');

            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –≤–∫–ª–∞–¥–∫—É
            event.target.classList.add('active');

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–µ–∫—Ü–∏–∏
            switch(sectionName) {
                case 'projects':
                    loadProjects();
                    break;
                case 'tasks':
                    loadTasks();
                    break;
                case 'team':
                    loadTeam();
                    break;
            }

            WebApp.HapticFeedback.impactOccurred('light');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
        function loadProjects() {
            const projects = [
                {
                    id: 1,
                    title: "–í–µ–±-—Å–∞–π—Ç –∫–æ–º–ø–∞–Ω–∏–∏",
                    description: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Å–∞–π—Ç–∞",
                    tasks: 8,
                    members: 3,
                    progress: 65
                },
                {
                    id: 2,
                    title: "–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",
                    description: "iOS –∏ Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",
                    tasks: 12,
                    members: 4,
                    progress: 35
                },
                {
                    id: 3,
                    title: "API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è",
                    description: "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏",
                    tasks: 5,
                    members: 2,
                    progress: 80
                }
            ];

            const container = document.getElementById('projects-list');
            container.innerHTML = projects.map(project => `
                <div class="project-card" onclick="openProject(${project.id})">
                    <h6 class="mb-1">${project.title}</h6>
                    <p class="small text-muted mb-2">${project.description}</p>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="badge bg-primary">${project.tasks} –∑–∞–¥–∞—á</span>
                        <span class="badge bg-secondary">${project.members} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</span>
                    </div>
                    <div class="progress" style="height: 6px;">
                        <div class="progress-bar" style="width: ${project.progress}%"></div>
                    </div>
                    <small class="text-muted">${project.progress}% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</small>
                </div>
            `).join('');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á
        function loadTasks() {
            const tasks = [
                {
                    id: 1,
                    title: "–î–∏–∑–∞–π–Ω –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã",
                    project: "–í–µ–±-—Å–∞–π—Ç",
                    assignee: "–í—ã",
                    status: "in-progress",
                    priority: "high"
                },
                {
                    id: 2,
                    title: "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API",
                    project: "API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è",
                    assignee: "–ò–≤–∞–Ω",
                    status: "todo",
                    priority: "medium"
                },
                {
                    id: 3,
                    title: "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",
                    project: "–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",
                    assignee: "–ê–Ω–Ω–∞",
                    status: "done",
                    priority: "low"
                }
            ];

            const container = document.getElementById('tasks-list');
            container.innerHTML = tasks.map(task => `
                <div class="task-item task-${task.status}">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="flex-grow-1">
                            <h6 class="small mb-1">${task.title}</h6>
                            <small class="text-muted">${task.project}</small>
                            <div class="mt-1">
                                <span class="badge bg-${getPriorityColor(task.priority)} me-1">
                                    ${getPriorityText(task.priority)}
                                </span>
                                <span class="badge bg-${getStatusColor(task.status)}">
                                    ${getStatusText(task.status)}
                                </span>
                            </div>
                        </div>
                        <div class="text-end">
                            <small class="text-muted">${task.assignee}</small>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–∞–Ω–¥—ã
        function loadTeam() {
            const team = [
                { name: "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤", role: "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫", projects: 3 },
                { name: "–ê–Ω–Ω–∞ –°–∏–¥–æ—Ä–æ–≤–∞", role: "–î–∏–∑–∞–π–Ω–µ—Ä", projects: 2 },
                { name: "–í—ã", role: "–ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞", projects: 3 }
            ];

            const container = document.getElementById('team-list');
            container.innerHTML = team.map(member => `
                <div class="max-card">
                    <div class="d-flex align-items-center">
                        <div class="user-avatar">${member.name[0]}</div>
                        <div class="flex-grow-1">
                            <h6 class="mb-0 small">${member.name}</h6>
                            <small class="text-muted">${member.role}</small>
                        </div>
                        <span class="badge bg-primary">${member.projects}</span>
                    </div>
                </div>
            `).join('');
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getPriorityColor(priority) {
            const colors = { high: 'danger', medium: 'warning', low: 'success' };
            return colors[priority] || 'secondary';
        }

        function getPriorityText(priority) {
            const texts = { high: '–í—ã—Å–æ–∫–∏–π', medium: '–°—Ä–µ–¥–Ω–∏–π', low: '–ù–∏–∑–∫–∏–π' };
            return texts[priority] || priority;
        }

        function getStatusColor(status) {
            const colors = { 'todo': 'warning', 'in-progress': 'info', 'done': 'success' };
            return colors[status] || 'secondary';
        }

        function getStatusText(status) {
            const texts = { 'todo': '–ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é', 'in-progress': '–í —Ä–∞–±–æ—Ç–µ', 'done': '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' };
            return texts[status] || status;
        }

        // –î–µ–π—Å—Ç–≤–∏—è
        function createProject() {
            WebApp.HapticFeedback.notificationOccurred('success');
            showSection('projects');
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
            setTimeout(() => {
                alert('–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ—Ç–∞ @t44_hakaton_bot');
            }, 300);
        }

        function createTask() {
            WebApp.HapticFeedback.notificationOccurred('success');
            showSection('tasks');
            setTimeout(() => {
                alert('–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ—Ç–∞ @t44_hakaton_bot');
            }, 300);
        }

        function inviteMember() {
            WebApp.HapticFeedback.notificationOccurred('success');
            showSection('team');
            setTimeout(() => {
                alert('–î–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ—Ç–∞ @t44_hakaton_bot');
            }, 300);
        }

        function openProject(projectId) {
            WebApp.HapticFeedback.notificationOccurred('success');
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –∫ –¥–µ—Ç–∞–ª—è–º –ø—Ä–æ–µ–∫—Ç–∞
            alert(`–ü—Ä–æ–µ–∫—Ç #${projectId}\n\n–î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ –±–æ—Ç–∞ @t44_hakaton_bot`);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º API -->
    <script src="js/api.js"></script>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = null;
        let api = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        async function initApp() {
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MAX Web App
                WebApp.ready();
                WebApp.expand();

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è API
                api = window.ProjectPilotAPI;
                currentUser = await api.initUser();

                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                updateUserInfo();

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                await loadDashboardData();

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–∫—Ç–∏–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫
                WebApp.HapticFeedback.impactOccurred('light');

            } catch (error) {
                console.error('Error initializing app:', error);
                showError('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        function updateUserInfo() {
            if (currentUser) {
                const avatar = document.getElementById('user-avatar');
                avatar.textContent = currentUser.first_name?.[0] ||
                                   currentUser.username?.[0] || 'U';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        async function loadDashboardData() {
            try {
                const data = await api.getUserProjects();

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateStats(data.projects);

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                loadDemoNotifications();

            } catch (error) {
                console.error('Error loading dashboard data:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                showDemoData();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats(projects) {
            const totalProjects = projects.length;
            let totalTasksTodo = 0;
            let totalTasksInProgress = 0;
            let totalTasksDone = 0;

            projects.forEach(project => {
                totalTasksTodo += project.stats.tasks_todo;
                totalTasksInProgress += project.stats.tasks_in_progress;
                totalTasksDone += project.stats.tasks_done;
            });

            document.getElementById('projects-count').textContent = totalProjects;
            document.getElementById('tasks-todo-count').textContent = totalTasksTodo;
            document.getElementById('tasks-progress-count').textContent = totalTasksInProgress;
            document.getElementById('tasks-done-count').textContent = totalTasksDone;
        }

        // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏
        function showDemoData() {
            document.getElementById('projects-count').textContent = '3';
            document.getElementById('tasks-todo-count').textContent = '5';
            document.getElementById('tasks-progress-count').textContent = '3';
            document.getElementById('tasks-done-count').textContent = '12';
        }

        // –ü–æ–∫–∞–∑ –æ—à–∏–±–∫–∏
        function showError(message) {
            // –ú–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π –ø–æ–∫–∞–∑ –æ—à–∏–±–æ–∫
            console.error('App error:', message);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

```

### webapp\js\api.js

```js```
// API –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–æ—Ç–æ–º
class ProjectPilotAPI {
    constructor(baseURL = 'http://localhost:8000') {
        this.baseURL = baseURL;
        this.userData = null;
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    async initUser() {
        try {
            const initData = WebApp.initDataUnsafe;
            this.userData = initData.user;

            // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            const isValid = await this.validateUserData(initData);
            if (!isValid) {
                console.warn('User data validation failed');
            }

            return this.userData;
        } catch (error) {
            console.error('Error initializing user:', error);
            throw error;
        }
    }

    // –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–µ–∫—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    async getUserProjects() {
        if (!this.userData) {
            await this.initUser();
        }

        try {
            const response = await fetch(
                `${this.baseURL}/api/miniapp/user/${this.userData.id}/projects`
            );

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Error fetching projects:', error);
            throw error;
        }
    }

    // –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
    async createProject(projectData) {
        if (!this.userData) {
            await this.initUser();
        }

        try {
            const response = await fetch(
                `${this.baseURL}/api/miniapp/user/${this.userData.id}/projects`,
                {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(projectData)
                }
            );

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            // –¢–∞–∫—Ç–∏–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
            WebApp.HapticFeedback.notificationOccurred('success');

            return data;
        } catch (error) {
            console.error('Error creating project:', error);
            WebApp.HapticFeedback.notificationOccurred('error');
            throw error;
        }
    }

    // –ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏ –ø—Ä–æ–µ–∫—Ç–∞
    async getProjectTasks(projectHash) {
        try {
            const response = await fetch(
                `${this.baseURL}/api/miniapp/projects/${projectHash}/tasks`
            );

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Error fetching tasks:', error);
            throw error;
        }
    }

    // –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
    async createTask(taskData) {
        try {
            const response = await fetch(
                `${this.baseURL}/api/miniapp/tasks`,
                {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(taskData)
                }
            );

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            WebApp.HapticFeedback.notificationOccurred('success');
            return data;
        } catch (error) {
            console.error('Error creating task:', error);
            WebApp.HapticFeedback.notificationOccurred('error');
            throw error;
        }
    }

    // –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É
    async completeTask(taskId) {
        try {
            const response = await fetch(
                `${this.baseURL}/api/miniapp/tasks/${taskId}/complete`,
                {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})
                }
            );

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            WebApp.HapticFeedback.notificationOccurred('success');
            return data;
        } catch (error) {
            console.error('Error completing task:', error);
            WebApp.HapticFeedback.notificationOccurred('error');
            throw error;
        }
    }

    // –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ–µ–∫—Ç
    async inviteToProject(projectHash, userMaxId) {
        try {
            const response = await fetch(
                `${this.baseURL}/api/miniapp/projects/${projectHash}/invite/${userMaxId}`,
                {
                    method: 'POST'
                }
            );

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            WebApp.HapticFeedback.notificationOccurred('success');
            return data;
        } catch (error) {
            console.error('Error inviting user:', error);
            WebApp.HapticFeedback.notificationOccurred('error');
            throw error;
        }
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    async validateUserData(initData) {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –∏–∑ MAX
        // –°–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
        return true; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥–ª—è –¥–µ–º–æ
    }
}

// –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä API
window.ProjectPilotAPI = new ProjectPilotAPI();

```

