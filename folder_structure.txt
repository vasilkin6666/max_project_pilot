# Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ð°Ð¿ÐºÐ¸: E:\GUAP\max_project_pilot

## Ð”ÐµÑ€ÐµÐ²Ð¾ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ð¾Ð²

```
max_project_pilot/
  .env
  .env.example
  .gitignore
  README.md
  backend/
    Dockerfile
    alembic/
      env.py
      script.py.mako
      versions/
        001_initial_tables.py
    alembic.ini
    app/
      __init__.py
      api/
        __init__.py
        auth.py
        deps.py
        notifications.py
        projects.py
        tasks.py
        users.py
      config.py
      core/
        exceptions.py
        security.py
      database.py
      main.py
      models/
        __init__.py
        base.py
        enums.py
        notification.py
        project.py
        task.py
        user.py
    requirements.txt
  bot/
    Dockerfile
    app/
      __init__.py
      bot.py
      config.py
      handlers/
        __init__.py
        notifications.py
        projects.py
        start.py
      services/
        __init__.py
        api_client.py
      utils.py
    folder_structure.txt
    requirements.txt
  docker-compose.yml
  test_api.sh
  web/
    README.md
    assets/
      favicon.ico
    css/
      style.css
    index.html
    js/
      api.js
      auth.js
      dashboard.js
      main.js
      projects.js
      tasks.js
```

## Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð²

### .env

```txt```
# .env
# --- ÐžÐ±Ñ‰Ð¸Ðµ ---
APP_ENV=production

# --- Ð‘Ð¾Ñ‚ ---
BOT_TOKEN=f9LHodD0cOKTlb3nlkLwZ_zwBGlbLSE4nWjnbWoP6tvBs3HQbTMLAGyVR2aP8cfg37-NusW0KG_CdvMtxNN1A

# --- Backend ---
BACKEND_HOST=0.0.0.0
BACKEND_PORT=8000
POSTGRES_SERVER=db
POSTGRES_PORT=5432
POSTGRES_DB=max_pilot_db
POSTGRES_USER=max_user
POSTGRES_PASSWORD=your_secure_password

# --- Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ðµ ÐºÐ»ÑŽÑ‡Ð¸ ---
SECRET_KEY=your-super-secret-key-for-jwt
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# --- URL-Ñ‹ ---
SITE_URL=https://vasilkin6666.github.io/max_project_pilot/web
BACKEND_API_URL=https://powerfully-exotic-chamois.cloudpub.ru/api

```

### .env.example

```example```
# .env.example
# --- ÐžÐ±Ñ‰Ð¸Ðµ ---
APP_ENV=development

# --- Ð‘Ð¾Ñ‚ ---
BOT_TOKEN=your_max_bot_token

# --- Backend ---
BACKEND_HOST=0.0.0.0
BACKEND_PORT=8000
POSTGRES_SERVER=db
POSTGRES_PORT=5432
POSTGRES_DB=max_pilot_db
POSTGRES_USER=max_user
POSTGRES_PASSWORD=your_secure_password

# --- Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ðµ ÐºÐ»ÑŽÑ‡Ð¸ ---
SECRET_KEY=your-super-secret-key-for-jwt
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# --- URL-Ñ‹ ---
SITE_URL=https://your-github-username.github.io/your-repo-name # ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð´Ð»Ñ GitHub Pages
BACKEND_API_URL=http://your-server-ip:8000/api # ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð´Ð»Ñ Ð²Ð°ÑˆÐµÐ³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°

```

### .gitignore

```txt```
# .gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg
MANIFEST
.venv
venv/
env/
.ENV

# Backend
backend/app/data/
backend/alembic/versions/*.py

# Bot

# Web
web/node_modules/
web/dist/

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

```

### README.md

```md```
# MAX Project Pilot

ÐœÐ½Ð¾Ð³Ð¾Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ð¼Ð¸, Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ñ Ð¼ÐµÑÑÐµÐ½Ð´Ð¶ÐµÑ€Ð¾Ð¼ MAX. Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð±Ð¾Ñ‚Ð°, Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¸ API Ð´Ð»Ñ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð·Ð°Ð´Ð°Ñ‡Ð°Ð¼Ð¸, Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ð¼Ð¸, ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ°Ð¼Ð¸ Ð¸ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸ÑÐ¼Ð¸.

## ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸

- **Ð Ð¾Ð»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹**: Ð’Ð»Ð°Ð´ÐµÐ»ÐµÑ†, ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€, Ð£Ñ‡Ð°ÑÑ‚Ð½Ð¸Ðº, Ð“Ð¾ÑÑ‚ÑŒ.
- **Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð°Ð¼Ð¸**: Ð¡Ñ‚Ð°Ñ‚ÑƒÑÑ‹ (Ðš Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÑŽ, Ð’ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ, Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾), Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚Ñ‹, Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»Ð¸.
- **Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ð¼Ð¸**: ÐŸÑ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ðµ/Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ, Ñ Ð¾Ð´Ð¾Ð±Ñ€ÐµÐ½Ð¸ÐµÐ¼ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð².
- **Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ**: Ð’ Ð±Ð¾Ñ‚Ðµ Ð¸ Ð² Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸.
- **Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸**:
  - Ð¢Ð°Ð¹Ð¼ÐµÑ€ Pomodoro.
  - Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð·Ð°Ð´Ð°Ñ‡.
  - ÐŸÐ¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð¸ (Ñ‡ÐµÐº-Ð»Ð¸ÑÑ‚Ñ‹).
  - ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ñ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸ÑÐ¼Ð¸.
  - ÐŸÑ€Ð¸ÐºÑ€ÐµÐ¿Ð»ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð².
  - ÐÐ²Ñ‚Ð¾-ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ.
  - ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð·Ð°Ð´Ð°Ñ‡Ð°Ð¼.
  - Ð­Ð¼Ð¾Ð´Ð·Ð¸ Ð² Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑÑ….
  - Drag & Drop Ð·Ð°Ð´Ð°Ñ‡.
  - ÐÐ²Ñ‚Ð¾-Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ.
  - QR-ÐºÐ¾Ð´Ñ‹ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ð¹.
  - Ð¢ÐµÐ¼Ð½Ð°Ñ Ñ‚ÐµÐ¼Ð°.

## ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°

- **Backend**: FastAPI, PostgreSQL, SQLAlchemy, Alembic.
- **Bot**: Python, `maxapi` SDK.
- **Web**: Ð¡Ñ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ HTML/CSS/JS, Ñ€Ð°Ð·Ð¼ÐµÑ‰Ð°ÐµÑ‚ÑÑ Ð½Ð° GitHub Pages.
- **Docker**: ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð²ÑÐµÑ… ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð².

## Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¸ Ð·Ð°Ð¿ÑƒÑÐº

1. Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹.
2. Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ `.env.example` Ð² `.env` Ð¸ Ð·Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ.
3. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Docker Ð¸ Docker Compose.
4. Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ `docker-compose up -d`.

## Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ

MIT

```

### docker-compose.yml

```yml```
# docker-compose.yml
version: '3.8'

services:
  db:
    image: postgres:15
    container_name: max_pilot_db
    environment:
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ñ‚Ð¾Ð¼, Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ñ‹Ð¹ Ð²Ð½Ð¸Ð·Ñƒ
      - postgres_data:/var/lib/postgresql/data
      # Ð•ÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾, Ð¼Ð¾Ð¶Ð½Ð¾ Ñ‚Ð°ÐºÐ¶Ðµ Ð¼Ð¾Ð½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½ÑƒÑŽ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ (Ð½Ðµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ production Ð±ÐµÐ· ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ Ð¿Ñ€Ð°Ð²)
      # - ./init.sql:/docker-entrypoint-initdb.d/init.sql # ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð´Ð»Ñ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸
    ports:
      # ÐžÑ‚ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ð¿Ð¾Ñ€Ñ‚ 5432 Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸. Ð’ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ðµ ÐÐ• Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒ!
      # Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ð¾Ð½ Ð½Ðµ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚ÑƒÐµÑ‚ Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¼ PostgreSQL.
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}"]
      interval: 10s
      timeout: 5s
      retries: 5

  backend:
    build: ./backend
    container_name: max_pilot_backend
    ports:
      - "${BACKEND_PORT}:8000"
    environment:
      - DATABASE_URL=postgresql+asyncpg://${POSTGRES_USER}:${POSTGRES_PASSWORD}@db:${POSTGRES_PORT}/${POSTGRES_DB} # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¸Ð¼Ñ ÑÐµÑ€Ð²Ð¸ÑÐ° 'db'
      - SECRET_KEY=${SECRET_KEY}
      - ALGORITHM=${ALGORITHM}
      - ACCESS_TOKEN_EXPIRE_MINUTES=${ACCESS_TOKEN_EXPIRE_MINUTES}
      - SITE_URL=${SITE_URL}
      - BACKEND_API_URL=${BACKEND_API_URL} # Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ ÑÑ‚Ð¾ Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ URL Ð´Ð»Ñ Ð±Ð¾Ñ‚Ð°
    depends_on:
      db:
        condition: service_healthy
    restart: unless-stopped
    # Ð’Ð°Ð¶Ð½Ð¾: backend Ð½Ðµ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð·Ð°Ð²Ð¸ÑÐµÑ‚ÑŒ Ð¾Ñ‚ bot
    # depends_on Ð½Ðµ Ð¶Ð´Ñ‘Ñ‚ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ bot, Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð·Ð°Ð¿ÑƒÑÐºÐ°.

  bot:
    build: ./bot
    container_name: max_pilot_bot
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
      - BACKEND_API_URL=https://powerfully-exotic-chamois.cloudpub.ru/api  # ÐŸÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ URL
    depends_on:
      - backend
    restart: unless-stopped

# ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ñ‚Ð¾Ð¼Ð¾Ð²
volumes:
  postgres_data: # Ð˜Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ñ‚Ð¾Ð¼ Ð´Ð»Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… PostgreSQL
    # driver: local # ÐÐµÐ¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾, Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ local
    # driver_opts: # ÐÐµÐ¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾, Ð¼Ð¾Ð¶Ð½Ð¾ ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¾Ð¿Ñ†Ð¸Ð¸ Ð´Ñ€Ð°Ð¹Ð²ÐµÑ€Ð°
    #   type: none
    #   o: bind
    #   device: /host/path/directory # Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ñ‚Ð¸Ð¿Ð° 'bind'

```

### test_api.sh

```sh```
#!/bin/bash

echo "=== ÐŸÐžÐ›ÐÐ«Ð™ Ð¢Ð•Ð¡Ð¢ MAX PROJECT PILOT API ==="

# 1. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
echo "1. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹..."
TOKEN1=$(curl -s -X POST https://powerfully-exotic-chamois.cloudpub.ru/api/auth/token \
  -H "Content-Type: application/json" \
  -d '{"max_id": "test_user_1", "full_name": "Test User 1"}' | jq -r '.access_token')

TOKEN2=$(curl -s -X POST https://powerfully-exotic-chamois.cloudpub.ru/api/auth/token \
  -H "Content-Type: application/json" \
  -d '{"max_id": "test_user_2", "full_name": "Test User 2"}' | jq -r '.access_token')

echo "Ð¢Ð¾ÐºÐµÐ½Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹"

# 2. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð²
echo "2. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð²..."
PUBLIC_PROJECT=$(curl -s -X POST "https://powerfully-exotic-chamois.cloudpub.ru/api/projects/?title=Public%20Test&description=Public%20test%20project&is_private=false&requires_approval=false" \
  -H "Authorization: Bearer $TOKEN1")
PUBLIC_HASH=$(echo $PUBLIC_PROJECT | jq -r '.project.hash')

PRIVATE_APPROVAL=$(curl -s -X POST "https://powerfully-exotic-chamois.cloudpub.ru/api/projects/?title=Private%20Approval&description=Private%20with%20approval&is_private=true&requires_approval=true" \
  -H "Authorization: Bearer $TOKEN1")
APPROVAL_HASH=$(echo $PRIVATE_APPROVAL | jq -r '.project.hash')

PRIVATE_OPEN=$(curl -s -X POST "https://powerfully-exotic-chamois.cloudpub.ru/api/projects/?title=Private%20Open&description=Private%20without%20approval&is_private=true&requires_approval=false" \
  -H "Authorization: Bearer $TOKEN1")
OPEN_HASH=$(echo $PRIVATE_OPEN | jq -r '.project.hash')

echo "ÐŸÑ€Ð¾ÐµÐºÑ‚Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹: $PUBLIC_HASH, $APPROVAL_HASH, $OPEN_HASH"

# 3. ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ 2 Ðº Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ð¼
echo "3. ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ðº Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ð¼..."
curl -s -X POST "https://powerfully-exotic-chamois.cloudpub.ru/api/projects/$PUBLIC_HASH/join" \
  -H "Authorization: Bearer $TOKEN2" > /dev/null

curl -s -X POST "https://powerfully-exotic-chamois.cloudpub.ru/api/projects/$APPROVAL_HASH/join" \
  -H "Authorization: Bearer $TOKEN2" > /dev/null

curl -s -X POST "https://powerfully-exotic-chamois.cloudpub.ru/api/projects/$OPEN_HASH/join" \
  -H "Authorization: Bearer $TOKEN2" > /dev/null

echo "ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾"

# 4. Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°ÑÐ²ÐºÐ°Ð¼Ð¸
echo "4. Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°ÑÐ²ÐºÐ°Ð¼Ð¸..."
REQUESTS=$(curl -s -X GET "https://powerfully-exotic-chamois.cloudpub.ru/api/projects/$APPROVAL_HASH/join-requests" \
  -H "Authorization: Bearer $TOKEN1")
REQUEST_ID=$(echo $REQUESTS | jq -r '.requests[0].id')

curl -s -X POST "https://powerfully-exotic-chamois.cloudpub.ru/api/projects/$APPROVAL_HASH/join-requests/$REQUEST_ID/approve" \
  -H "Authorization: Bearer $TOKEN1" > /dev/null

echo "Ð—Ð°ÑÐ²ÐºÐ° Ð¾Ð´Ð¾Ð±Ñ€ÐµÐ½Ð°"

# 5. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡
echo "5. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡..."
TASK1=$(curl -s -X POST "https://powerfully-exotic-chamois.cloudpub.ru/api/tasks/?title=Main%20Task&project_hash=$PUBLIC_HASH&description=Main%20task%20description&status=todo&priority=high" \
  -H "Authorization: Bearer $TOKEN1")
TASK1_ID=$(echo $TASK1 | jq -r '.task.id')

TASK2=$(curl -s -X POST "https://powerfully-exotic-chamois.cloudpub.ru/api/tasks/?title=Dependent%20Task&project_hash=$PUBLIC_HASH&description=Depends%20on%20main&status=todo&priority=medium&depends_on_ids=$TASK1_ID" \
  -H "Authorization: Bearer $TOKEN1")
TASK2_ID=$(echo $TASK2 | jq -r '.task.id')

echo "Ð—Ð°Ð´Ð°Ñ‡Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹: $TASK1_ID, $TASK2_ID"

# 6. Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð·Ð°Ð´Ð°Ñ‡Ð°Ð¼Ð¸
echo "6. Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð·Ð°Ð´Ð°Ñ‡Ð°Ð¼Ð¸..."
curl -s -X PUT "https://powerfully-exotic-chamois.cloudpub.ru/api/tasks/$TASK1_ID/status?status=in_progress" \
  -H "Authorization: Bearer $TOKEN1" > /dev/null

curl -s -X POST "https://powerfully-exotic-chamois.cloudpub.ru/api/tasks/$TASK1_ID/comments?content=Task%20started" \
  -H "Authorization: Bearer $TOKEN1" > /dev/null

curl -s -X PUT "https://powerfully-exotic-chamois.cloudpub.ru/api/tasks/$TASK1_ID/status?status=done" \
  -H "Authorization: Bearer $TOKEN1" > /dev/null

curl -s -X PUT "https://powerfully-exotic-chamois.cloudpub.ru/api/tasks/$TASK2_ID/status?status=done" \
  -H "Authorization: Bearer $TOKEN1" > /dev/null

echo "Ð—Ð°Ð´Ð°Ñ‡Ð¸ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ñ‹"

# 7. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð²
echo "7. Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°..."
curl -s -X GET "https://powerfully-exotic-chamois.cloudpub.ru/api/users/test_user_1/projects" \
  -H "Authorization: Bearer $TOKEN1" | jq '.projects | length' | read PROJECT_COUNT

curl -s -X GET "https://powerfully-exotic-chamois.cloudpub.ru/api/tasks/" \
  -H "Authorization: Bearer $TOKEN1" | jq '.tasks | length' | read TASK_COUNT

curl -s -X GET "https://powerfully-exotic-chamois.cloudpub.ru/api/notifications/" \
  -H "Authorization: Bearer $TOKEN1" | jq '.notifications | length' | read NOTIF_COUNT

echo "=== Ð¢Ð•Ð¡Ð¢ Ð—ÐÐ’Ð•Ð Ð¨Ð•Ð ==="
echo "Ð˜Ñ‚Ð¾Ð³Ð¸:"
echo "- ÐŸÑ€Ð¾ÐµÐºÑ‚Ð¾Ð²: $PROJECT_COUNT"
echo "- Ð—Ð°Ð´Ð°Ñ‡: $TASK_COUNT"
echo "- Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹: $NOTIF_COUNT"
echo "Ð’ÑÐµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾! ðŸŽ‰"

```

### backend\Dockerfile

```txt```
# backend/Dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]

```

### backend\alembic.ini

```ini```
# backend/alembic.ini
# A generic, single database configuration.

[alembic]
# path to migration scripts
script_location = alembic

# template used to generate migration file names; The default value is %%(rev)s_%%(slug)s
# Uncomment the line below if you want the files to be prepended with date and time
# see https://alembic.sqlalchemy.org/en/latest/tutorial.html#editing-the-ini-file
# for all available tokens
# file_template = %%(year)d_%%(month).2d_%%(day).2d_%%(hour).2d%%(minute).2d-%%(rev)s_%%(slug)s

# sys.path path, will be prepended to sys.path if present.
# defaults to the current working directory.
prepend_sys_path = .

# timezone to use when rendering the date within the migration file
# as well as the filename.
# If specified, requires the python>=3.9 or backports.zoneinfo library.
# Any required deps can installed by adding `alembic[tz]` to the pip requirements
# string value is passed to ZoneInfo()
# leave blank for localtime
# timezone =

# max length of characters to apply to the
# "slug" field
# max_length = 40

# version number display, one of:
# "short" - short version number (e.g. "1a2b3c4")
# "long" - full version number with all digits (e.g. "1234567890abcdef")
# "none" - no version number in the filename
version_num_in_file = false

# version path separator; As mentioned above, this is the character used to split
# version_locations. The default within new alembic.ini files is "os", which uses
# os.pathsep. If this key is omitted entirely, it falls back to the legacy
# behavior of splitting on spaces and/or commas.
# Valid values for version_path_separator are:
#
# version_path_separator = :
# version_path_separator = ;
# version_path_separator = space
version_path_separator = os  # Use os.pathsep. Default configuration used for new projects.

# the output encoding used when revision files
# are written from script.py.mako
# output_encoding = utf-8

sqlalchemy.url = driver://user:pass@localhost/dbname


[post_write_hooks]
# post_write_hooks defines scripts or Python functions that are run
# on newly generated revision scripts.  See the documentation for further
# detail and examples

# format using "black" - use the console_scripts runner, against the "black" entrypoint
# hooks = black
# black.type = console_scripts
# black.entrypoint = black
# black.options = -l 79 REVISION_SCRIPT_FILENAME

# lint with attempts to fix using "ruff" - use the exec runner, execute a binary
# hooks = ruff
# ruff.type = exec
# ruff.executable = %(here)s/.venv/bin/ruff
# ruff.options = --fix REVISION_SCRIPT_FILENAME

# Logging configuration
[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = WARN
handlers = console
qualname =

[logger_sqlalchemy]
level = WARN
handlers =
qualname = sqlalchemy

[logger_alembic]
level = INFO
handlers =
qualname = alembic

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S

```

### backend\requirements.txt

```txt```
fastapi==0.115.0
uvicorn[standard]==0.30.6
sqlalchemy[asyncio]==2.0.35
asyncpg==0.29.0
alembic==1.13.1
pydantic==2.9.2
pydantic-settings==2.5.2
python-dotenv==1.0.1
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.17
loguru==0.7.2

```

### backend\alembic\env.py

```py```
# backend/alembic/env.py
from logging.config import fileConfig
from sqlalchemy import pool
from sqlalchemy.engine import Connection
from sqlalchemy.ext.asyncio import async_engine_from_config
from alembic import context
from app.models import Base
from app.config import settings
import asyncio

# this is the Alembic Config object, which provides
# access to the values within the .ini file in use.
config = context.config

# Interpret the config file for Python logging.
# This line sets up loggers basically.
if config.config_file_name is not None:
    fileConfig(config.config_file_name)

# add your model's MetaData object here
# for 'autogenerate' support
target_metadata = Base.metadata

# other values from the config, defined by the needs of env.py,
# can be acquired:
# my_important_option = config.get_main_option("my_important_option")
# ... etc.

def run_migrations_offline() -> None:
    """Run migrations in 'offline' mode."""
    url = settings.DATABASE_URL
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={"paramstyle": "named"},
    )

    with context.begin_transaction():
        context.run_migrations()

def do_run_migrations(connection: Connection) -> None:
    context.configure(connection=connection, target_metadata=target_metadata)

    with context.begin_transaction():
        context.run_migrations()

async def run_async_migrations() -> None:
    """In this scenario we need to create an Engine
    and associate a connection with the context."""
    configuration = config.get_section(config.config_ini_section)
    configuration['sqlalchemy.url'] = settings.DATABASE_URL

    connectable = async_engine_from_config(
        configuration,
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )

    async with connectable.connect() as connection:
        await connection.run_sync(do_run_migrations)

    await connectable.dispose()

def run_migrations_online() -> None:
    """Run migrations in 'online' mode."""
    asyncio.run(run_async_migrations())

if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()

```

### backend\alembic\script.py.mako

```mako```
# backend/alembic/script.py.mako
"""${message}

Revision ID: ${up_revision}
Revises: ${down_revision | comma,n}
Create Date: ${create_date}

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
${imports if imports else ""}

# revision identifiers, used by Alembic.
revision: str = ${repr(up_revision)}
down_revision: Union[str, None] = ${repr(down_revision)}
branch_labels: Union[str, Sequence[str], None] = ${repr(branch_labels)}
depends_on: Union[str, Sequence[str], None] = ${repr(depends_on)}


def upgrade() -> None:
    ${upgrades if upgrades else "pass"}


def downgrade() -> None:
    ${downgrades if downgrades else "pass"}

```

### backend\alembic\versions\001_initial_tables.py

```py```
# backend/alembic/versions/001_initial_tables.py
"""initial tables

Revision ID: 001
Revises:
Create Date: 2025-01-01 00:00:00.000000

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '001'
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('users',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('max_id', sa.String(), nullable=False),
    sa.Column('full_name', sa.String(), nullable=False),
    sa.Column('username', sa.String(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_users_id'), 'users', ['id'], unique=False)
    op.create_index(op.f('ix_users_max_id'), 'users', ['max_id'], unique=True)

    op.create_table('projects',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('title', sa.String(), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('hash', sa.String(), nullable=False),
    sa.Column('is_private', sa.Boolean(), nullable=True),
    sa.Column('requires_approval', sa.Boolean(), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_projects_hash'), 'projects', ['hash'], unique=True)
    op.create_index(op.f('ix_projects_id'), 'projects', ['id'], unique=False)

    op.create_table('notifications',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('project_id', sa.Integer(), nullable=True),
    sa.Column('type', sa.String(), nullable=False),
    sa.Column('title', sa.String(), nullable=False),
    sa.Column('message', sa.Text(), nullable=False),
    sa.Column('data', sa.Text(), nullable=True),
    sa.Column('is_read', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_notifications_id'), 'notifications', ['id'], unique=False)

    op.create_table('project_members',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('project_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('role', sa.String(), nullable=True),
    sa.Column('joined_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('project_id', 'user_id', name='unique_project_user')
    )
    op.create_index(op.f('ix_project_members_id'), 'project_members', ['id'], unique=False)

    op.create_table('join_requests',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('project_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('requested_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('processed_by_id', sa.Integer(), nullable=True),
    sa.Column('processed_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['processed_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_join_requests_id'), 'join_requests', ['id'], unique=False)

    op.create_table('tasks',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('title', sa.String(), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('priority', sa.String(), nullable=True),
    sa.Column('project_id', sa.Integer(), nullable=False),
    sa.Column('created_by', sa.Integer(), nullable=False),
    sa.Column('assigned_to_id', sa.Integer(), nullable=True),
    sa.Column('due_date', sa.DateTime(timezone=True), nullable=True),
    sa.Column('parent_task_id', sa.Integer(), nullable=True),
    sa.Column('depends_on_id', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['assigned_to_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['parent_task_id'], ['tasks.id'], ),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_tasks_id'), 'tasks', ['id'], unique=False)

    op.create_table('task_dependencies',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('task_id', sa.Integer(), nullable=False),
    sa.Column('depends_on_id', sa.Integer(), nullable=False),
    sa.ForeignKeyConstraint(['depends_on_id'], ['tasks.id'], ),
    sa.ForeignKeyConstraint(['task_id'], ['tasks.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('task_id', 'depends_on_id', name='unique_task_dependency')
    )
    op.create_index(op.f('ix_task_dependencies_id'), 'task_dependencies', ['id'], unique=False)

    op.create_table('task_assignees',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('task_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.ForeignKeyConstraint(['task_id'], ['tasks.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('task_id', 'user_id', name='unique_task_assignee')
    )
    op.create_index(op.f('ix_task_assignees_id'), 'task_assignees', ['id'], unique=False)

    op.create_table('comments',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('task_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('content', sa.Text(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['task_id'], ['tasks.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_comments_id'), 'comments', ['id'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_comments_id'), table_name='comments')
    op.drop_table('comments')
    op.drop_index(op.f('ix_task_assignees_id'), table_name='task_assignees')
    op.drop_table('task_assignees')
    op.drop_index(op.f('ix_task_dependencies_id'), table_name='task_dependencies')
    op.drop_table('task_dependencies')
    op.drop_index(op.f('ix_tasks_id'), table_name='tasks')
    op.drop_table('tasks')
    op.drop_index(op.f('ix_join_requests_id'), table_name='join_requests')
    op.drop_table('join_requests')
    op.drop_index(op.f('ix_project_members_id'), table_name='project_members')
    op.drop_table('project_members')
    op.drop_index(op.f('ix_notifications_id'), table_name='notifications')
    op.drop_table('notifications')
    op.drop_index(op.f('ix_projects_id'), table_name='projects')
    op.drop_index(op.f('ix_projects_hash'), table_name='projects')
    op.drop_table('projects')
    op.drop_index(op.f('ix_users_max_id'), table_name='users')
    op.drop_index(op.f('ix_users_id'), table_name='users')
    op.drop_table('users')
    # ### end Alembic commands ###

```

### backend\app\__init__.py

```py```
# backend/app/__init__.py
# Ð­Ñ‚Ð¾Ñ‚ Ñ„Ð°Ð¹Ð» Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ñ‹Ð¼ Ð¸Ð»Ð¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð±Ð°Ð·Ð¾Ð²ÑƒÑŽ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ð¿Ð°ÐºÐµÑ‚Ð° app

```

### backend\app\config.py

```py```
# backend/app/config.py
from pydantic_settings import BaseSettings
from typing import Optional

class Settings(BaseSettings):
    DATABASE_URL: str
    SECRET_KEY: str
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
    SITE_URL: str
    BACKEND_API_URL: str # Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ Ð´Ð»Ñ Ð±Ð¾Ñ‚Ð°

    class Config:
        env_file = ".env"

settings = Settings()

```

### backend\app\database.py

```py```
# backend/app/database.py
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine
from sqlalchemy.orm import sessionmaker
from .config import settings

DATABASE_URL = settings.DATABASE_URL

engine = create_async_engine(DATABASE_URL, echo=True)
AsyncSessionLocal = sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)

async def get_db():
    async with AsyncSessionLocal() as session:
        yield session

```

### backend\app\main.py

```py```
# backend/app/main.py
from fastapi import FastAPI
from app.api.auth import router as auth_router
from app.api.users import router as users_router
from app.api.projects import router as projects_router
from app.api.tasks import router as tasks_router
from app.api.notifications import router as notifications_router
from app.models import Base
from app.database import engine
import logging

from fastapi.middleware.cors import CORSMiddleware

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

app = FastAPI(title="MAX Project Pilot API", version="1.0.0")

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "https://vasilkin6666.github.io",  # GitHub Pages
        "https://powerfully-exotic-chamois.cloudpub.ru",  # Ð’Ð°Ñˆ Ð±ÑÐºÐµÐ½Ð´
        "http://localhost:3000",  # Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
        "http://localhost:8000",  # Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð‘Ð”
@app.on_event("startup")
async def startup():
    logger.info("Starting up application...")
    try:
        async with engine.begin() as conn:
            logger.info("Creating database tables...")
            await conn.run_sync(Base.metadata.create_all)
            logger.info("Database tables created successfully")
    except Exception as e:
        logger.error(f"Error creating database tables: {e}")
        raise

# Health check
@app.get("/health")
async def health_check():
    return {"status": "ok", "service": "MAX Project Pilot Backend", "version": "1.0.0"}

# API Health check
@app.get("/api/health")
async def api_health_check():
    return {"status": "ok", "service": "MAX Project Pilot API", "version": "1.0.0"}

# Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ñ€Ð¾ÑƒÑ‚ÐµÑ€Ð¾Ð² Ñ Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÐ¾Ð¼ /api
app.include_router(auth_router, prefix="/api")
app.include_router(users_router, prefix="/api")
app.include_router(projects_router, prefix="/api")
app.include_router(tasks_router, prefix="/api")
app.include_router(notifications_router, prefix="/api")

# Root endpoint
@app.get("/")
async def root():
    return {"message": "MAX Project Pilot API", "version": "1.0.0"}

```

### backend\app\api\__init__.py

```py```
# backend/app/api/__init__.py
# Ð­Ñ‚Ð¾Ñ‚ Ñ„Ð°Ð¹Ð» Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ñ‹Ð¼ Ð¸Ð»Ð¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ð´Ð»Ñ ÑƒÐ´Ð¾Ð±ÑÑ‚Ð²Ð°
# from . import auth, projects, tasks, users, notifications

```

### backend\app\api\auth.py

```py```
# backend/app/api/auth.py
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select
from app.database import get_db
from app.models import User
from app.core.security import create_access_token
from datetime import timedelta
from app.config import settings
from pydantic import BaseModel

router = APIRouter(prefix="/auth", tags=["auth"])

class TokenRequest(BaseModel):
    max_id: str
    full_name: str
    username: str = None

@router.post("/token")
async def login_or_create_user(request: TokenRequest, db: AsyncSession = Depends(get_db)):
    result = await db.execute(select(User).where(User.max_id == request.max_id))
    user = result.scalar_one_or_none()
    if not user:
        user = User(max_id=request.max_id, full_name=request.full_name, username=request.username)
        db.add(user)
        await db.commit()
        await db.refresh(user)

    access_token_expires = timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
    access_token = create_access_token(
        data={"sub": user.max_id}, expires_delta=access_token_expires
    )
    return {"access_token": access_token, "token_type": "bearer", "user": {"id": user.max_id, "full_name": user.full_name}}

```

### backend\app\api\deps.py

```py```
# backend/app/api/deps.py
from fastapi import Depends, HTTPException, status, Header
from sqlalchemy.ext.asyncio import AsyncSession
from app.database import get_db
from app.models import User
from app.core.security import verify_token
from sqlalchemy import select

async def get_current_user(
    authorization: str = Header(..., description="Bearer token"),
    db: AsyncSession = Depends(get_db)
):
    if not authorization.startswith("Bearer "):
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Invalid authorization header",
            headers={"WWW-Authenticate": "Bearer"},
        )

    token = authorization.replace("Bearer ", "")
    user_id = verify_token(token)

    if not user_id:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Could not validate credentials",
            headers={"WWW-Authenticate": "Bearer"},
        )

    result = await db.execute(select(User).where(User.max_id == user_id))
    user = result.scalar_one_or_none()
    if user is None:
        raise HTTPException(status_code=404, detail="User not found")
    return user

```

### backend\app\api\notifications.py

```py```
# backend/app/api/notifications.py
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, update
from app.database import get_db
from app.models import User, Notification
from app.api.deps import get_current_user

router = APIRouter(prefix="/notifications", tags=["notifications"])

@router.get("/")
async def get_user_notifications(
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(
        select(Notification)
        .where(Notification.user_id == current_user.id)
        .order_by(Notification.created_at.desc())
    )
    notifications = result.scalars().all()
    return {"notifications": notifications}

@router.put("/mark_all_read")
async def mark_all_notifications_read(
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    stmt = update(Notification).where(
        Notification.user_id == current_user.id,
        Notification.is_read == False
    ).values(is_read=True)
    await db.execute(stmt)
    await db.commit()
    return {"status": "success", "message": "All notifications marked as read"}

```

### backend\app\api\projects.py

```py```
# backend/app/api/projects.py
from fastapi import APIRouter, Depends, HTTPException, status, Query
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, func, and_, or_
from sqlalchemy.orm import selectinload
from app.database import get_db
from app.models import User, Project, ProjectMember, JoinRequest, Task
from app.api.deps import get_current_user
from app.models.enums import ProjectRole
import secrets
import string

router = APIRouter(prefix="/projects", tags=["projects"])

def generate_invite_hash():
    return ''.join(secrets.choice(string.ascii_lowercase + string.digits) for _ in range(12))

@router.post("/")
async def create_project(
    title: str = Query(..., description="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°"),
    description: str = Query("", description="ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°"),
    is_private: bool = Query(True, description="ÐŸÑ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚"),
    requires_approval: bool = Query(False, description="Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð¾Ð´Ð¾Ð±Ñ€ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð²ÑÑ‚ÑƒÐ¿Ð»ÐµÐ½Ð¸Ñ"),
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    invite_hash = generate_invite_hash()
    project = Project(
        title=title,
        description=description,
        hash=invite_hash,
        is_private=is_private,
        requires_approval=requires_approval,
        created_by=current_user.id
    )
    db.add(project)
    await db.commit()
    await db.refresh(project)

    # Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ ÑÐ¾Ð·Ð´Ð°Ñ‚ÐµÐ»Ñ Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†ÐµÐ¼
    member = ProjectMember(
        project_id=project.id,
        user_id=current_user.id,
        role=ProjectRole.OWNER
    )
    db.add(member)
    await db.commit()

    return {"project": project}

@router.get("/{project_hash}")
async def get_project(
    project_hash: str,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(select(Project).where(Project.hash == project_hash))
    project = result.scalar_one_or_none()
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°: Ð²Ð»Ð°Ð´ÐµÐ»ÐµÑ†, Ð°Ð´Ð¼Ð¸Ð½, ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸Ðº Ð¸Ð»Ð¸ Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹
    membership = await db.execute(
        select(ProjectMember).where(
            ProjectMember.project_id == project.id,
            ProjectMember.user_id == current_user.id
        )
    )
    member = membership.scalar_one_or_none()

    if project.is_private and not member:
        raise HTTPException(status_code=403, detail="Access denied")

    # ÐŸÐ¾Ð´ÑÑ‡ÐµÑ‚ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸
    stats_result = await db.execute(
        select(
            func.count(Task.id).label('total_tasks'),
            func.sum(func.iif(Task.status == 'done', 1, 0)).label('done_tasks'),
            func.sum(func.iif(Task.status == 'in_progress', 1, 0)).label('in_progress_tasks'),
            func.sum(func.iif(Task.status == 'todo', 1, 0)).label('todo_tasks')
        ).where(Task.project_id == project.id)
    )
    stats = stats_result.first()

    return {
        "project": project,
        "members": project.members,
        "stats": {
            "tasks_count": stats.total_tasks or 0,
            "tasks_done": stats.done_tasks or 0,
            "tasks_in_progress": stats.in_progress_tasks or 0,
            "tasks_todo": stats.todo_tasks or 0
        }
    }

@router.post("/{project_hash}/join")
async def join_project_request(
    project_hash: str,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(select(Project).where(Project.hash == project_hash))
    project = result.scalar_one_or_none()
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°, ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÑƒÐ¶Ðµ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð¼
    membership = await db.execute(
        select(ProjectMember).where(
            ProjectMember.project_id == project.id,
            ProjectMember.user_id == current_user.id
        )
    )
    existing_member = membership.scalar_one_or_none()
    if existing_member:
        raise HTTPException(status_code=400, detail="Already a member of this project")

    if not project.requires_approval:
        # ÐŸÑ€ÑÐ¼Ð¾Ðµ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ
        member = ProjectMember(project_id=project.id, user_id=current_user.id, role=ProjectRole.MEMBER)
        db.add(member)
        await db.commit()
        return {"status": "joined", "message": "Successfully joined project"}
    else:
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°, Ð½ÐµÑ‚ Ð»Ð¸ ÑƒÐ¶Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
        existing_request = await db.execute(
            select(JoinRequest).where(
                JoinRequest.project_id == project.id,
                JoinRequest.user_id == current_user.id,
                JoinRequest.status == "pending"
            )
        )
        if existing_request.scalar_one_or_none():
             raise HTTPException(status_code=400, detail="Join request already pending")

        # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ð½Ð° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ
        join_request = JoinRequest(project_id=project.id, user_id=current_user.id)
        db.add(join_request)
        await db.commit()
        return {"status": "pending_approval", "message": "Join request sent for approval"}

@router.get("/{project_hash}/join-requests")
async def get_join_requests(
    project_hash: str,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(select(Project).where(Project.hash == project_hash))
    project = result.scalar_one_or_none()
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    membership = await db.execute(
        select(ProjectMember).where(
            ProjectMember.project_id == project.id,
            ProjectMember.user_id == current_user.id
        )
    )
    member = membership.scalar_one_or_none()
    if not member or member.role not in ["owner", "admin"]:
        raise HTTPException(status_code=403, detail="Access denied")

    result = await db.execute(
        select(JoinRequest)
        .where(JoinRequest.project_id == project.id)
        .options(selectinload(JoinRequest.user))
    )
    requests = result.scalars().all()
    return {"requests": requests}

@router.post("/{project_hash}/join-requests/{request_id}/approve")
async def approve_join_request(
    project_hash: str,
    request_id: int,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(select(Project).where(Project.hash == project_hash))
    project = result.scalar_one_or_none()
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    membership = await db.execute(
        select(ProjectMember).where(
            ProjectMember.project_id == project.id,
            ProjectMember.user_id == current_user.id
        )
    )
    member = membership.scalar_one_or_none()
    if not member or member.role not in [ProjectRole.OWNER, ProjectRole.ADMIN]:
        raise HTTPException(status_code=403, detail="Access denied")

    result = await db.execute(
        select(JoinRequest).where(
            JoinRequest.id == request_id,
            JoinRequest.project_id == project.id,
            JoinRequest.status == "pending"
        )
    )
    join_request = result.scalar_one_or_none()
    if not join_request:
        raise HTTPException(status_code=404, detail="Join request not found")

    # Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ ÐºÐ°Ðº ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ°
    new_member = ProjectMember(project_id=project.id, user_id=join_request.user_id, role=ProjectRole.MEMBER)
    db.add(new_member)

    # ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
    join_request.status = "approved"
    join_request.processed_by_id = current_user.id
    join_request.processed_at = func.now()

    await db.commit()
    return {"status": "success", "message": "Join request approved"}

@router.post("/{project_hash}/join-requests/{request_id}/reject")
async def reject_join_request(
    project_hash: str,
    request_id: int,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(select(Project).where(Project.hash == project_hash))
    project = result.scalar_one_or_none()
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    membership = await db.execute(
        select(ProjectMember).where(
            ProjectMember.project_id == project.id,
            ProjectMember.user_id == current_user.id
        )
    )
    member = membership.scalar_one_or_none()
    if not member or member.role not in [ProjectRole.OWNER, ProjectRole.ADMIN]:
        raise HTTPException(status_code=403, detail="Access denied")

    result = await db.execute(
        select(JoinRequest).where(
            JoinRequest.id == request_id,
            JoinRequest.project_id == project.id,
            JoinRequest.status == "pending"
        )
    )
    join_request = result.scalar_one_or_none()
    if not join_request:
        raise HTTPException(status_code=404, detail="Join request not found")

    # ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
    join_request.status = "rejected"
    join_request.processed_by_id = current_user.id
    join_request.processed_at = func.now()

    await db.commit()
    return {"status": "success", "message": "Join request rejected"}

@router.post("/{project_hash}/regenerate-invite")
async def regenerate_invite(
    project_hash: str,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(select(Project).where(Project.hash == project_hash))
    project = result.scalar_one_or_none()
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    membership = await db.execute(
        select(ProjectMember).where(
            ProjectMember.project_id == project.id,
            ProjectMember.user_id == current_user.id
        )
    )
    member = membership.scalar_one_or_none()
    if not member or member.role not in [ProjectRole.OWNER, ProjectRole.ADMIN]:
        raise HTTPException(status_code=403, detail="Access denied")

    new_hash = generate_invite_hash()
    project.hash = new_hash
    await db.commit()
    return {"status": "success", "new_invite_hash": new_hash}

@router.get("/{project_hash}/summary")
async def get_project_summary(
    project_hash: str,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """Ð­Ð½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÐ²Ð¾Ð´ÐºÐ¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð´Ð»Ñ Ð±Ð¾Ñ‚Ð°"""
    result = await db.execute(select(Project).where(Project.hash == project_hash))
    project = result.scalar_one_or_none()
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ñ‡Ð»ÐµÐ½ÑÑ‚Ð²Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
    membership = await db.execute(
        select(ProjectMember).where(
            ProjectMember.project_id == project.id,
            ProjectMember.user_id == current_user.id
        )
    )
    member = membership.scalar_one_or_none()
    if not member:
        raise HTTPException(status_code=403, detail="Access denied")

    # ÐŸÐ¾Ð´ÑÑ‡ÐµÑ‚ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð° ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²
    members_count_result = await db.execute(
        select(func.count(ProjectMember.id)).where(ProjectMember.project_id == project.id)
    )
    members_count = members_count_result.scalar()

    # ÐŸÐ¾Ð´ÑÑ‡ÐµÑ‚ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð·Ð°Ð´Ð°Ñ‡
    stats_result = await db.execute(
        select(
            func.count(Task.id).label('total_tasks'),
            func.sum(func.iif(Task.status == 'done', 1, 0)).label('done_tasks'),
            func.sum(func.iif(Task.status == 'in_progress', 1, 0)).label('in_progress_tasks'),
            func.sum(func.iif(Task.status == 'todo', 1, 0)).label('todo_tasks')
        ).where(Task.project_id == project.id)
    )
    stats = stats_result.first()

    return {
        "id": project.id,
        "title": project.title,
        "description": project.description,
        "hash": project.hash,
        "is_private": project.is_private,
        "requires_approval": project.requires_approval,
        "members_count": members_count or 0,
        "tasks_count": stats.total_tasks or 0,
        "tasks_todo": stats.todo_tasks or 0,
        "tasks_in_progress": stats.in_progress_tasks or 0,
        "tasks_done": stats.done_tasks or 0,
        "user_role": member.role,
        "can_manage": member.role in [ProjectRole.OWNER, ProjectRole.ADMIN]
    }

```

### backend\app\api\tasks.py

```py```
# backend/app/api/tasks.py
from fastapi import APIRouter, Depends, HTTPException, status, Query
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, and_
from app.database import get_db
from app.models import User, Project, ProjectMember, Task, TaskAssignee, Comment, TaskDependency
from app.api.deps import get_current_user
from app.models.enums import ProjectRole, TaskStatus, TaskPriority

router = APIRouter(prefix="/tasks", tags=["tasks"])

async def check_project_access(project_id: int, user_id: int, db: AsyncSession) -> bool:
    membership = await db.execute(
        select(ProjectMember).where(
            ProjectMember.project_id == project_id,
            ProjectMember.user_id == user_id
        )
    )
    member = membership.scalar_one_or_none()
    return member is not None

async def check_project_manage_access(project_id: int, user_id: int, db: AsyncSession) -> bool:
    membership = await db.execute(
        select(ProjectMember).where(
            ProjectMember.project_id == project_id,
            ProjectMember.user_id == user_id
        )
    )
    member = membership.scalar_one_or_none()
    return member is not None and member.role in [ProjectRole.OWNER, ProjectRole.ADMIN]

@router.get("/")
async def get_tasks(
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(
        select(Task)
        .join(Project)
        .join(ProjectMember, Project.id == ProjectMember.project_id)
        .where(ProjectMember.user_id == current_user.id)
        .order_by(Task.created_at.desc())
    )
    tasks = result.scalars().all()
    return {"tasks": tasks}

@router.get("/project/{project_hash}")
async def get_project_tasks(
    project_hash: str,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(select(Project).where(Project.hash == project_hash))
    project = result.scalar_one_or_none()
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    has_access = await check_project_access(project.id, current_user.id, db)
    if not has_access:
        raise HTTPException(status_code=403, detail="Access denied")

    result = await db.execute(
        select(Task)
        .where(Task.project_id == project.id)
        .order_by(Task.created_at.desc())
    )
    tasks = result.scalars().all()
    return {"tasks": tasks}

@router.post("/")
async def create_task(
    title: str = Query(..., description="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸"),
    project_hash: str = Query(..., description="Ð¥ÑÑˆ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°"),
    description: str = Query("", description="ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸"),
    status: TaskStatus = Query(TaskStatus.TODO, description="Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð·Ð°Ð´Ð°Ñ‡Ð¸"),
    priority: TaskPriority = Query(TaskPriority.MEDIUM, description="ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ Ð·Ð°Ð´Ð°Ñ‡Ð¸"),
    assigned_to_ids: list[int] = Query([], description="ID Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÐµÐ¹"),
    parent_task_id: int = Query(None, description="ID Ñ€Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ð¹ Ð·Ð°Ð´Ð°Ñ‡Ð¸"),
    depends_on_ids: list[int] = Query([], description="ID Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹"),
    due_date: str = Query(None, description="Ð¡Ñ€Ð¾Ðº Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ"),
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(select(Project).where(Project.hash == project_hash))
    project = result.scalar_one_or_none()
    if not project:
        raise HTTPException(status_code=404, detail="Project not found")

    has_access = await check_project_access(project.id, current_user.id, db)
    if not has_access:
        raise HTTPException(status_code=403, detail="Access denied")

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ð¹ Ð·Ð°Ð´Ð°Ñ‡Ð¸
    if parent_task_id:
        parent_task = await db.get(Task, parent_task_id)
        if not parent_task or parent_task.project_id != project.id:
            raise HTTPException(status_code=400, detail="Invalid parent task")

    task = Task(
        title=title,
        description=description,
        status=status,
        priority=priority,
        project_id=project.id,
        created_by=current_user.id,
        parent_task_id=parent_task_id
    )
    if due_date:
        from datetime import datetime
        task.due_date = datetime.fromisoformat(due_date.replace('Z', '+00:00'))

    db.add(task)
    await db.commit()
    await db.refresh(task)

    # ÐÐ°Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ÑŒ Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÐµÐ¹
    for user_id in assigned_to_ids:
        assignee = TaskAssignee(task_id=task.id, user_id=user_id)
        db.add(assignee)

    # Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
    for dep_id in depends_on_ids:
        dependency = TaskDependency(task_id=task.id, depends_on_id=dep_id)
        db.add(dependency)

    await db.commit()
    await db.refresh(task)

    return {"task": task}

@router.put("/{task_id}/status")
async def update_task_status(
    task_id: int,
    status: TaskStatus = Query(..., description="ÐÐ¾Ð²Ñ‹Ð¹ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð·Ð°Ð´Ð°Ñ‡Ð¸"),
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(select(Task).where(Task.id == task_id))
    task = result.scalar_one_or_none()
    if not task:
        raise HTTPException(status_code=404, detail="Task not found")

    has_access = await check_project_access(task.project_id, current_user.id, db)
    if not has_access:
        raise HTTPException(status_code=403, detail="Access denied")

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
    if status == TaskStatus.DONE:
        dependencies = await db.execute(
            select(TaskDependency).where(TaskDependency.task_id == task_id)
        )
        deps = dependencies.scalars().all()

        for dep in deps:
            dependency_task = await db.get(Task, dep.depends_on_id)
            if dependency_task and dependency_task.status != TaskStatus.DONE:
                raise HTTPException(
                    status_code=400,
                    detail=f"Cannot complete task. Dependency '{dependency_task.title}' is not done."
                )

    task.status = status
    await db.commit()
    await db.refresh(task)

    return {"task": task}

@router.get("/{task_id}/dependencies")
async def get_task_dependencies(
    task_id: int,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(select(Task).where(Task.id == task_id))
    task = result.scalar_one_or_none()
    if not task:
        raise HTTPException(status_code=404, detail="Task not found")

    has_access = await check_project_access(task.project_id, current_user.id, db)
    if not has_access:
        raise HTTPException(status_code=403, detail="Access denied")

    # ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
    dependencies = await db.execute(
        select(TaskDependency, Task)
        .join(Task, TaskDependency.depends_on_id == Task.id)
        .where(TaskDependency.task_id == task_id)
    )
    deps = dependencies.all()

    # ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸, Ð·Ð°Ð²Ð¸ÑÑÑ‰Ð¸Ðµ Ð¾Ñ‚ ÑÑ‚Ð¾Ð¹
    dependents = await db.execute(
        select(TaskDependency, Task)
        .join(Task, TaskDependency.task_id == Task.id)
        .where(TaskDependency.depends_on_id == task_id)
    )
    dependent_tasks = dependents.all()

    return {
        "dependencies": [{"id": dep.Task.id, "title": dep.Task.title, "status": dep.Task.status} for dep in deps],
        "dependents": [{"id": dep.Task.id, "title": dep.Task.title, "status": dep.Task.status} for dep in dependent_tasks]
    }

@router.post("/{task_id}/dependencies")
async def add_task_dependency(
    task_id: int,
    depends_on_id: int = Query(..., description="ID Ð·Ð°Ð´Ð°Ñ‡Ð¸, Ð¾Ñ‚ ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¹ Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚"),
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(select(Task).where(Task.id == task_id))
    task = result.scalar_one_or_none()
    if not task:
        raise HTTPException(status_code=404, detail="Task not found")

    result = await db.execute(select(Task).where(Task.id == depends_on_id))
    dependency_task = result.scalar_one_or_none()
    if not dependency_task:
        raise HTTPException(status_code=404, detail="Dependency task not found")

    # ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð¾Ð±Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð² Ð¾Ð´Ð½Ð¾Ð¼ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ
    if task.project_id != dependency_task.project_id:
        raise HTTPException(status_code=400, detail="Tasks must be in the same project")

    has_access = await check_project_access(task.project_id, current_user.id, db)
    if not has_access:
        raise HTTPException(status_code=403, detail="Access denied")

    # ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ†Ð¸ÐºÐ»Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
    if await check_circular_dependency(task_id, depends_on_id, db):
        raise HTTPException(status_code=400, detail="Circular dependency detected")

    dependency = TaskDependency(task_id=task_id, depends_on_id=depends_on_id)
    db.add(dependency)
    await db.commit()

    return {"status": "success", "message": "Dependency added"}

async def check_circular_dependency(task_id: int, depends_on_id: int, db: AsyncSession) -> bool:
    """ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ†Ð¸ÐºÐ»Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹"""
    if task_id == depends_on_id:
        return True

    # Ð ÐµÐºÑƒÑ€ÑÐ¸Ð²Ð½Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
    visited = set()
    stack = [depends_on_id]

    while stack:
        current_id = stack.pop()
        if current_id == task_id:
            return True

        if current_id not in visited:
            visited.add(current_id)
            # ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ Ð·Ð°Ð´Ð°Ñ‡Ð¸
            result = await db.execute(
                select(TaskDependency).where(TaskDependency.task_id == current_id)
            )
            deps = result.scalars().all()
            stack.extend([dep.depends_on_id for dep in deps])

    return False

@router.get("/{task_id}/comments")
async def get_task_comments(
    task_id: int,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(select(Task).where(Task.id == task_id))
    task = result.scalar_one_or_none()
    if not task:
        raise HTTPException(status_code=404, detail="Task not found")

    has_access = await check_project_access(task.project_id, current_user.id, db)
    if not has_access:
        raise HTTPException(status_code=403, detail="Access denied")

    result = await db.execute(
        select(Comment)
        .where(Comment.task_id == task_id)
        .order_by(Comment.created_at.asc())
    )
    comments = result.scalars().all()
    return {"comments": comments}

@router.post("/{task_id}/comments")
async def create_task_comment(
    task_id: int,
    content: str = Query(..., description="Ð¢ÐµÐºÑÑ‚ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ñ"),
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(select(Task).where(Task.id == task_id))
    task = result.scalar_one_or_none()
    if not task:
        raise HTTPException(status_code=404, detail="Task not found")

    has_access = await check_project_access(task.project_id, current_user.id, db)
    if not has_access:
        raise HTTPException(status_code=403, detail="Access denied")

    comment = Comment(task_id=task_id, user_id=current_user.id, content=content)
    db.add(comment)
    await db.commit()
    await db.refresh(comment)

    return {"comment": comment}

@router.delete("/{task_id}")
async def delete_task(
    task_id: int,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    result = await db.execute(select(Task).where(Task.id == task_id))
    task = result.scalar_one_or_none()
    if not task:
        raise HTTPException(status_code=404, detail="Task not found")

    has_manage_access = await check_project_manage_access(task.project_id, current_user.id, db)
    if not has_manage_access:
        if task.created_by != current_user.id:
            raise HTTPException(status_code=403, detail="Access denied")

    await db.execute(TaskAssignee.__table__.delete().where(TaskAssignee.task_id == task.id))
    await db.execute(TaskDependency.__table__.delete().where(
        (TaskDependency.task_id == task_id) | (TaskDependency.depends_on_id == task_id)
    ))
    await db.delete(task)
    await db.commit()
    return {"status": "success", "message": "Task deleted"}

```

### backend\app\api\users.py

```py```
# backend/app/api/users.py
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select
from sqlalchemy.orm import selectinload
from app.database import get_db
from app.models import User, ProjectMember, Project
from app.api.deps import get_current_user

router = APIRouter(prefix="/users", tags=["users"])

@router.get("/me")
async def read_users_me(current_user: User = Depends(get_current_user)):
    return current_user

@router.get("/{user_id}/projects")
async def get_user_projects(
    user_id: str,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    if current_user.max_id != user_id:
        raise HTTPException(status_code=403, detail="Not authorized to view this user's projects")

    result = await db.execute(
        select(ProjectMember)
        .where(ProjectMember.user_id == current_user.id)
        .options(
            selectinload(ProjectMember.project).selectinload(Project.members),
            selectinload(ProjectMember.project).selectinload(Project.tasks)
        )
    )
    memberships = result.scalars().all()

    projects_with_stats = []
    for member in memberships:
        project = member.project
        # ÐŸÐ¾Ð´ÑÑ‡ÐµÑ‚ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð·Ð°Ð´Ð°Ñ‡
        tasks_count = len(project.tasks) if project.tasks else 0
        tasks_done = len([t for t in (project.tasks or []) if t.status == 'done'])
        tasks_in_progress = len([t for t in (project.tasks or []) if t.status == 'in_progress'])
        tasks_todo = len([t for t in (project.tasks or []) if t.status == 'todo'])

        project_data = {
            "id": project.id,
            "title": project.title,
            "description": project.description,
            "hash": project.hash,
            "is_private": project.is_private,
            "requires_approval": project.requires_approval,
            "created_by": project.created_by,
            "created_at": project.created_at,
            "updated_at": project.updated_at,
            "members": [{"user_id": m.user_id, "role": m.role} for m in project.members] if project.members else [],
            "stats": {
                "tasks_count": tasks_count,
                "tasks_done": tasks_done,
                "tasks_in_progress": tasks_in_progress,
                "tasks_todo": tasks_todo
            }
        }

        projects_with_stats.append({
            "project": project_data,
            "role": member.role
        })

    return {"projects": projects_with_stats}

```

### backend\app\core\exceptions.py

```py```
# backend/app/core/exceptions.py
from fastapi import HTTPException, status

class UnauthorizedException(HTTPException):
    def __init__(self, detail="Could not validate credentials"):
        super().__init__(status_code=status.HTTP_401_UNAUTHORIZED, detail=detail)

class ForbiddenException(HTTPException):
    def __init__(self, detail="Access denied"):
        super().__init__(status_code=status.HTTP_403_FORBIDDEN, detail=detail)

class NotFoundException(HTTPException):
    def __init__(self, detail="Item not found"):
        super().__init__(status_code=status.HTTP_404_NOT_FOUND, detail=detail)

class BadRequestException(HTTPException):
    def __init__(self, detail="Bad request"):
        super().__init__(status_code=status.HTTP_400_BAD_REQUEST, detail=detail)

```

### backend\app\core\security.py

```py```
# backend/app/core/security.py
from datetime import datetime, timedelta
from typing import Optional
from jose import JWTError, jwt
from passlib.context import CryptContext
from ..config import settings

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def verify_password(plain_password, hashed_password):
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password):
    return pwd_context.hash(password)

def create_access_token(data: dict, expires_delta: Optional[timedelta] = None):  # Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾: data Ð²Ð¼ÐµÑÑ‚Ð¾ dict
    to_encode = data.copy()
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=15)
    to_encode.update({"exp": expire})
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt

def verify_token(token: str):
    try:
        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
        user_id: str = payload.get("sub")
        if user_id is None:
            return None
        return user_id
    except JWTError:
        return None

```

### backend\app\models\__init__.py

```py```
# backend/app/models/__init__.py
from .base import Base
from .user import User
from .project import Project, ProjectMember, JoinRequest
from .task import Task, TaskAssignee, Comment, TaskDependency
from .notification import Notification
from .enums import ProjectRole, TaskStatus, TaskPriority, NotificationType

__all__ = [
    "Base", "User", "Project", "ProjectMember", "JoinRequest",
    "Task", "TaskAssignee", "Comment", "TaskDependency", "Notification",
    "ProjectRole", "TaskStatus", "TaskPriority", "NotificationType"
]

```

### backend\app\models\base.py

```py```
# backend/app/models/base.py
from sqlalchemy.orm import DeclarativeBase

class Base(DeclarativeBase):
    pass

```

### backend\app\models\enums.py

```py```
# backend/app/models/enums.py
from enum import Enum

class ProjectRole(str, Enum):
    OWNER = "owner"
    ADMIN = "admin"
    MEMBER = "member"
    GUEST = "guest"

class TaskStatus(str, Enum):
    TODO = "todo"
    IN_PROGRESS = "in_progress"
    DONE = "done"

class TaskPriority(str, Enum):
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    URGENT = "urgent"

class NotificationType(str, Enum):
    TASK_CREATED = "task_created"
    TASK_ASSIGNED = "task_assigned"
    TASK_STATUS_CHANGED = "task_status_changed"
    TASK_COMPLETED = "task_completed"
    JOIN_REQUEST = "join_request"
    JOIN_APPROVED = "join_approved"
    JOIN_REJECTED = "join_rejected"
    PROJECT_INVITE = "project_invite"

```

### backend\app\models\notification.py

```py```
# backend/app/models/notification.py
from sqlalchemy import Column, Integer, String, Text, Boolean, ForeignKey, DateTime
from sqlalchemy.orm import relationship
from sqlalchemy.sql import func
from .base import Base
from .enums import NotificationType

class Notification(Base):
    __tablename__ = "notifications"

    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    project_id = Column(Integer, ForeignKey("projects.id"), nullable=True)
    type = Column(String, nullable=False)
    title = Column(String, nullable=False)
    message = Column(Text, nullable=False)
    data = Column(Text, nullable=True)
    is_read = Column(Boolean, default=False)
    created_at = Column(DateTime(timezone=True), server_default=func.now())

    user = relationship("User", back_populates="notifications")
    project = relationship("Project")

```

### backend\app\models\project.py

```py```
# backend/app/models/project.py
from sqlalchemy import Column, Integer, String, Text, Boolean, ForeignKey, DateTime, UniqueConstraint
from sqlalchemy.orm import relationship
from sqlalchemy.sql import func
from .base import Base
from .enums import ProjectRole

class Project(Base):
    __tablename__ = "projects"

    id = Column(Integer, primary_key=True, index=True)
    title = Column(String, nullable=False)
    description = Column(Text, nullable=True)
    hash = Column(String, unique=True, index=True, nullable=False)
    is_private = Column(Boolean, default=True)
    requires_approval = Column(Boolean, default=False)
    created_by = Column(Integer, ForeignKey("users.id"), nullable=False)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())

    owner = relationship("User", back_populates="owned_projects", foreign_keys=[created_by])
    members = relationship("ProjectMember", back_populates="project", cascade="all, delete-orphan")
    tasks = relationship("Task", back_populates="project", cascade="all, delete-orphan")
    join_requests = relationship("JoinRequest", back_populates="project", cascade="all, delete-orphan")

class ProjectMember(Base):
    __tablename__ = "project_members"

    id = Column(Integer, primary_key=True, index=True)
    project_id = Column(Integer, ForeignKey("projects.id"), nullable=False)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    role = Column(String, default=ProjectRole.MEMBER)
    joined_at = Column(DateTime(timezone=True), server_default=func.now())

    project = relationship("Project", back_populates="members")
    user = relationship("User", back_populates="projects")

    __table_args__ = (UniqueConstraint('project_id', 'user_id', name='unique_project_user'),)

class JoinRequest(Base):
    __tablename__ = "join_requests"

    id = Column(Integer, primary_key=True, index=True)
    project_id = Column(Integer, ForeignKey("projects.id"), nullable=False)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    status = Column(String, default="pending")
    requested_at = Column(DateTime(timezone=True), server_default=func.now())
    processed_by_id = Column(Integer, ForeignKey("users.id"), nullable=True)
    processed_at = Column(DateTime(timezone=True), nullable=True)

    project = relationship("Project", back_populates="join_requests")
    user = relationship(
        "User",
        back_populates="join_requests",
        foreign_keys=[user_id]
    )
    processor = relationship(
        "User",
        back_populates="processed_join_requests",
        foreign_keys=[processed_by_id]
    )

```

### backend\app\models\task.py

```py```
# backend/app/models/task.py
from sqlalchemy import Column, Integer, String, Text, Boolean, ForeignKey, DateTime, UniqueConstraint
from sqlalchemy.orm import relationship
from sqlalchemy.sql import func
from .base import Base
from .enums import TaskStatus, TaskPriority

class Task(Base):
    __tablename__ = "tasks"

    id = Column(Integer, primary_key=True, index=True)
    title = Column(String, nullable=False)
    description = Column(Text, nullable=True)
    status = Column(String, default=TaskStatus.TODO)
    priority = Column(String, default=TaskPriority.MEDIUM)
    project_id = Column(Integer, ForeignKey("projects.id"), nullable=False)
    created_by = Column(Integer, ForeignKey("users.id"), nullable=False)
    assigned_to_id = Column(Integer, ForeignKey("users.id"), nullable=True)
    due_date = Column(DateTime(timezone=True), nullable=True)
    parent_task_id = Column(Integer, ForeignKey("tasks.id"), nullable=True)
    depends_on_id = Column(Integer, ForeignKey("tasks.id"), nullable=True)
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())

    project = relationship("Project", back_populates="tasks")
    creator = relationship("User", foreign_keys=[created_by])
    assignee = relationship("User", foreign_keys=[assigned_to_id])

    # ÐžÑ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ñ€Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ð¹ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð¸ Ð¿Ð¾Ð´Ð·Ð°Ð´Ð°Ñ‡
    parent_task = relationship(
        "Task",
        remote_side=[id],
        back_populates="subtasks",
        foreign_keys=[parent_task_id],
        post_update=True
    )
    subtasks = relationship(
        "Task",
        back_populates="parent_task",
        cascade="all, delete-orphan",
        foreign_keys=[parent_task_id],
        post_update=True
    )

    # ÐžÑ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ Ð·Ð°Ð´Ð°Ñ‡
    dependencies = relationship(
        "Task",
        secondary="task_dependencies",
        primaryjoin="Task.id==task_dependencies.c.task_id",
        secondaryjoin="Task.id==task_dependencies.c.depends_on_id",
        backref="dependents"
    )

    assignees = relationship("TaskAssignee", back_populates="task", cascade="all, delete-orphan")
    comments = relationship("Comment", back_populates="task", cascade="all, delete-orphan")

# Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ð´Ð»Ñ Ð¾Ñ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ð¹ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ Ð¼ÐµÐ¶Ð´Ñƒ Ð·Ð°Ð´Ð°Ñ‡Ð°Ð¼Ð¸
class TaskDependency(Base):
    __tablename__ = "task_dependencies"

    id = Column(Integer, primary_key=True, index=True)
    task_id = Column(Integer, ForeignKey("tasks.id"), nullable=False)
    depends_on_id = Column(Integer, ForeignKey("tasks.id"), nullable=False)

    __table_args__ = (UniqueConstraint('task_id', 'depends_on_id', name='unique_task_dependency'),)

class TaskAssignee(Base):
    __tablename__ = "task_assignees"

    id = Column(Integer, primary_key=True, index=True)
    task_id = Column(Integer, ForeignKey("tasks.id"), nullable=False)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)

    task = relationship("Task", back_populates="assignees")
    user = relationship("User")

    __table_args__ = (UniqueConstraint('task_id', 'user_id', name='unique_task_assignee'),)

class Comment(Base):
    __tablename__ = "comments"

    id = Column(Integer, primary_key=True, index=True)
    task_id = Column(Integer, ForeignKey("tasks.id"), nullable=False)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    content = Column(Text, nullable=False)
    created_at = Column(DateTime(timezone=True), server_default=func.now())

    task = relationship("Task", back_populates="comments")
    user = relationship("User")

```

### backend\app\models\user.py

```py```
# backend/app/models/user.py
from sqlalchemy import Column, Integer, String, DateTime, Boolean
from sqlalchemy.orm import relationship
from sqlalchemy.sql import func
from .base import Base

class User(Base):
    __tablename__ = "users"

    id = Column(Integer, primary_key=True, index=True)
    max_id = Column(String, unique=True, index=True, nullable=False)
    full_name = Column(String, nullable=False)
    username = Column(String, nullable=True)
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())

    # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¾Ñ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ñ Ñ ÑÐ²Ð½Ñ‹Ð¼ ÑƒÐºÐ°Ð·Ð°Ð½Ð¸ÐµÐ¼ foreign_keys
    owned_projects = relationship("Project", back_populates="owner", foreign_keys="Project.created_by")
    projects = relationship("ProjectMember", back_populates="user")

    # Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð¾Ñ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ñ Ð´Ð»Ñ join_requests
    join_requests = relationship(
        "JoinRequest",
        back_populates="user",
        foreign_keys="JoinRequest.user_id"
    )
    processed_join_requests = relationship(
        "JoinRequest",
        back_populates="processor",
        foreign_keys="JoinRequest.processed_by_id"
    )

    notifications = relationship("Notification", back_populates="user")

```

### bot\Dockerfile

```txt```
# bot/Dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["python", "-m", "app.bot"]

```

### bot\folder_structure.txt

```txt```
# Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ð°Ð¿ÐºÐ¸: E:\GUAP\max_project_pilot\bot

## Ð”ÐµÑ€ÐµÐ²Ð¾ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ð¾Ð²

```
bot/
  Dockerfile
  app/
    __init__.py
    bot.py
    config.py
    handlers/
      __init__.py
      notifications.py
      projects.py
      start.py
    services/
      __init__.py
      api_client.py
    utils.py
  requirements.txt
```

## Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð²

### Dockerfile

```txt```
# bot/Dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["python", "-m", "app.bot"]

```

### requirements.txt

```txt```
maxapi==0.9.7
requests==2.32.3
python-dotenv==1.0.1
loguru==0.7.2
aiohttp>=3.12.14
pydantic-settings>=2.0.0
pydantic>=2.0.0

```

### app\__init__.py

```py```
# bot/app/__init__.py
# Ð­Ñ‚Ð¾Ñ‚ Ñ„Ð°Ð¹Ð» Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ñ‹Ð¼ Ð¸Ð»Ð¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð±Ð°Ð·Ð¾Ð²ÑƒÑŽ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ð¿Ð°ÐºÐµÑ‚Ð° app

```

### app\bot.py

```py```
# bot/app/bot.py
import asyncio
from maxapi import Bot, Dispatcher, F
from maxapi.types import MessageCreated, MessageCallback
from maxapi.filters.command import Command

from app.config import settings
from app.handlers import (
    cmd_start, cmd_create_project, cmd_join_project,
    handle_callback_create_project_start,
    handle_callback_projects,
    handle_callback_project_summary,
    handle_callback_project_invite,
    handle_callback_project_requests,
    handle_callback_notifications
)

bot = Bot(token=settings.BOT_TOKEN)
dp = Dispatcher()

@dp.message_created(Command('start'))
async def handle_start(event: MessageCreated):
    await cmd_start(event)

@dp.message_created(Command('create_project'))
async def handle_create_project(event: MessageCreated):
    await cmd_create_project(event)

@dp.message_created(Command('join'))
async def handle_join_project(event: MessageCreated):
    await cmd_join_project(event)

@dp.message_callback(F.callback.payload.startswith("projects"))
async def handle_projects_callback(event: MessageCallback):
    await handle_callback_projects(event)

@dp.message_callback(F.callback.payload.startswith("project_summary:"))
async def handle_project_summary_callback(event: MessageCallback):
    await handle_callback_project_summary(event)

@dp.message_callback(F.callback.payload.startswith("project_invite:"))
async def handle_project_invite_callback(event: MessageCallback):
    await handle_callback_project_invite(event)

@dp.message_callback(F.callback.payload.startswith("project_requests:"))
async def handle_project_requests_callback(event: MessageCallback):
    await handle_callback_project_requests(event)

@dp.message_callback(F.callback.payload.startswith("notifications"))
async def handle_notifications_callback(event: MessageCallback):
    await handle_callback_notifications(event)

@dp.message_callback(F.callback.payload.startswith("create_project_start"))
async def handle_create_start_callback(event: MessageCallback):
    await handle_callback_create_project_start(event)

async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())

```

### app\config.py

```py```
# bot/app/config.py
from pydantic_settings import BaseSettings
from dotenv import load_dotenv

load_dotenv()

class Settings(BaseSettings):
    BOT_TOKEN: str
    BACKEND_API_URL: str
    SITE_URL: str = "http://localhost:3000"  # Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑÑ‚Ñƒ ÑÑ‚Ñ€Ð¾ÐºÑƒ

    class Config:
        env_file = ".env"

settings = Settings()

```

### app\utils.py

```py```
# bot/app/utils.py
import secrets
import string

def generate_invite_hash():
    return ''.join(secrets.choice(string.ascii_lowercase + string.digits) for _ in range(12))

```

### app\handlers\__init__.py

```py```
# bot/app/handlers/__init__.py
from .start import cmd_start
from .projects import (
    cmd_create_project, cmd_join_project,
    handle_callback_create_project_start,
    handle_callback_projects,
    handle_callback_project_summary,
    handle_callback_project_invite,
    handle_callback_project_requests
)
from .notifications import handle_callback_notifications

__all__ = [
    "cmd_start",
    "cmd_create_project",
    "cmd_join_project",
    "handle_callback_create_project_start",
    "handle_callback_projects",
    "handle_callback_project_summary",
    "handle_callback_project_invite",
    "handle_callback_project_requests",
    "handle_callback_notifications"
]

```

### app\handlers\notifications.py

```py```
# bot/app/handlers/notifications.py
from maxapi.types import MessageCallback, CallbackButton
from maxapi.utils.inline_keyboard import InlineKeyboardBuilder
from app.services.api_client import APIClient
from app.config import settings

api_client = APIClient()

async def handle_callback_notifications(event: MessageCallback):
    user_id = str(event.from_user.user_id)
    data = await api_client.get_user_notifications(user_id)
    notifications = data.get("notifications", [])

    if not notifications:
        text = "ðŸ“­ Ð£ Ð²Ð°Ñ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹.\nÐÐ¾Ð²Ñ‹Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¿Ð¾ÑÐ²ÑÑ‚ÑÑ Ð·Ð´ÐµÑÑŒ, ÐºÐ¾Ð³Ð´Ð° Ð² Ð²Ð°ÑˆÐ¸Ñ… Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ñ… Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾Ð¹Ð´ÐµÑ‚!"
    else:
        text = "ðŸ”” **ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ:**\n"
        for i, notification in enumerate(notifications[:5], 1):
            emoji = "ðŸ”µ" if not notification.get("is_read") else "âšª"
            text += f"{emoji} **{notification.get('title', '')}**\n"
            text += f"{notification.get('message', '')}\n"
            text += "\n"

    builder = InlineKeyboardBuilder()
    web_app_url = f"{settings.SITE_URL}/?user_id={event.from_user.user_id}#notifications"
    builder.row(CallbackButton(text="ðŸŒ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ", payload=f"open_webapp:{web_app_url}"))
    builder.row(CallbackButton(text="ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ", payload="notifications"))

    await event.bot.edit_message(
        message_id=event.message.body.mid,
        text=text,
        attachments=[builder.as_markup()]
    )

```

### app\handlers\projects.py

```py```
# bot/app/handlers/projects.py
from maxapi.types import MessageCreated, MessageCallback, CallbackButton
from maxapi.utils.inline_keyboard import InlineKeyboardBuilder
from maxapi.filters.command import Command
from app.services.api_client import APIClient
from app.utils import generate_invite_hash
from app.config import settings
import re

api_client = APIClient()

async def cmd_create_project(event: MessageCreated):
    builder = InlineKeyboardBuilder()
    builder.row(CallbackButton(text="ðŸ“ ÐÐ°Ñ‡Ð°Ñ‚ÑŒ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ", payload="create_project_start"))
    await event.message.answer("ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÑƒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°.", attachments=[builder.as_markup()])

async def handle_callback_create_project_start(event: MessageCallback):
    user_id = str(event.from_user.user_id)
    web_app_url = f"{settings.SITE_URL}/?user_id={user_id}#projects"
    await event.message.answer(f"Ð”Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð¿ÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ: {web_app_url}")

async def cmd_join_project(event: MessageCreated):
    user_id = str(event.from_user.user_id)
    full_name = event.from_user.full_name or "ÐÐ½Ð¾Ð½Ð¸Ð¼"
    text = event.message.body.text.strip()

    parts = text.split(" ", 1)
    if len(parts) < 2:
        await event.message.answer("ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ñ…ÑÑˆ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°. ÐŸÑ€Ð¸Ð¼ÐµÑ€: /join abc123def456")
        return

    project_hash = parts[1]
    if len(project_hash) != 12 or not re.match(r'^[a-z0-9]+$', project_hash):
        await event.message.answer("ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ñ…ÑÑˆÐ° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°. Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ 12 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð² (a-z, 0-9).")
        return

    result = await api_client.request_join_project(project_hash, user_id, full_name)
    if result.get("status") == "joined":
        await event.message.answer("âœ… Ð’Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ð»Ð¸ÑÑŒ Ðº Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñƒ!")
    elif result.get("message") == "Join request sent for approval":
        await event.message.answer("ðŸ“¥ Ð—Ð°Ð¿Ñ€Ð¾Ñ Ð½Ð° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½ Ð½Ð° Ð¾Ð´Ð¾Ð±Ñ€ÐµÐ½Ð¸Ðµ!")
    elif result.get("message") == "Already a member of this project":
        await event.message.answer("âŒ Ð’Ñ‹ ÑƒÐ¶Ðµ ÑÐ²Ð»ÑÐµÑ‚ÐµÑÑŒ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð¼ ÑÑ‚Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°.")
    else:
        await event.message.answer(f"âŒ {result.get('message', 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°')}")

async def handle_callback_projects(event: MessageCallback):
    user_id = str(event.from_user.user_id)
    full_name = event.from_user.full_name or "ÐÐ½Ð¾Ð½Ð¸Ð¼"
    projects_data = await api_client.get_user_projects(user_id)

    if not projects_data:
        text = "ðŸ“‚ Ð£ Ð²Ð°Ñ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð². Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð²!"
    else:
        text = "ðŸ“‚ **Ð’Ð°ÑˆÐ¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹:**\n"
        for i, member in enumerate(projects_data[:5], 1):
            project = member.get("project", {})
            role_emoji = {"owner": "ðŸ‘‘", "admin": "âš¡", "member": "ðŸ‘¤"}.get(member.get("role"), "ðŸ‘¤")
            tasks_count = len(project.get("tasks", []))
            text += f"{i}. {role_emoji} **{project.get('title', 'Ð‘ÐµÐ· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ')}**\n"
            text += f"ðŸ“‹ {tasks_count} Ð·Ð°Ð´Ð°Ñ‡ | ðŸ‘¥ {len(project.get('members', []))} ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²\n"
            text += f"ðŸ”— Ð¥ÑÑˆ: `{project.get('hash', '')}`\n\n"

    builder = InlineKeyboardBuilder()
    for i, member in enumerate(projects_data[:5], 1):
        project = member.get("project", {})
        if member.get("role") in ["owner", "admin"]:
            builder.row(
                CallbackButton(text=f"ðŸ” {i} - ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ", payload=f"project_summary:{project.get('hash')}"),
                CallbackButton(text=f"ðŸ”— {i} - ÐŸÑ€Ð¸Ð³Ð»Ð°ÑÐ¸Ñ‚ÑŒ", payload=f"project_invite:{project.get('hash')}")
            )

    web_app_url = f"{settings.SITE_URL}/?user_id={user_id}"
    builder.row(CallbackButton(text="ðŸŒ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ", payload=f"open_webapp:{web_app_url}"))
    builder.row(CallbackButton(text="ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ", payload="projects"))

    await event.bot.edit_message(
        message_id=event.message.body.mid,
        text=text,
        attachments=[builder.as_markup()]
    )

async def handle_callback_project_summary(event: MessageCallback):
    parts = event.callback.payload.split(":", 1)
    if len(parts) != 2:
        await event.answer(notification="âŒ ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°")
        return

    project_hash = parts[1]
    user_id = str(event.from_user.user_id)
    full_name = event.from_user.full_name or "ÐÐ½Ð¾Ð½Ð¸Ð¼"

    summary = await api_client.get_project_summary(project_hash, user_id, full_name)
    if not summary:
        await event.answer(notification="âŒ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ")
        return

    text = (
        f"ðŸš€ **{summary['title']}**\n"
        f"{summary['description'] or 'ðŸ“ Ð‘ÐµÐ· Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ'}\n"
        f"ðŸ“Š **Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°:**\n"
        f"â€¢ ðŸ‘¥ Ð£Ñ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²: {summary['members_count']}\n"
        f"â€¢ ðŸ“‹ Ð’ÑÐµÐ³Ð¾ Ð·Ð°Ð´Ð°Ñ‡: {summary['tasks_count']}\n"
        f"â€¢ â³ Ðš Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÑŽ: {summary['tasks_todo']}\n"
        f"â€¢ ðŸ”§ Ð’ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ: {summary['tasks_in_progress']}\n"
        f"â€¢ âœ… Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾: {summary['tasks_done']}\n"
        f"ðŸ” {'ðŸ”’ ÐŸÑ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹' if summary['is_private'] else 'ðŸŒ ÐŸÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹'}\n"
        f"ðŸ“‹ {'âœ… ÐžÐ´Ð¾Ð±Ñ€ÐµÐ½Ð¸Ðµ Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ' if not summary['requires_approval'] else 'â³ Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð¾Ð´Ð¾Ð±Ñ€ÐµÐ½Ð¸Ðµ'}\n"
        f"ðŸ‘¤ Ð’Ð°ÑˆÐ° Ñ€Ð¾Ð»ÑŒ: {summary['user_role']}"
    )

    builder = InlineKeyboardBuilder()
    web_app_url = f"{settings.SITE_URL}/?user_id={user_id}#project={project_hash}"
    builder.row(CallbackButton(text="ðŸŒ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ", payload=f"open_webapp:{web_app_url}"))

    if summary.get('can_manage'):
        builder.row(CallbackButton(text="ðŸ”— ÐŸÑ€Ð¸Ð³Ð»Ð°ÑÐ¸Ñ‚ÑŒ", payload=f"project_invite:{project_hash}"))
        builder.row(CallbackButton(text="ðŸ“‹ Ð—Ð°ÑÐ²ÐºÐ¸", payload=f"project_requests:{project_hash}"))

    builder.row(CallbackButton(text="ðŸ“‹ ÐœÐ¾Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹", payload="projects"))

    await event.bot.edit_message(
        message_id=event.message.body.mid,
        text=text,
        attachments=[builder.as_markup()]
    )

async def handle_callback_project_invite(event: MessageCallback):
    parts = event.callback.payload.split(":", 1)
    if len(parts) != 2:
        await event.answer(notification="âŒ ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°")
        return

    project_hash = parts[1]
    invite_link = f"{settings.SITE_URL}/join/{project_hash}"
    text = f"ðŸ”— **ÐŸÑ€Ð¸Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ðµ Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚**\nÐŸÑ€Ð¾ÐµÐºÑ‚: **{project_hash}**\nÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ ÑÑ‚Ñƒ ÑÑÑ‹Ð»ÐºÑƒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼:\n`{invite_link}`\nÐ˜Ð»Ð¸ Ð¿Ð¾Ð´ÐµÐ»Ð¸Ñ‚ÐµÑÑŒ Ñ…ÑÑˆÐµÐ¼ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°:\n`{project_hash}`"

    builder = InlineKeyboardBuilder()
    builder.row(CallbackButton(text="ðŸ“‹ ÐœÐ¾Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹", payload="projects"))

    await event.bot.edit_message(
        message_id=event.message.body.mid,
        text=text,
        attachments=[builder.as_markup()]
    )

async def handle_callback_project_requests(event: MessageCallback):
    parts = event.callback.payload.split(":", 1)
    if len(parts) != 2:
        await event.answer(notification="âŒ ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°")
        return

    project_hash = parts[1]
    user_id = str(event.from_user.user_id)
    full_name = event.from_user.full_name or "ÐÐ½Ð¾Ð½Ð¸Ð¼"

    data = await api_client.get_project_join_requests(project_hash, user_id, full_name)
    requests = data.get("requests", [])

    if not requests:
        text = "ðŸ“‹ **Ð—Ð°ÑÐ²ÐºÐ¸ Ð½Ð° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ**\n\nÐÐµÑ‚ Ð¾Ð¶Ð¸Ð´Ð°ÑŽÑ‰Ð¸Ñ… Ð·Ð°ÑÐ²Ð¾Ðº."
    else:
        text = "ðŸ“‹ **Ð—Ð°ÑÐ²ÐºÐ¸ Ð½Ð° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ**\n\n"
        for i, req in enumerate(requests, 1):
            user = req.get("user", {})
            text += f"{i}. {user.get('full_name', 'ÐÐ½Ð¾Ð½Ð¸Ð¼')} (ID: {user.get('max_id')})\n"
            text += f"Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: {req.get('status', 'pending')}\n"
            text += f"Ð”Ð°Ñ‚Ð°: {req.get('requested_at', 'N/A')}\n"
            text += f"---\n"

    builder = InlineKeyboardBuilder()
    builder.row(CallbackButton(text="ðŸ“‹ ÐœÐ¾Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹", payload="projects"))

    await event.bot.edit_message(
        message_id=event.message.body.mid,
        text=text,
        attachments=[builder.as_markup()]
    )

```

### app\handlers\start.py

```py```
# bot/app/handlers/start.py
from maxapi.types import MessageCreated, CallbackButton
from maxapi.utils.inline_keyboard import InlineKeyboardBuilder
from app.services.api_client import APIClient
from app.config import settings

api_client = APIClient()

async def cmd_start(event: MessageCreated):
    user_id = str(event.from_user.user_id)
    full_name = event.from_user.full_name or "ÐÐ½Ð¾Ð½Ð¸Ð¼"

    builder = InlineKeyboardBuilder()
    web_app_url = f"{settings.SITE_URL}/?user_id={user_id}"
    builder.row(CallbackButton(text="ðŸŒ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ", payload=f"open_webapp:{web_app_url}"))
    builder.row(CallbackButton(text="ðŸ“‹ ÐœÐ¾Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹", payload="projects"))
    builder.row(CallbackButton(text="ðŸ”” Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ", payload="notifications"))

    await event.message.answer(
        text=f"ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚, {full_name}!\n"
             f"ðŸš€ **MAX Project Pilot**\n"
             f"Ð£Ð¿Ñ€Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ð¼Ð¸ Ñ‡ÐµÑ€ÐµÐ· Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¸Ð»Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ð¹Ñ‚Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð·Ð´ÐµÑÑŒ!\n"
             f"ðŸ’¡ **ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹:**\n"
             f"â€¢ /create_project - Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚\n"
             f"â€¢ /join <Ñ…ÑÑˆ> - ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑŒÑÑ Ðº Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñƒ\n"
             f"â€¢ /help - ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ",
        attachments=[builder.as_markup()]
    )

```

### app\services\__init__.py

```py```
# bot/app/services/__init__.py
# Ð­Ñ‚Ð¾Ñ‚ Ñ„Ð°Ð¹Ð» Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ñ‹Ð¼ Ð¸Ð»Ð¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð±Ð°Ð·Ð¾Ð²ÑƒÑŽ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ð¿Ð°ÐºÐµÑ‚Ð° services
# Ð¸Ð»Ð¸ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ð´Ð»Ñ ÑƒÐ´Ð¾Ð±ÑÑ‚Ð²Ð°
# from .api_client import APIClient

```

### app\services\api_client.py

```py```
# bot/app/services/api_client.py
import aiohttp
from app.config import settings
from loguru import logger
import json

class APIClient:
    def __init__(self):
        self.base_url = settings.BACKEND_API_URL

    async def get_user_projects(self, user_id: str):
        url = f"{self.base_url}/users/{user_id}/projects"
        try:
            async with aiohttp.ClientSession() as session:
                async with session.get(url) as response:
                    if response.status == 200:
                        data = await response.json()
                        return data.get("projects", [])
                    else:
                        logger.error(f"API Error: {response.status}")
                        return []
        except Exception as e:
            logger.error(f"Network error: {e}")
            return []

    async def create_project(self, user_id: str, full_name: str, title: str, description: str = ""):
        url = f"{self.base_url}/auth/token"
        token_data = {"max_id": user_id, "full_name": full_name}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(url, json=token_data) as response:
                    if response.status == 200:
                        token_response = await response.json()
                        access_token = token_response.get("access_token")
                        if access_token:
                            return await self._create_project_with_token(title, description, access_token)
        except Exception as e:
            logger.error(f"Error getting token: {e}")
        return None

    async def _create_project_with_token(self, title: str, description: str, token: str):
        url = f"{self.base_url}/projects/"
        headers = {"Authorization": f"Bearer {token}", "Content-Type": "application/json"}
        data = {"title": title, "description": description}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(url, json=data, headers=headers) as response:
                    if response.status == 200:
                        project_data = await response.json()
                        return project_data.get("project")
        except Exception as e:
            logger.error(f"Error creating project: {e}")
        return None

    async def get_project_by_hash(self, project_hash: str):
        # ÐŸÑ€ÐµÐ´Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ð¼, ÐµÑÑ‚ÑŒ ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð¿Ð¾ Ñ…ÑÑˆÑƒ Ð±ÐµÐ· Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸
        # Ð¸Ð»Ð¸ Ñ Ñ‚Ð¾ÐºÐµÐ½Ð¾Ð¼ Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†Ð°, Ñ‡Ñ‚Ð¾ ÑÐ»Ð¾Ð¶Ð½Ð¾ Ð² Ð±Ð¾Ñ‚Ðµ. Ð ÐµÐ°Ð»Ð¸Ð·ÑƒÐµÐ¼ ÐºÐ°Ðº Ð²Ñ‹Ð·Ð¾Ð² Ð¸Ð· Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ.
        # Ð’ Ð±Ð¾Ñ‚Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ join.
        # Ð˜Ð»Ð¸ Ð±Ð¾Ñ‚ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¾ÐºÐµÐ½ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ.
        # Ð”Ð»Ñ ÑƒÐ¿Ñ€Ð¾Ñ‰ÐµÐ½Ð¸Ñ, Ð¿ÑƒÑÑ‚ÑŒ Ð±Ð¾Ñ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ñ‚Ð¾ÐºÐµÐ½ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°.
        # ÐŸÐ¾ÐºÐ° Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð·Ð°Ð³Ð»ÑƒÑˆÐºÑƒ.
        pass

    async def request_join_project(self, project_hash: str, user_id: str, full_name: str):
        # Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ñ‚Ð¾ÐºÐµÐ½
        token_url = f"{self.base_url}/auth/token"
        token_data = {"max_id": user_id, "full_name": full_name}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(token_url, json=token_data) as response:
                    if response.status == 200:
                        token_response = await response.json()
                        access_token = token_response.get("access_token")
                        if access_token:
                            return await self._request_join_with_token(project_hash, access_token)
        except Exception as e:
            logger.error(f"Error getting token for join: {e}")
        return {"status": "error", "message": "Failed to get token"}

    async def _request_join_with_token(self, project_hash: str, token: str):
        url = f"{self.base_url}/projects/{project_hash}/join"
        headers = {"Authorization": f"Bearer {token}", "Content-Type": "application/json"}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(url, headers=headers) as response:
                    if response.status == 200:
                        return await response.json()
                    elif response.status == 404:
                        return {"status": "error", "message": "Project not found"}
                    elif response.status == 400:
                        error_json = await response.json()
                        return {"status": "error", "message": error_json.get("detail", "Already a member")}
        except Exception as e:
            logger.error(f"Error requesting join: {e}")
        return {"status": "error", "message": "Failed to join project"}

    async def get_user_notifications(self, user_id: str):
        # ÐÐ½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ð¾, Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ñ‚Ð¾ÐºÐµÐ½ Ð¸ Ð·Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÐ¼ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ
        token_url = f"{self.base_url}/auth/token"
        token_data = {"max_id": user_id, "full_name": "Anonymous"} # Ð˜Ð¼Ñ Ð½Ðµ Ð²Ð°Ð¶Ð½Ð¾ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ñ‚Ð¾ÐºÐµÐ½Ð°
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(token_url, json=token_data) as response:
                    if response.status == 200:
                        token_response = await response.json()
                        access_token = token_response.get("access_token")
                        if access_token:
                            return await self._get_notifications_with_token(access_token)
        except Exception as e:
            logger.error(f"Error getting token for notifications: {e}")
        return {"notifications": []}

    async def get_project_summary(self, project_hash: str, user_id: str, full_name: str):
        """ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÐ²Ð¾Ð´ÐºÐ¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð´Ð»Ñ Ð±Ð¾Ñ‚Ð°"""
        token_url = f"{self.base_url}/auth/token"
        token_data = {"max_id": user_id, "full_name": full_name}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(token_url, json=token_data) as response:
                    if response.status == 200:
                        token_response = await response.json()
                        access_token = token_response.get("access_token")
                        if access_token:
                            return await self._get_project_summary_with_token(project_hash, access_token)
        except Exception as e:
            logger.error(f"Error getting token for project summary: {e}")
        return None

    async def _get_project_summary_with_token(self, project_hash: str, token: str):
        url = f"{self.base_url}/projects/{project_hash}/summary"
        headers = {"Authorization": f"Bearer {token}", "Content-Type": "application/json"}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.get(url, headers=headers) as response:
                    if response.status == 200:
                        return await response.json()
        except Exception as e:
            logger.error(f"Error getting project summary: {e}")
        return None

    async def get_project_join_requests(self, project_hash: str, user_id: str, full_name: str):
        """ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð½Ð° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ðº Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñƒ"""
        token_url = f"{self.base_url}/auth/token"
        token_data = {"max_id": user_id, "full_name": full_name}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(token_url, json=token_data) as response:
                    if response.status == 200:
                        token_response = await response.json()
                        access_token = token_response.get("access_token")
                        if access_token:
                            return await self._get_project_join_requests_with_token(project_hash, access_token)
        except Exception as e:
            logger.error(f"Error getting token for join requests: {e}")
        return {"requests": []}

    async def _get_project_join_requests_with_token(self, project_hash: str, token: str):
        url = f"{self.base_url}/projects/{project_hash}/join-requests"
        headers = {"Authorization": f"Bearer {token}", "Content-Type": "application/json"}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.get(url, headers=headers) as response:
                    if response.status == 200:
                        return await response.json()
        except Exception as e:
            logger.error(f"Error getting join requests: {e}")
        return {"requests": []}

    async def approve_join_request(self, project_hash: str, request_id: int, user_id: str, full_name: str):
        """ÐžÐ´Ð¾Ð±Ñ€ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ð½Ð° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ"""
        token_url = f"{self.base_url}/auth/token"
        token_data = {"max_id": user_id, "full_name": full_name}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(token_url, json=token_data) as response:
                    if response.status == 200:
                        token_response = await response.json()
                        access_token = token_response.get("access_token")
                        if access_token:
                            return await self._approve_join_request_with_token(project_hash, request_id, access_token)
        except Exception as e:
            logger.error(f"Error getting token for approve: {e}")
        return {"status": "error", "message": "Failed to approve"}

    async def _approve_join_request_with_token(self, project_hash: str, request_id: int, token: str):
        url = f"{self.base_url}/projects/{project_hash}/join-requests/{request_id}/approve"
        headers = {"Authorization": f"Bearer {token}", "Content-Type": "application/json"}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(url, headers=headers) as response:
                    if response.status == 200:
                        return await response.json()
        except Exception as e:
            logger.error(f"Error approving join request: {e}")
        return {"status": "error", "message": "Failed to approve"}

    async def reject_join_request(self, project_hash: str, request_id: int, user_id: str, full_name: str):
        """ÐžÑ‚ÐºÐ»Ð¾Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ð½Ð° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ"""
        token_url = f"{self.base_url}/auth/token"
        token_data = {"max_id": user_id, "full_name": full_name}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(token_url, json=token_data) as response:
                    if response.status == 200:
                        token_response = await response.json()
                        access_token = token_response.get("access_token")
                        if access_token:
                            return await self._reject_join_request_with_token(project_hash, request_id, access_token)
        except Exception as e:
            logger.error(f"Error getting token for reject: {e}")
        return {"status": "error", "message": "Failed to reject"}

    async def _reject_join_request_with_token(self, project_hash: str, request_id: int, token: str):
        url = f"{self.base_url}/projects/{project_hash}/join-requests/{request_id}/reject"
        headers = {"Authorization": f"Bearer {token}", "Content-Type": "application/json"}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(url, headers=headers) as response:
                    if response.status == 200:
                        return await response.json()
        except Exception as e:
            logger.error(f"Error rejecting join request: {e}")
        return {"status": "error", "message": "Failed to reject"}

```


```

### bot\requirements.txt

```txt```
maxapi==0.9.7
requests==2.32.3
python-dotenv==1.0.1
loguru==0.7.2
aiohttp>=3.12.14
pydantic-settings>=2.0.0
pydantic>=2.0.0

```

### bot\app\__init__.py

```py```
# bot/app/__init__.py
# Ð­Ñ‚Ð¾Ñ‚ Ñ„Ð°Ð¹Ð» Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ñ‹Ð¼ Ð¸Ð»Ð¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð±Ð°Ð·Ð¾Ð²ÑƒÑŽ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ð¿Ð°ÐºÐµÑ‚Ð° app

```

### bot\app\bot.py

```py```
# bot/app/bot.py
import asyncio
from maxapi import Bot, Dispatcher, F
from maxapi.types import MessageCreated, MessageCallback
from maxapi.filters.command import Command

from app.config import settings
from app.handlers import (
    cmd_start, cmd_create_project, cmd_join_project,
    handle_callback_create_project_start,
    handle_callback_projects,
    handle_callback_project_summary,
    handle_callback_project_invite,
    handle_callback_project_requests,
    handle_callback_notifications
)

bot = Bot(token=settings.BOT_TOKEN)
dp = Dispatcher()

@dp.message_created(Command('start'))
async def handle_start(event: MessageCreated):
    await cmd_start(event)

@dp.message_created(Command('create_project'))
async def handle_create_project(event: MessageCreated):
    await cmd_create_project(event)

@dp.message_created(Command('join'))
async def handle_join_project(event: MessageCreated):
    await cmd_join_project(event)

@dp.message_callback(F.callback.payload.startswith("projects"))
async def handle_projects_callback(event: MessageCallback):
    await handle_callback_projects(event)

@dp.message_callback(F.callback.payload.startswith("project_summary:"))
async def handle_project_summary_callback(event: MessageCallback):
    await handle_callback_project_summary(event)

@dp.message_callback(F.callback.payload.startswith("project_invite:"))
async def handle_project_invite_callback(event: MessageCallback):
    await handle_callback_project_invite(event)

@dp.message_callback(F.callback.payload.startswith("project_requests:"))
async def handle_project_requests_callback(event: MessageCallback):
    await handle_callback_project_requests(event)

@dp.message_callback(F.callback.payload.startswith("notifications"))
async def handle_notifications_callback(event: MessageCallback):
    await handle_callback_notifications(event)

@dp.message_callback(F.callback.payload.startswith("create_project_start"))
async def handle_create_start_callback(event: MessageCallback):
    await handle_callback_create_project_start(event)

async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())

```

### bot\app\config.py

```py```
# bot/app/config.py
from pydantic_settings import BaseSettings
from dotenv import load_dotenv

load_dotenv()

class Settings(BaseSettings):
    BOT_TOKEN: str
    BACKEND_API_URL: str
    SITE_URL: str = "https://vasilkin6666.github.io/max_project_pilot/web"  # ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾

    class Config:
        env_file = ".env"

settings = Settings()

```

### bot\app\utils.py

```py```
# bot/app/utils.py
import secrets
import string

def generate_invite_hash():
    return ''.join(secrets.choice(string.ascii_lowercase + string.digits) for _ in range(12))

```

### bot\app\handlers\__init__.py

```py```
# bot/app/handlers/__init__.py
from .start import cmd_start
from .projects import (
    cmd_create_project, cmd_join_project,
    handle_callback_create_project_start,
    handle_callback_projects,
    handle_callback_project_summary,
    handle_callback_project_invite,
    handle_callback_project_requests
)
from .notifications import handle_callback_notifications

__all__ = [
    "cmd_start",
    "cmd_create_project",
    "cmd_join_project",
    "handle_callback_create_project_start",
    "handle_callback_projects",
    "handle_callback_project_summary",
    "handle_callback_project_invite",
    "handle_callback_project_requests",
    "handle_callback_notifications"
]

```

### bot\app\handlers\notifications.py

```py```
# bot/app/handlers/notifications.py
from maxapi.types import MessageCallback, CallbackButton
from maxapi.utils.inline_keyboard import InlineKeyboardBuilder
from app.services.api_client import APIClient
from app.config import settings

api_client = APIClient()

async def handle_callback_notifications(event: MessageCallback):
    user_id = str(event.from_user.user_id)
    data = await api_client.get_user_notifications(user_id)
    notifications = data.get("notifications", [])

    if not notifications:
        text = "ðŸ“­ Ð£ Ð²Ð°Ñ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹.\nÐÐ¾Ð²Ñ‹Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¿Ð¾ÑÐ²ÑÑ‚ÑÑ Ð·Ð´ÐµÑÑŒ, ÐºÐ¾Ð³Ð´Ð° Ð² Ð²Ð°ÑˆÐ¸Ñ… Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ñ… Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾Ð¹Ð´ÐµÑ‚!"
    else:
        text = "ðŸ”” **ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ:**\n"
        for i, notification in enumerate(notifications[:5], 1):
            emoji = "ðŸ”µ" if not notification.get("is_read") else "âšª"
            text += f"{emoji} **{notification.get('title', '')}**\n"
            text += f"{notification.get('message', '')}\n"
            text += "\n"

    builder = InlineKeyboardBuilder()
    web_app_url = f"{settings.SITE_URL}/?user_id={event.from_user.user_id}#notifications"
    builder.row(CallbackButton(text="ðŸŒ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ", payload=f"open_webapp:{web_app_url}"))
    builder.row(CallbackButton(text="ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ", payload="notifications"))

    await event.bot.edit_message(
        message_id=event.message.body.mid,
        text=text,
        attachments=[builder.as_markup()]
    )

```

### bot\app\handlers\projects.py

```py```
# bot/app/handlers/projects.py
from maxapi.types import MessageCreated, MessageCallback, CallbackButton
from maxapi.utils.inline_keyboard import InlineKeyboardBuilder
from maxapi.filters.command import Command
from app.services.api_client import APIClient
from app.utils import generate_invite_hash
from app.config import settings
import re

api_client = APIClient()

async def cmd_create_project(event: MessageCreated):
    builder = InlineKeyboardBuilder()
    builder.row(CallbackButton(text="ðŸ“ ÐÐ°Ñ‡Ð°Ñ‚ÑŒ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ", payload="create_project_start"))
    await event.message.answer("ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÑƒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°.", attachments=[builder.as_markup()])

async def handle_callback_create_project_start(event: MessageCallback):
    user_id = str(event.from_user.user_id)
    web_app_url = f"{settings.SITE_URL}/?user_id={user_id}#projects"
    await event.message.answer(f"Ð”Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð¿ÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ: {web_app_url}")

async def cmd_join_project(event: MessageCreated):
    user_id = str(event.from_user.user_id)
    full_name = event.from_user.full_name or "ÐÐ½Ð¾Ð½Ð¸Ð¼"
    text = event.message.body.text.strip()

    parts = text.split(" ", 1)
    if len(parts) < 2:
        await event.message.answer("ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ñ…ÑÑˆ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°. ÐŸÑ€Ð¸Ð¼ÐµÑ€: /join abc123def456")
        return

    project_hash = parts[1]
    if len(project_hash) != 12 or not re.match(r'^[a-z0-9]+$', project_hash):
        await event.message.answer("ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ñ…ÑÑˆÐ° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°. Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ 12 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð² (a-z, 0-9).")
        return

    result = await api_client.request_join_project(project_hash, user_id, full_name)
    if result.get("status") == "joined":
        await event.message.answer("âœ… Ð’Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ð»Ð¸ÑÑŒ Ðº Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñƒ!")
    elif result.get("message") == "Join request sent for approval":
        await event.message.answer("ðŸ“¥ Ð—Ð°Ð¿Ñ€Ð¾Ñ Ð½Ð° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½ Ð½Ð° Ð¾Ð´Ð¾Ð±Ñ€ÐµÐ½Ð¸Ðµ!")
    elif result.get("message") == "Already a member of this project":
        await event.message.answer("âŒ Ð’Ñ‹ ÑƒÐ¶Ðµ ÑÐ²Ð»ÑÐµÑ‚ÐµÑÑŒ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð¼ ÑÑ‚Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°.")
    else:
        await event.message.answer(f"âŒ {result.get('message', 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°')}")

async def handle_callback_projects(event: MessageCallback):
    user_id = str(event.from_user.user_id)
    full_name = event.from_user.full_name or "ÐÐ½Ð¾Ð½Ð¸Ð¼"
    projects_data = await api_client.get_user_projects(user_id)

    if not projects_data:
        text = "ðŸ“‚ Ð£ Ð²Ð°Ñ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð². Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð²!"
    else:
        text = "ðŸ“‚ **Ð’Ð°ÑˆÐ¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹:**\n"
        for i, member in enumerate(projects_data[:5], 1):
            project = member.get("project", {})
            role_emoji = {"owner": "ðŸ‘‘", "admin": "âš¡", "member": "ðŸ‘¤"}.get(member.get("role"), "ðŸ‘¤")
            tasks_count = len(project.get("tasks", []))
            text += f"{i}. {role_emoji} **{project.get('title', 'Ð‘ÐµÐ· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ')}**\n"
            text += f"ðŸ“‹ {tasks_count} Ð·Ð°Ð´Ð°Ñ‡ | ðŸ‘¥ {len(project.get('members', []))} ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²\n"
            text += f"ðŸ”— Ð¥ÑÑˆ: `{project.get('hash', '')}`\n\n"

    builder = InlineKeyboardBuilder()
    for i, member in enumerate(projects_data[:5], 1):
        project = member.get("project", {})
        if member.get("role") in ["owner", "admin"]:
            builder.row(
                CallbackButton(text=f"ðŸ” {i} - ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ", payload=f"project_summary:{project.get('hash')}"),
                CallbackButton(text=f"ðŸ”— {i} - ÐŸÑ€Ð¸Ð³Ð»Ð°ÑÐ¸Ñ‚ÑŒ", payload=f"project_invite:{project.get('hash')}")
            )

    web_app_url = f"{settings.SITE_URL}/?user_id={user_id}"
    builder.row(CallbackButton(text="ðŸŒ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ", payload=f"open_webapp:{web_app_url}"))
    builder.row(CallbackButton(text="ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ", payload="projects"))

    await event.bot.edit_message(
        message_id=event.message.body.mid,
        text=text,
        attachments=[builder.as_markup()]
    )

async def handle_callback_project_summary(event: MessageCallback):
    parts = event.callback.payload.split(":", 1)
    if len(parts) != 2:
        await event.answer(notification="âŒ ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°")
        return

    project_hash = parts[1]
    user_id = str(event.from_user.user_id)
    full_name = event.from_user.full_name or "ÐÐ½Ð¾Ð½Ð¸Ð¼"

    summary = await api_client.get_project_summary(project_hash, user_id, full_name)
    if not summary:
        await event.answer(notification="âŒ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ")
        return

    text = (
        f"ðŸš€ **{summary['title']}**\n"
        f"{summary['description'] or 'ðŸ“ Ð‘ÐµÐ· Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ'}\n"
        f"ðŸ“Š **Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°:**\n"
        f"â€¢ ðŸ‘¥ Ð£Ñ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²: {summary['members_count']}\n"
        f"â€¢ ðŸ“‹ Ð’ÑÐµÐ³Ð¾ Ð·Ð°Ð´Ð°Ñ‡: {summary['tasks_count']}\n"
        f"â€¢ â³ Ðš Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÑŽ: {summary['tasks_todo']}\n"
        f"â€¢ ðŸ”§ Ð’ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ: {summary['tasks_in_progress']}\n"
        f"â€¢ âœ… Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾: {summary['tasks_done']}\n"
        f"ðŸ” {'ðŸ”’ ÐŸÑ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹' if summary['is_private'] else 'ðŸŒ ÐŸÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹'}\n"
        f"ðŸ“‹ {'âœ… ÐžÐ´Ð¾Ð±Ñ€ÐµÐ½Ð¸Ðµ Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ' if not summary['requires_approval'] else 'â³ Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð¾Ð´Ð¾Ð±Ñ€ÐµÐ½Ð¸Ðµ'}\n"
        f"ðŸ‘¤ Ð’Ð°ÑˆÐ° Ñ€Ð¾Ð»ÑŒ: {summary['user_role']}"
    )

    builder = InlineKeyboardBuilder()
    web_app_url = f"{settings.SITE_URL}/?user_id={user_id}#project={project_hash}"
    builder.row(CallbackButton(text="ðŸŒ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ", payload=f"open_webapp:{web_app_url}"))

    if summary.get('can_manage'):
        builder.row(CallbackButton(text="ðŸ”— ÐŸÑ€Ð¸Ð³Ð»Ð°ÑÐ¸Ñ‚ÑŒ", payload=f"project_invite:{project_hash}"))
        builder.row(CallbackButton(text="ðŸ“‹ Ð—Ð°ÑÐ²ÐºÐ¸", payload=f"project_requests:{project_hash}"))

    builder.row(CallbackButton(text="ðŸ“‹ ÐœÐ¾Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹", payload="projects"))

    await event.bot.edit_message(
        message_id=event.message.body.mid,
        text=text,
        attachments=[builder.as_markup()]
    )

async def handle_callback_project_invite(event: MessageCallback):
    parts = event.callback.payload.split(":", 1)
    if len(parts) != 2:
        await event.answer(notification="âŒ ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°")
        return

    project_hash = parts[1]
    invite_link = f"{settings.SITE_URL}/join/{project_hash}"
    text = f"ðŸ”— **ÐŸÑ€Ð¸Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ðµ Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚**\nÐŸÑ€Ð¾ÐµÐºÑ‚: **{project_hash}**\nÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ ÑÑ‚Ñƒ ÑÑÑ‹Ð»ÐºÑƒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼:\n`{invite_link}`\nÐ˜Ð»Ð¸ Ð¿Ð¾Ð´ÐµÐ»Ð¸Ñ‚ÐµÑÑŒ Ñ…ÑÑˆÐµÐ¼ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°:\n`{project_hash}`"

    builder = InlineKeyboardBuilder()
    builder.row(CallbackButton(text="ðŸ“‹ ÐœÐ¾Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹", payload="projects"))

    await event.bot.edit_message(
        message_id=event.message.body.mid,
        text=text,
        attachments=[builder.as_markup()]
    )

async def handle_callback_project_requests(event: MessageCallback):
    parts = event.callback.payload.split(":", 1)
    if len(parts) != 2:
        await event.answer(notification="âŒ ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°")
        return

    project_hash = parts[1]
    user_id = str(event.from_user.user_id)
    full_name = event.from_user.full_name or "ÐÐ½Ð¾Ð½Ð¸Ð¼"

    data = await api_client.get_project_join_requests(project_hash, user_id, full_name)
    requests = data.get("requests", [])

    if not requests:
        text = "ðŸ“‹ **Ð—Ð°ÑÐ²ÐºÐ¸ Ð½Ð° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ**\n\nÐÐµÑ‚ Ð¾Ð¶Ð¸Ð´Ð°ÑŽÑ‰Ð¸Ñ… Ð·Ð°ÑÐ²Ð¾Ðº."
    else:
        text = "ðŸ“‹ **Ð—Ð°ÑÐ²ÐºÐ¸ Ð½Ð° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ**\n\n"
        for i, req in enumerate(requests, 1):
            user = req.get("user", {})
            text += f"{i}. {user.get('full_name', 'ÐÐ½Ð¾Ð½Ð¸Ð¼')} (ID: {user.get('max_id')})\n"
            text += f"Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: {req.get('status', 'pending')}\n"
            text += f"Ð”Ð°Ñ‚Ð°: {req.get('requested_at', 'N/A')}\n"
            text += f"---\n"

    builder = InlineKeyboardBuilder()
    builder.row(CallbackButton(text="ðŸ“‹ ÐœÐ¾Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹", payload="projects"))

    await event.bot.edit_message(
        message_id=event.message.body.mid,
        text=text,
        attachments=[builder.as_markup()]
    )

```

### bot\app\handlers\start.py

```py```
# bot/app/handlers/start.py
from maxapi.types import MessageCreated, CallbackButton
from maxapi.utils.inline_keyboard import InlineKeyboardBuilder
from app.services.api_client import APIClient
from app.config import settings

api_client = APIClient()

async def cmd_start(event: MessageCreated):
    user_id = str(event.from_user.user_id)
    full_name = event.from_user.full_name or "ÐÐ½Ð¾Ð½Ð¸Ð¼"

    builder = InlineKeyboardBuilder()
    web_app_url = f"{settings.SITE_URL}/?user_id={user_id}"
    builder.row(CallbackButton(text="ðŸŒ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ", payload=f"open_webapp:{web_app_url}"))
    builder.row(CallbackButton(text="ðŸ“‹ ÐœÐ¾Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹", payload="projects"))
    builder.row(CallbackButton(text="ðŸ”” Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ", payload="notifications"))

    await event.message.answer(
        text=f"ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚, {full_name}!\n"
             f"ðŸš€ **MAX Project Pilot**\n"
             f"Ð£Ð¿Ñ€Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ð¼Ð¸ Ñ‡ÐµÑ€ÐµÐ· Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¸Ð»Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ð¹Ñ‚Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð·Ð´ÐµÑÑŒ!\n"
             f"ðŸ’¡ **ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹:**\n"
             f"â€¢ /create_project - Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚\n"
             f"â€¢ /join <Ñ…ÑÑˆ> - ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑŒÑÑ Ðº Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñƒ\n"
             f"â€¢ /help - ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ",
        attachments=[builder.as_markup()]
    )

```

### bot\app\services\__init__.py

```py```
# bot/app/services/__init__.py
# Ð­Ñ‚Ð¾Ñ‚ Ñ„Ð°Ð¹Ð» Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ñ‹Ð¼ Ð¸Ð»Ð¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð±Ð°Ð·Ð¾Ð²ÑƒÑŽ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ð¿Ð°ÐºÐµÑ‚Ð° services
# Ð¸Ð»Ð¸ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ð´Ð»Ñ ÑƒÐ´Ð¾Ð±ÑÑ‚Ð²Ð°
# from .api_client import APIClient

```

### bot\app\services\api_client.py

```py```
# bot/app/services/api_client.py
import aiohttp
from app.config import settings
from loguru import logger
import json

class APIClient:
    def __init__(self):
        self.base_url = settings.BACKEND_API_URL.rstrip('/')

    async def get_user_projects(self, user_id: str):
        url = f"{self.base_url}/users/{user_id}/projects"
        try:
            async with aiohttp.ClientSession() as session:
                async with session.get(url) as response:
                    if response.status == 200:
                        data = await response.json()
                        return data.get("projects", [])
                    else:
                        logger.error(f"API Error: {response.status} for URL: {url}")
                        return []
        except Exception as e:
            logger.error(f"Network error: {e}")
            return []

    async def create_project(self, user_id: str, full_name: str, title: str, description: str = ""):
        url = f"{self.base_url}/auth/token"
        token_data = {"max_id": user_id, "full_name": full_name}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(url, json=token_data) as response:
                    if response.status == 200:
                        token_response = await response.json()
                        access_token = token_response.get("access_token")
                        if access_token:
                            return await self._create_project_with_token(title, description, access_token)
        except Exception as e:
            logger.error(f"Error getting token: {e}")
        return None

    async def _create_project_with_token(self, title: str, description: str, token: str):
        url = f"{self.base_url}/projects/"
        headers = {"Authorization": f"Bearer {token}", "Content-Type": "application/json"}
        data = {"title": title, "description": description}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(url, json=data, headers=headers) as response:
                    if response.status == 200:
                        project_data = await response.json()
                        return project_data.get("project")
        except Exception as e:
            logger.error(f"Error creating project: {e}")
        return None

    async def get_project_by_hash(self, project_hash: str):
        # ÐŸÑ€ÐµÐ´Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ð¼, ÐµÑÑ‚ÑŒ ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð¿Ð¾ Ñ…ÑÑˆÑƒ Ð±ÐµÐ· Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸
        # Ð¸Ð»Ð¸ Ñ Ñ‚Ð¾ÐºÐµÐ½Ð¾Ð¼ Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†Ð°, Ñ‡Ñ‚Ð¾ ÑÐ»Ð¾Ð¶Ð½Ð¾ Ð² Ð±Ð¾Ñ‚Ðµ. Ð ÐµÐ°Ð»Ð¸Ð·ÑƒÐµÐ¼ ÐºÐ°Ðº Ð²Ñ‹Ð·Ð¾Ð² Ð¸Ð· Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ.
        # Ð’ Ð±Ð¾Ñ‚Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ join.
        # Ð˜Ð»Ð¸ Ð±Ð¾Ñ‚ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¾ÐºÐµÐ½ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ.
        # Ð”Ð»Ñ ÑƒÐ¿Ñ€Ð¾Ñ‰ÐµÐ½Ð¸Ñ, Ð¿ÑƒÑÑ‚ÑŒ Ð±Ð¾Ñ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ñ‚Ð¾ÐºÐµÐ½ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°.
        # ÐŸÐ¾ÐºÐ° Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð·Ð°Ð³Ð»ÑƒÑˆÐºÑƒ.
        pass

    async def request_join_project(self, project_hash: str, user_id: str, full_name: str):
        # Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ñ‚Ð¾ÐºÐµÐ½
        token_url = f"{self.base_url}/auth/token"
        token_data = {"max_id": user_id, "full_name": full_name}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(token_url, json=token_data) as response:
                    if response.status == 200:
                        token_response = await response.json()
                        access_token = token_response.get("access_token")
                        if access_token:
                            return await self._request_join_with_token(project_hash, access_token)
        except Exception as e:
            logger.error(f"Error getting token for join: {e}")
        return {"status": "error", "message": "Failed to get token"}

    async def _request_join_with_token(self, project_hash: str, token: str):
        url = f"{self.base_url}/projects/{project_hash}/join"
        headers = {"Authorization": f"Bearer {token}"}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(url, headers=headers) as response:
                    if response.status == 200:
                        return await response.json()
                    elif response.status == 404:
                        return {"status": "error", "message": "Project not found"}
                    elif response.status == 400:
                        error_json = await response.json()
                        return {"status": "error", "message": error_json.get("detail", "Already a member")}
        except Exception as e:
            logger.error(f"Error requesting join: {e}")
        return {"status": "error", "message": "Failed to join project"}

    async def get_user_notifications(self, user_id: str):
        # ÐÐ½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ð¾, Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ñ‚Ð¾ÐºÐµÐ½ Ð¸ Ð·Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÐ¼ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ
        token_url = f"{self.base_url}/auth/token"
        token_data = {"max_id": user_id, "full_name": "Anonymous"}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(token_url, json=token_data) as response:
                    if response.status == 200:
                        token_response = await response.json()
                        access_token = token_response.get("access_token")
                        if access_token:
                            return await self._get_notifications_with_token(access_token)
        except Exception as e:
            logger.error(f"Error getting token for notifications: {e}")
        return {"notifications": []}

    async def _get_notifications_with_token(self, token: str):
        url = f"{self.base_url}/notifications/"
        headers = {"Authorization": f"Bearer {token}"}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.get(url, headers=headers) as response:
                    if response.status == 200:
                        return await response.json()
        except Exception as e:
            logger.error(f"Error getting notifications: {e}")
        return {"notifications": []}

    async def get_project_summary(self, project_hash: str, user_id: str, full_name: str):
        """ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÐ²Ð¾Ð´ÐºÐ¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð´Ð»Ñ Ð±Ð¾Ñ‚Ð°"""
        token_url = f"{self.base_url}/auth/token"
        token_data = {"max_id": user_id, "full_name": full_name}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(token_url, json=token_data) as response:
                    if response.status == 200:
                        token_response = await response.json()
                        access_token = token_response.get("access_token")
                        if access_token:
                            return await self._get_project_summary_with_token(project_hash, access_token)
        except Exception as e:
            logger.error(f"Error getting token for project summary: {e}")
        return None

    async def _get_project_summary_with_token(self, project_hash: str, token: str):
        url = f"{self.base_url}/projects/{project_hash}/summary"
        headers = {"Authorization": f"Bearer {token}"}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.get(url, headers=headers) as response:
                    if response.status == 200:
                        return await response.json()
        except Exception as e:
            logger.error(f"Error getting project summary: {e}")
        return None

    async def get_project_join_requests(self, project_hash: str, user_id: str, full_name: str):
        """ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð½Ð° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ðº Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñƒ"""
        token_url = f"{self.base_url}/auth/token"
        token_data = {"max_id": user_id, "full_name": full_name}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(token_url, json=token_data) as response:
                    if response.status == 200:
                        token_response = await response.json()
                        access_token = token_response.get("access_token")
                        if access_token:
                            return await self._get_project_join_requests_with_token(project_hash, access_token)
        except Exception as e:
            logger.error(f"Error getting token for join requests: {e}")
        return {"requests": []}

    async def _get_project_join_requests_with_token(self, project_hash: str, token: str):
        url = f"{self.base_url}/projects/{project_hash}/join-requests"
        headers = {"Authorization": f"Bearer {token}"}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.get(url, headers=headers) as response:
                    if response.status == 200:
                        return await response.json()
        except Exception as e:
            logger.error(f"Error getting join requests: {e}")
        return {"requests": []}

    async def approve_join_request(self, project_hash: str, request_id: int, user_id: str, full_name: str):
        """ÐžÐ´Ð¾Ð±Ñ€ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ð½Ð° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ"""
        token_url = f"{self.base_url}/auth/token"
        token_data = {"max_id": user_id, "full_name": full_name}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(token_url, json=token_data) as response:
                    if response.status == 200:
                        token_response = await response.json()
                        access_token = token_response.get("access_token")
                        if access_token:
                            return await self._approve_join_request_with_token(project_hash, request_id, access_token)
        except Exception as e:
            logger.error(f"Error getting token for approve: {e}")
        return {"status": "error", "message": "Failed to approve"}

    async def _approve_join_request_with_token(self, project_hash: str, request_id: int, token: str):
        url = f"{self.base_url}/projects/{project_hash}/join-requests/{request_id}/approve"
        headers = {"Authorization": f"Bearer {token}", "Content-Type": "application/json"}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(url, headers=headers) as response:
                    if response.status == 200:
                        return await response.json()
        except Exception as e:
            logger.error(f"Error approving join request: {e}")
        return {"status": "error", "message": "Failed to approve"}

    async def reject_join_request(self, project_hash: str, request_id: int, user_id: str, full_name: str):
        """ÐžÑ‚ÐºÐ»Ð¾Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ð½Ð° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ"""
        token_url = f"{self.base_url}/auth/token"
        token_data = {"max_id": user_id, "full_name": full_name}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(token_url, json=token_data) as response:
                    if response.status == 200:
                        token_response = await response.json()
                        access_token = token_response.get("access_token")
                        if access_token:
                            return await self._reject_join_request_with_token(project_hash, request_id, access_token)
        except Exception as e:
            logger.error(f"Error getting token for reject: {e}")
        return {"status": "error", "message": "Failed to reject"}

    async def _reject_join_request_with_token(self, project_hash: str, request_id: int, token: str):
        url = f"{self.base_url}/projects/{project_hash}/join-requests/{request_id}/reject"
        headers = {"Authorization": f"Bearer {token}", "Content-Type": "application/json"}
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(url, headers=headers) as response:
                    if response.status == 200:
                        return await response.json()
        except Exception as e:
            logger.error(f"Error rejecting join request: {e}")
        return {"status": "error", "message": "Failed to reject"}

```

### web\README.md

```md```
# MAX Project Pilot - Web App

Ð­Ñ‚Ð¾ ÑÑ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð²ÐµÐ±-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ (Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ MAX), ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð²Ð·Ð°Ð¸Ð¼Ð¾Ð´ÐµÐ¹ÑÑ‚Ð²ÑƒÐµÑ‚ Ñ API Ð²Ð°ÑˆÐµÐ³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°.

## ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸

- Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ð¼Ð¸ Ð¸ Ð·Ð°Ð´Ð°Ñ‡Ð°Ð¼Ð¸.
- Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð¼ÐµÑÑÐµÐ½Ð´Ð¶ÐµÑ€Ð¾Ð¼ MAX.
- Ð¢ÐµÐ¼Ð½Ð°Ñ/ÑÐ²ÐµÑ‚Ð»Ð°Ñ Ñ‚ÐµÐ¼Ð°.

## Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°

- `index.html` - Ð¾ÑÐ½Ð¾Ð²Ð½Ð°Ñ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ð°.
- `css/style.css` - ÑÑ‚Ð¸Ð»Ð¸.
- `js/main.js` - Ð¾ÑÐ½Ð¾Ð²Ð½Ð°Ñ Ð»Ð¾Ð³Ð¸ÐºÐ°.
- `js/api.js` - Ð²Ñ‹Ð·Ð¾Ð²Ñ‹ API.
- `js/auth.js` - Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ.
- `js/dashboard.js` - Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´.
- `js/projects.js` - Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹.
- `js/tasks.js` - Ð·Ð°Ð´Ð°Ñ‡Ð¸.

## Ð”ÐµÐ¿Ð»Ð¾Ð¹

Ð¤Ð°Ð¹Ð»Ñ‹ ÑÑ‚Ð¾Ð³Ð¾ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ð° Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð½Ð° GitHub Pages Ð¸Ð»Ð¸ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ ÑÑ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ñ…Ð¾ÑÑ‚Ð¸Ð½Ð³.

```

### web\index.html

```html```
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAX Project Pilot - Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ð¼Ð¸</title>
    <script src="https://st.max.ru/js/max-web-app.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-4">
        <header class="max-header mb-4">
            <div class="row align-items-center">
                <div class="col">
                    <h4 class="mb-1"><i class="fas fa-rocket"></i> Project Pilot</h4>
                    <p class="mb-0 small opacity-85">Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ð¼Ð¸ Ð² MAX</p>
                </div>
                <div class="col-auto">
                    <div id="user-info" class="d-flex align-items-center">
                        <div class="user-avatar" id="user-avatar">U</div>
                        <div id="user-name">Ð“Ð¾ÑÑ‚ÑŒ</div>
                    </div>
                    <button id="theme-toggle" class="btn btn-sm btn-outline-secondary ms-2">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Ð¡ÐµÐºÑ†Ð¸Ñ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸ -->
        <div id="authSection" class="auth-section">
            <h5 class="mb-3">ðŸ” Ð’Ñ…Ð¾Ð´ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ</h5>
            <p class="text-muted mb-3">Ð”Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸ÐµÐ¼ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒÑÑ</p>
            <div class="mb-3">
                <label for="userIdInput" class="form-label">Ð’Ð°Ñˆ User ID:</label>
                <input type="text" class="form-control" id="userIdInput" placeholder="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ User ID">
                <div class="form-text">User ID Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð² Ð±Ð¾Ñ‚Ðµ @max_project_pilot_bot ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾Ð¹ /start</div>
            </div>
            <button class="btn max-btn-primary w-100 mb-2" onclick="login()"><i class="fas fa-sign-in-alt"></i> Ð’Ð¾Ð¹Ñ‚Ð¸</button>
            <div class="mt-3">
                <small class="text-muted">ÐÐµÑ‚ User ID? <a href="https://t.me/max_project_pilot_bot" target="_blank" class="text-primary">ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð² Ð±Ð¾Ñ‚Ðµ</a></small>
            </div>
        </div>

        <!-- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ (ÑÐºÑ€Ñ‹Ñ‚ Ð´Ð¾ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸) -->
        <div id="mainInterface" style="display: none;">
            <!-- ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ -->
            <ul class="nav nav-tabs nav-tabs-max nav-justified mb-4">
                <li class="nav-item">
                    <a class="nav-link active" href="#" onclick="showSection('dashboard')"><i class="fas fa-home"></i><span class="d-none d-md-inline"> Ð“Ð»Ð°Ð²Ð½Ð°Ñ</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('projects')"><i class="fas fa-project-diagram"></i><span class="d-none d-md-inline"> ÐŸÑ€Ð¾ÐµÐºÑ‚Ñ‹</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('tasks')"><i class="fas fa-tasks"></i><span class="d-none d-md-inline"> Ð—Ð°Ð´Ð°Ñ‡Ð¸</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('notifications')"><i class="fas fa-bell"></i><span class="d-none d-md-inline"> Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ</span></a>
                </li>
            </ul>

            <!-- Ð¡ÐµÐºÑ†Ð¸Ñ: Ð“Ð»Ð°Ð²Ð½Ð°Ñ -->
            <div id="dashboard" class="section active">
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="max-card p-3 text-center">
                            <h5 id="projects-count">0</h5>
                            <p class="text-muted mb-0">ÐŸÑ€Ð¾ÐµÐºÑ‚Ð¾Ð²</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="max-card p-3 text-center">
                            <h5 id="tasks-todo-count">0</h5>
                            <p class="text-muted mb-0">Ðš Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÑŽ</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="max-card p-3 text-center">
                            <h5 id="tasks-progress-count">0</h5>
                            <p class="text-muted mb-0">Ð’ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="max-card p-3 text-center">
                            <h5 id="tasks-done-count">0</h5>
                            <p class="text-muted mb-0">Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾</p>
                        </div>
                    </div>
                </div>
                <div class="max-card p-4">
                    <h6 class="mb-3">ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð²</h6>
                    <div id="dashboard-projects-list">
                        <!-- Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÑ‚ÑÑ -->
                    </div>
                </div>
            </div>

            <!-- Ð¡ÐµÐºÑ†Ð¸Ñ: ÐŸÑ€Ð¾ÐµÐºÑ‚Ñ‹ -->
            <div id="projects" class="section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="mb-0">ÐœÐ¾Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹</h6>
                    <button class="btn max-btn-primary btn-sm" onclick="createProject()"><i class="fas fa-plus"></i> ÐÐ¾Ð²Ñ‹Ð¹</button>
                </div>
                <div id="projects-list">
                    <div class="loading"><i class="fas fa-spinner fa-spin"></i> Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð²...</div>
                </div>
            </div>

            <!-- Ð¡ÐµÐºÑ†Ð¸Ñ: Ð—Ð°Ð´Ð°Ñ‡Ð¸ -->
            <div id="tasks" class="section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="mb-0">Ð’ÑÐµ Ð·Ð°Ð´Ð°Ñ‡Ð¸</h6>
                    <div>
                        <button class="btn max-btn-primary btn-sm me-2" onclick="loadTasks('todo')"><i class="fas fa-hourglass-start"></i> Ðš Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÑŽ</button>
                        <button class="btn max-btn-primary btn-sm me-2" onclick="loadTasks('in_progress')"><i class="fas fa-cogs"></i> Ð’ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ</button>
                        <button class="btn max-btn-primary btn-sm" onclick="loadTasks('done')"><i class="fas fa-check-circle"></i> Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾</button>
                    </div>
                </div>
                <div class="input-group mb-3">
                    <input type="text" id="searchTasksInput" class="form-control" placeholder="ÐŸÐ¾Ð¸ÑÐº Ð·Ð°Ð´Ð°Ñ‡...">
                    <button class="btn btn-outline-secondary" type="button" onclick="searchTasks()"><i class="fas fa-search"></i></button>
                </div>
                <div id="tasks-list">
                    <div class="loading"><i class="fas fa-spinner fa-spin"></i> Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð·Ð°Ð´Ð°Ñ‡...</div>
                </div>
            </div>

            <!-- Ð¡ÐµÐºÑ†Ð¸Ñ: Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ -->
            <div id="notifications" class="section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="mb-0">Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ</h6>
                    <button class="btn btn-outline-secondary btn-sm" onclick="markAllNotificationsRead()"><i class="fas fa-check-double"></i> ÐŸÑ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Ð²ÑÐµ</button>
                </div>
                <div id="notifications-list">
                    <div class="loading"><i class="fas fa-spinner fa-spin"></i> Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹...</div>
                </div>
            </div>
        </div>

        <!-- ÐœÐ¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Ð´Ð»Ñ Ð·Ð°Ð´Ð°Ñ‡Ð¸ -->
        <div class="modal fade" id="taskModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="taskModalTitle">Ð—Ð°Ð´Ð°Ñ‡Ð°</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <h6 id="taskModalProjectTitle"></h6>
                        <p id="taskModalDescription" contenteditable="true" oninput="debounceSaveTaskDescription()"></p>
                        <div class="mb-3">
                            <label class="form-label">Ð¡Ñ‚Ð°Ñ‚ÑƒÑ</label>
                            <select id="taskModalStatus" class="form-select">
                                <option value="todo">Ðš Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÑŽ</option>
                                <option value="in_progress">Ð’ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ</option>
                                <option value="done">Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Ð˜ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»Ð¸</label>
                            <select multiple class="form-select" id="taskModalAssignees"></select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ÐŸÐ¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð¸</label>
                            <div id="taskModalSubtasks">
                                <!-- Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑŽÑ‚ÑÑ -->
                            </div>
                            <button class="btn btn-sm btn-outline-secondary mt-1" onclick="addSubtask()">+ Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ñƒ</button>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸</label>
                            <div id="taskModalComments">
                                <!-- Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑŽÑ‚ÑÑ -->
                            </div>
                            <div class="input-group mt-2">
                                <textarea id="newCommentText" class="form-control" placeholder="ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¹..."></textarea>
                                <button class="btn btn-primary" onclick="addComment()">ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ</button>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Ð¤Ð°Ð¹Ð»Ñ‹</label>
                            <div id="taskModalFiles">
                                <!-- Ð¡ÑÑ‹Ð»ÐºÐ¸ Ð½Ð° Ñ„Ð°Ð¹Ð»Ñ‹ -->
                            </div>
                            <input type="file" id="fileUploadInput" class="form-control" multiple>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ</button>
                        <button type="button" class="btn btn-primary" onclick="updateTask()">Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="js/main.js"></script>
</body>
</html>

```

### web\assets\favicon.ico

```ico```

```

### web\css\style.css

```css```
/* web/css/style.css */
:root {
    --primary-color: #4361ee;
    --secondary-color: #3a0ca3;
    --success-color: #4cc9f0;
    --danger-color: #f72585;
    --warning-color: #f8961e;
    --max-bg: #f0f2f5;
    --max-card-bg: #ffffff;
    --max-text: #1c1e21;
    --max-border: #dddfe2;
}

body {
    background-color: var(--max-bg);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding-top: 20px;
    padding-bottom: 20px;
}

.navbar-brand {
    font-weight: 600;
    font-size: 1.5rem;
}

.navbar-brand i {
    margin-right: 0.5rem;
}

.max-card {
    background-color: var(--max-card-bg);
    border: 1px solid var(--max-border);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.max-btn-primary {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
    color: white;
}

.max-btn-primary:hover {
    background-color: #3651d8;
    border-color: #3651d8;
}

.nav-tabs-max .nav-link {
    color: #6c757d;
    border: 1px solid transparent;
    border-top-left-radius: 0.5rem;
    border-top-right-radius: 0.5rem;
}

.nav-tabs-max .nav-link.active {
    color: var(--primary-color);
    background-color: var(--max-card-bg);
    border-color: var(--max-border) var(--max-border) var(--max-card-bg);
}

.project-card, .task-item {
    cursor: pointer;
    transition: background-color 0.2s;
}

.project-card:hover, .task-item:hover {
    background-color: rgba(67, 97, 238, 0.05);
}

.task-item.todo { border-left: 4px solid var(--warning-color); }
.task-item.in_progress { border-left: 4px solid var(--success-color); }
.task-item.done { border-left: 4px solid var(--danger-color); }

.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-right: 10px;
}

.loading {
    text-align: center;
    padding: 20px;
    color: #6c757d;
}

.progress-bar {
    background-color: var(--primary-color);
}

/* Ð¢ÐµÐ¼Ð½Ð°Ñ Ñ‚ÐµÐ¼Ð° */
body.dark-theme {
    background-color: #121212;
    color: #e0e0e0;
}

.dark-theme .max-card {
    background-color: #1e1e1e;
    border-color: #444444;
    color: #e0e0e0;
}

.dark-theme .nav-tabs-max .nav-link {
    color: #b0b0b0;
}

.dark-theme .nav-tabs-max .nav-link.active {
    color: var(--primary-color);
    background-color: #1e1e1e;
    border-color: #444444 #444444 #1e1e1e;
}

.dark-theme .form-control, .dark-theme .form-select {
    background-color: #2d2d2d;
    border-color: #444444;
    color: #e0e0e0;
}

.dark-theme .form-control:focus, .dark-theme .form-select:focus {
    background-color: #2d2d2d;
    border-color: var(--primary-color);
    color: #e0e0e0;
    box-shadow: 0 0 0 0.2rem rgba(67, 97, 238, 0.25);
}

.dark-theme .btn-close {
    filter: invert(1);
}

```

### web\js\api.js

```js```
// web/js/api.js
// ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
const API_BASE_URL = 'http://localhost:8000/api'; // Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð½Ð° URL Ð²Ð°ÑˆÐµÐ³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°

// Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð² API
async function apiCall(endpoint, method = 'GET', data = null, token = null) {
    const url = `${API_BASE_URL}${endpoint}`;
    const headers = {
        'Content-Type': 'application/json',
    };
    if (token) {
        headers['Authorization'] = `Bearer ${token}`;
    }

    const config = {
        method,
        headers,
    };

    if (data) {
        config.body = JSON.stringify(data);
    }

    try {
        const response = await fetch(url, config);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return await response.json();
    } catch (error) {
        console.error('API Error:', error);
        throw error;
    }
}

// Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð² Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ð¼Ð¾Ð´ÑƒÐ»ÑÑ…
// Ð’ ÑÑ‚Ð°Ñ€Ð¾Ð¼ ÐºÐ¾Ð´Ðµ Ð¾Ð½Ð¸ Ð±Ñ‹Ð»Ð¸ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸, Ð² Ð½Ð¾Ð²Ð¾Ð¼ Ð¼Ð¾Ð¶Ð½Ð¾ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ
// export { apiCall, login, getProjects, createProject, getTasks, getProjectTasks, createTask, updateTaskStatus, getNotifications, markAllNotificationsRead };

```

### web\js\auth.js

```js```
// web/js/auth.js
// import { apiCall } from './api.js'; // Ð•ÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ES6 modules

// Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ (ÐµÑÐ»Ð¸ Ð½Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¼Ð¾Ð´ÑƒÐ»Ð¸)
let currentUserId = null;

// Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð²Ñ…Ð¾Ð´Ð°
async function login(userId, fullName) {
    try {
        const response = await apiCall('/auth/token', 'POST', { max_id: userId, full_name: fullName });
        if (response.access_token) {
            localStorage.setItem('access_token', response.access_token);
            localStorage.setItem('user_id', response.user.id);
            localStorage.setItem('user_name', response.user.full_name);
            currentUserId = response.user.id;
            return response.user;
        }
        return null;
    } catch (error) {
        console.error('Login error:', error);
        throw error;
    }
}

// ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ
window.addEventListener('load', () => {
    const token = localStorage.getItem('access_token');
    if (token) {
        currentUserId = localStorage.getItem('user_id');
        if (currentUserId) {
            showMainInterface();
        } else {
            showAuthSection();
        }
    } else {
        showAuthSection();
    }
});

// Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ð° Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ° (Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð¾Ð½Ð¸ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ñ‹ Ð² main.js)
function showAuthSection() {
    document.getElementById('authSection').style.display = 'block';
    document.getElementById('mainInterface').style.display = 'none';
}

function showMainInterface() {
    document.getElementById('authSection').style.display = 'none';
    document.getElementById('mainInterface').style.display = 'block';
    document.getElementById('user-name').textContent = localStorage.getItem('user_name');
    document.getElementById('user-avatar').textContent = localStorage.getItem('user_name').charAt(0).toUpperCase();
}

// Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð· main.js
async function login() {
    const userId = document.getElementById('userIdInput').value.trim();
    if (!userId) {
        alert('Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ User ID');
        return;
    }
    // Ð”Ð»Ñ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ñ‚Ñ‹, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ 'Anonymous' ÐºÐ°Ðº Ð¸Ð¼Ñ, ÐµÑÐ»Ð¸ Ð½Ðµ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð¸Ð· MAX
    const fullName = prompt('Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°ÑˆÐµ Ð¸Ð¼Ñ (Ð´Ð»Ñ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸):') || 'Anonymous';
    try {
        const user = await login(userId, fullName); // Ð’Ñ‹Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½ÑƒÑŽ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ login
        if (user) {
            showMainInterface();
            await loadDashboardData();
            await loadProjects();
            await loadTasks();
            await loadNotifications();
        } else {
            alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ñ…Ð¾Ð´Ð°');
        }
    } catch (error) {
        console.error('Login error:', error);
        alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ñ…Ð¾Ð´Ð°: ' + error.message);
    }
}

```

### web\js\dashboard.js

```js```
// web/js/dashboard.js
// import { getProjects, getTasks } from './api.js'; // Ð•ÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ES6 modules

async function loadDashboardData() {
    if (!currentUserId) return;
    const token = localStorage.getItem('access_token');
    try {
        const projectsData = await getProjects(currentUserId, token); // ÐŸÑ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ getProjects Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð° Ð² api.js Ð¸Ð»Ð¸ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°
        const tasksData = await getTasks(currentUserId, token); // ÐŸÑ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ getTasks Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð° Ð² api.js Ð¸Ð»Ð¸ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°

        const projectsCount = projectsData.projects ? projectsData.projects.length : 0;
        const tasks = tasksData.tasks || [];

        const tasksTodo = tasks.filter(t => t.status === 'todo').length;
        const tasksProgress = tasks.filter(t => t.status === 'in_progress').length;
        const tasksDone = tasks.filter(t => t.status === 'done').length;

        document.getElementById('projects-count').textContent = projectsCount;
        document.getElementById('tasks-todo-count').textContent = tasksTodo;
        document.getElementById('tasks-progress-count').textContent = tasksProgress;
        document.getElementById('tasks-done-count').textContent = tasksDone;

        const container = document.getElementById('dashboard-projects-list');
        if (projectsData.projects && projectsData.projects.length > 0) {
            container.innerHTML = projectsData.projects.map(member => {
                const project = member.project;
                const stats = project.stats || { tasks_count: 0, tasks_done: 0 };
                const progress = stats.tasks_count > 0 ? Math.round((stats.tasks_done / stats.tasks_count) * 100) : 0;
                return `
                    <div class="project-card mb-2 p-2" onclick="openProject('${project.hash}')">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">${project.title}</h6>
                            <span class="badge bg-${member.role === 'owner' ? 'primary' : 'secondary'}">${member.role}</span>
                        </div>
                        <div class="progress mb-1" style="height: 8px;">
                            <div class="progress-bar" style="width: ${progress}%"></div>
                        </div>
                        <small class="text-muted">${progress}% Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾ (${stats.tasks_done}/${stats.tasks_count})</small>
                    </div>
                `;
            }).join('');
        } else {
            container.innerHTML = '<p class="text-muted">ÐÐµÑ‚ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð² Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ.</p>';
        }
    } catch (error) {
        console.error('Dashboard load error:', error);
        document.getElementById('projects-count').textContent = '0';
        document.getElementById('tasks-todo-count').textContent = '0';
        document.getElementById('tasks-progress-count').textContent = '0';
        document.getElementById('tasks-done-count').textContent = '0';
        document.getElementById('dashboard-projects-list').innerHTML = '<p class="text-muted">ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ….</p>';
    }
}

```

### web\js\main.js

```js```
// web/js/main.js
// --- ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ ---
const API_BASE_URL = 'https://powerfully-exotic-chamois.cloudpub.ru/api';
let currentUserId = null;
let currentSection = 'dashboard';
let currentTheme = localStorage.getItem('theme') || 'light';

// --- Ð£Ñ‚Ð¸Ð»Ð¸Ñ‚Ñ‹ ---
function escapeHTML(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function formatDate(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toLocaleDateString('ru-RU');
}

function getStatusColor(status) {
    const colors = {'todo': 'warning', 'in_progress': 'info', 'done': 'success'};
    return colors[status] || 'secondary';
}

function getStatusText(status) {
    const texts = {'todo': 'Ðš Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÑŽ', 'in_progress': 'Ð’ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ', 'done': 'Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾'};
    return texts[status] || status;
}

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// --- Ð¢ÐµÐ¼Ð° ---
function applyTheme() {
    const body = document.body;
    const icon = document.querySelector('#theme-toggle i');

    if (currentTheme === 'dark') {
        body.classList.add('dark-theme');
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
    } else {
        body.classList.remove('dark-theme');
        icon.classList.remove('fa-sun');
        icon.classList.add('fa-moon');
    }
}

function toggleTheme() {
    currentTheme = currentTheme === 'light' ? 'dark' : 'light';
    localStorage.setItem('theme', currentTheme);
    applyTheme();
}

document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
applyTheme(); // ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ñ‚ÐµÐ¼Ñƒ Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ

// --- API ---
async function apiCall(endpoint, method = 'GET', data = null, token = null) {
    const url = `${API_BASE_URL}${endpoint}`;
    const headers = {
        'Content-Type': 'application/json',
    };
    if (token) {
        headers['Authorization'] = `Bearer ${token}`;
    }

    const config = {
        method,
        headers,
    };

    if (data) {
        config.body = JSON.stringify(data);
    }

    try {
        const response = await fetch(url, config);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return await response.json();
    } catch (error) {
        console.error('API Error:', error);
        throw error;
    }
}

// Auth
async function login(userId, fullName) {
    const response = await apiCall('/auth/token', 'POST', { max_id: userId, full_name: fullName });
    if (response.access_token) {
        localStorage.setItem('access_token', response.access_token);
        localStorage.setItem('user_id', response.user.id);
        localStorage.setItem('user_name', response.user.full_name);
        currentUserId = response.user.id;
        return response.user;
    }
    return null;
}

// Projects
async function getProjects(userId, token) {
    return await apiCall(`/users/${userId}/projects`, 'GET', null, token);
}

async function createProject(title, description, token) {
    return await apiCall('/projects/', 'POST', { title, description }, token);
}

// Tasks
async function getTasks(userId, token) {
    return await apiCall(`/tasks/?user_id=${userId}`, 'GET', null, token);
}

async function getProjectTasks(projectHash, token) {
    return await apiCall(`/tasks/project/${projectHash}`, 'GET', null, token);
}

async function createTask(title, projectHash, description, status, priority, assignedToIds, token) {
    return await apiCall('/tasks/', 'POST', { title, project_hash: projectHash, description, status, priority, assigned_to_ids: assignedToIds }, token);
}

async function updateTaskStatus(taskId, status, token) {
    return await apiCall(`/tasks/${taskId}/status`, 'PUT', { status }, token);
}

// Notifications
async function getNotifications(userId, token) {
    return await apiCall(`/notifications/?user_id=${userId}`, 'GET', null, token);
}

async function markAllNotificationsRead(userId, token) {
    return await apiCall('/notifications/mark_all_read', 'PUT', null, token);
}

// --- ÐÐ²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ ---
function showAuthSection() {
    document.getElementById('authSection').style.display = 'block';
    document.getElementById('mainInterface').style.display = 'none';
}

function showMainInterface() {
    document.getElementById('authSection').style.display = 'none';
    document.getElementById('mainInterface').style.display = 'block';
    document.getElementById('user-name').textContent = localStorage.getItem('user_name');
    document.getElementById('user-avatar').textContent = localStorage.getItem('user_name').charAt(0).toUpperCase();
}

async function login() {
    const userId = document.getElementById('userIdInput').value.trim();
    if (!userId) {
        alert('Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ User ID');
        return;
    }
    // Ð”Ð»Ñ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ñ‚Ñ‹, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ 'Anonymous' ÐºÐ°Ðº Ð¸Ð¼Ñ, ÐµÑÐ»Ð¸ Ð½Ðµ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð¸Ð· MAX
    const fullName = prompt('Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°ÑˆÐµ Ð¸Ð¼Ñ (Ð´Ð»Ñ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸):') || 'Anonymous';
    try {
        const user = await login(userId, fullName);
        if (user) {
            showMainInterface();
            await loadDashboardData();
            await loadProjects();
            await loadTasks();
            await loadNotifications();
        } else {
            alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ñ…Ð¾Ð´Ð°');
        }
    } catch (error) {
        console.error('Login error:', error);
        alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ñ…Ð¾Ð´Ð°: ' + error.message);
    }
}

// ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ
window.addEventListener('load', () => {
    const token = localStorage.getItem('access_token');
    if (token) {
        currentUserId = localStorage.getItem('user_id');
        if (currentUserId) {
            showMainInterface();
            // Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð²Ñ‹Ð·Ð²Ð°Ð½Ð° Ð¿Ð¾Ð·Ð¶Ðµ
        } else {
            showAuthSection();
        }
    } else {
        showAuthSection();
    }
});

// --- Ð¡ÐµÐºÑ†Ð¸Ð¸ ---
async function showSection(sectionName) {
    if (!currentUserId) {
        alert('ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ');
        return;
    }

    // Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ Ð²ÑÐµ ÑÐµÐºÑ†Ð¸Ð¸
    document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
    });
    // ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ
    document.getElementById(sectionName).classList.add('active');

    // ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð°ÐºÑ‚Ð¸Ð²Ð½ÑƒÑŽ Ð²ÐºÐ»Ð°Ð´ÐºÑƒ
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
    });
    event.target.classList.add('active');

    currentSection = sectionName;

    // Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ ÑÐµÐºÑ†Ð¸Ð¸
    switch(sectionName) {
        case 'dashboard':
            await loadDashboardData();
            break;
        case 'projects':
            await loadProjects();
            break;
        case 'tasks':
            await loadTasks();
            break;
        case 'notifications':
            await loadNotifications();
            break;
    }
}

// --- Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ ---
async function loadDashboardData() {
    if (!currentUserId) return;
    const token = localStorage.getItem('access_token');
    try {
        const projectsData = await getProjects(currentUserId, token);
        const tasksData = await getTasks(currentUserId, token);

        const projectsCount = projectsData.projects ? projectsData.projects.length : 0;
        const tasks = tasksData.tasks || [];

        const tasksTodo = tasks.filter(t => t.status === 'todo').length;
        const tasksProgress = tasks.filter(t => t.status === 'in_progress').length;
        const tasksDone = tasks.filter(t => t.status === 'done').length;

        document.getElementById('projects-count').textContent = projectsCount;
        document.getElementById('tasks-todo-count').textContent = tasksTodo;
        document.getElementById('tasks-progress-count').textContent = tasksProgress;
        document.getElementById('tasks-done-count').textContent = tasksDone;

        const container = document.getElementById('dashboard-projects-list');
        if (projectsData.projects && projectsData.projects.length > 0) {
            container.innerHTML = projectsData.projects.map(member => {
                const project = member.project;
                const stats = project.stats || { tasks_count: 0, tasks_done: 0 };
                const progress = stats.tasks_count > 0 ? Math.round((stats.tasks_done / stats.tasks_count) * 100) : 0;
                return `
                    <div class="project-card mb-2 p-2" onclick="openProject('${project.hash}')">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">${project.title}</h6>
                            <span class="badge bg-${member.role === 'owner' ? 'primary' : 'secondary'}">${member.role}</span>
                        </div>
                        <div class="progress mb-1" style="height: 8px;">
                            <div class="progress-bar" style="width: ${progress}%"></div>
                        </div>
                        <small class="text-muted">${progress}% Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾ (${stats.tasks_done}/${stats.tasks_count})</small>
                    </div>
                `;
            }).join('');
        } else {
            container.innerHTML = '<p class="text-muted">ÐÐµÑ‚ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð² Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ.</p>';
        }
    } catch (error) {
        console.error('Dashboard load error:', error);
        document.getElementById('projects-count').textContent = '0';
        document.getElementById('tasks-todo-count').textContent = '0';
        document.getElementById('tasks-progress-count').textContent = '0';
        document.getElementById('tasks-done-count').textContent = '0';
        document.getElementById('dashboard-projects-list').innerHTML = '<p class="text-muted">ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ….</p>';
    }
}

// --- ÐŸÑ€Ð¾ÐµÐºÑ‚Ñ‹ ---
async function loadProjects() {
    if (!currentUserId) {
        document.getElementById('projects-list').innerHTML = `
            <div class="max-card text-center">
                <i class="fas fa-exclamation-triangle fa-2x text-muted mb-3"></i>
                <h6>ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ</h6>
                <p class="text-muted">Ð”Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð² Ð²Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ</p>
            </div>`;
        return;
    }
    const token = localStorage.getItem('access_token');
    try {
        const data = await getProjects(currentUserId, token);
        const container = document.getElementById('projects-list');

        if (!data.projects || data.projects.length === 0) {
            container.innerHTML = `
                <div class="max-card text-center">
                    <i class="fas fa-folder-open fa-2x text-muted mb-3"></i>
                    <h6>ÐŸÑ€Ð¾ÐµÐºÑ‚Ð¾Ð² Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚</h6>
                    <p class="text-muted">Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÑÐ²Ð¾Ð¹ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚!</p>
                    <button class="btn max-btn-primary" onclick="createProject()"><i class="fas fa-plus"></i> Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚</button>
                </div>`;
            return;
        }

        container.innerHTML = data.projects.map(member => {
            const project = member.project;
            const stats = project.stats || { tasks_count: 0, tasks_done: 0 };
            const progress = stats.tasks_count > 0 ? Math.round((stats.tasks_done / stats.tasks_count) * 100) : 0;
            return `
                <div class="project-card max-card" onclick="openProject('${project.hash}')">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h6 class="mb-0">${project.title}</h6>
                        <span class="badge bg-${member.role === 'owner' ? 'primary' : 'secondary'}">${member.role}</span>
                    </div>
                    <p class="text-muted mb-1">${project.description || 'Ð‘ÐµÐ· Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ'}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">Ð£Ñ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²: ${project.members ? project.members.length : 0}</small>
                        <small class="text-muted">Ð—Ð°Ð´Ð°Ñ‡: ${stats.tasks_count}</small>
                    </div>
                    <div class="progress mt-2" style="height: 8px;">
                        <div class="progress-bar" style="width: ${progress}%"></div>
                    </div>
                    <small class="text-muted">${progress}% Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾</small>
                </div>`;
        }).join('');

    } catch (error) {
        console.error('Projects load error:', error);
        document.getElementById('projects-list').innerHTML = `
            <div class="max-card text-center">
                <i class="fas fa-exclamation-triangle fa-2x text-muted mb-3"></i>
                <h6>ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸</h6>
                <p class="text-muted">ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹</p>
            </div>`;
    }
}

async function createProject() {
    if (!currentUserId) {
        alert('ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°');
        return;
    }
    const title = prompt('Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°:');
    if (!title) return;
    const description = prompt('Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° (Ð½ÐµÐ¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾):') || '';

    const token = localStorage.getItem('access_token');
    try {
        const result = await createProject(title, description, token);
        alert(`ÐŸÑ€Ð¾ÐµÐºÑ‚ "${result.project.title}" ÑÐ¾Ð·Ð´Ð°Ð½!`);
        if (currentSection === 'projects') {
            await loadProjects();
        }
        await loadDashboardData(); // ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‡Ñ‘Ñ‚Ñ‡Ð¸ÐºÐ¸
    } catch (error) {
        console.error('Project creation error:', error);
        alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°: ' + error.message);
    }
}

function openProject(projectHash) {
    // Ð—Ð´ÐµÑÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Ñ Ð´ÐµÑ‚Ð°Ð»ÑÐ¼Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð¸Ð»Ð¸ Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
    // ÐŸÐ¾ÐºÐ° Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð¶ÐµÐ¼ QR-ÐºÐ¾Ð´ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ñ
    showProjectInviteQR(projectHash);
}

function showProjectInviteQR(projectHash) {
    const inviteUrl = `${window.location.origin}/?join=${projectHash}`;
    const modal = new bootstrap.Modal(document.createElement('div'));
    const modalHTML = `
        <div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">ÐŸÑ€Ð¸Ð³Ð»Ð°ÑÐ¸Ñ‚ÑŒ Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚</h5>
                        <button type="button" class="btn-close" onclick="this.closest('.modal').remove()"></button>
                    </div>
                    <div class="modal-body text-center">
                        <p>ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ ÑÑ‚Ð¾Ñ‚ QR-ÐºÐ¾Ð´ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ:</p>
                        <div id="qrCodeContainer"></div>
                        <p class="mt-2">Ð˜Ð»Ð¸ Ð¿Ð¾Ð´ÐµÐ»Ð¸Ñ‚ÐµÑÑŒ ÑÑÑ‹Ð»ÐºÐ¾Ð¹: <code>${inviteUrl}</code></p>
                    </div>
                </div>
            </div>
        </div>`;
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    const modalElement = document.querySelector('.modal.show');
    new QRCode(document.getElementById('qrCodeContainer'), { text: inviteUrl, width: 200, height: 200 });
    modalElement.querySelector('.btn-close').addEventListener('click', () => modalElement.remove());
}

// --- Ð—Ð°Ð´Ð°Ñ‡Ð¸ ---
let currentTaskId = null;
let currentTaskDetails = null;
let taskSearchFuse = null;

async function loadTasks(status = null) {
    if (!currentUserId) {
        document.getElementById('tasks-list').innerHTML = `
            <div class="max-card text-center">
                <i class="fas fa-tasks fa-2x text-muted mb-3"></i>
                <h6>ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ</h6>
                <p class="text-muted">Ð”Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð·Ð°Ð´Ð°Ñ‡ Ð²Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ</p>
            </div>`;
        return;
    }
    const token = localStorage.getItem('access_token');
    try {
        const data = await getTasks(currentUserId, token);
        const tasks = data.tasks || [];

        // Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾ ÑÑ‚Ð°Ñ‚ÑƒÑÑƒ
        const filteredTasks = status ? tasks.filter(t => t.status === status) : tasks;

        const container = document.getElementById('tasks-list');
        if (filteredTasks.length === 0) {
            container.innerHTML = `
                <div class="max-card text-center">
                    <i class="fas fa-tasks fa-2x text-muted mb-3"></i>
                    <h6>Ð—Ð°Ð´Ð°Ñ‡ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚</h6>
                    <p class="text-muted">Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¿ÐµÑ€Ð²ÑƒÑŽ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ!</p>
                </div>`;
            return;
        }

        container.innerHTML = filteredTasks.map(task => {
            const statusColor = getStatusColor(task.status);
            const statusText = getStatusText(task.status);
            return `
                <div class="task-item task-${task.status} max-card" onclick="openTaskModal(${task.id})">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="flex-grow-1">
                            <h6 class="mb-0">${task.title}</h6>
                            <p class="text-muted small mb-1">${task.description ? task.description.substring(0, 50) + '...' : ''}</p>
                            <div class="d-flex align-items-center">
                                <span class="badge bg-${statusColor} me-2">${statusText}</span>
                                <span class="text-muted small">${formatDate(task.created_at)}</span>
                            </div>
                        </div>
                        <div class="text-end">
                            <div class="text-muted small">ÐŸÑ€Ð¾ÐµÐºÑ‚: ${task.project.title}</div>
                            <div class="text-muted small">ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚: ${task.priority}</div>
                        </div>
                    </div>
                </div>`;
        }).join('');

        // Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð¸ÑÐºÐ°
        taskSearchFuse = new Fuse(tasks, {
            keys: ['title', 'description'],
            threshold: 0.3
        });

    } catch (error) {
        console.error('Tasks load error:', error);
        document.getElementById('tasks-list').innerHTML = `
            <div class="max-card text-center">
                <i class="fas fa-exclamation-triangle fa-2x text-muted mb-3"></i>
                <h6>ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸</h6>
                <p class="text-muted">ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸</p>
            </div>`;
    }
}

function openTaskModal(taskId) {
    currentTaskId = taskId;
    // Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð¸ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÐ½Ð°
    // ÐŸÐ¾ÐºÐ° ÑƒÐ¿Ñ€Ð¾Ñ‰Ñ‘Ð½Ð½Ð¾
    const token = localStorage.getItem('access_token');
    fetch(`${API_BASE_URL}/tasks/${taskId}`, {
        headers: { 'Authorization': `Bearer ${token}` }
    })
    .then(response => response.json())
    .then(data => {
        currentTaskDetails = data.task;
        document.getElementById('taskModalTitle').textContent = data.task.title;
        document.getElementById('taskModalProjectTitle').textContent = data.task.project.title;
        document.getElementById('taskModalDescription').textContent = data.task.description || '';
        document.getElementById('taskModalStatus').value = data.task.status;

        // Ð—Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ assignees
        const assigneeSelect = document.getElementById('taskModalAssignees');
        assigneeSelect.innerHTML = '';
        data.task.project.members.forEach(member => {
            const option = document.createElement('option');
            option.value = member.user_id;
            option.textContent = member.user.full_name;
            if (data.task.assigned_to_id === member.user_id) option.selected = true;
            assigneeSelect.appendChild(option);
        });

        // Ð—Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð´Ð·Ð°Ð´Ð°Ñ‡
        const subtasksContainer = document.getElementById('taskModalSubtasks');
        subtasksContainer.innerHTML = data.task.subtasks ? data.task.subtasks.map(st => `
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="subtask${st.id}" ${st.status === 'done' ? 'checked' : ''} disabled>
                <label class="form-check-label" for="subtask${st.id}">${st.title}</label>
            </div>
        `).join('') : '';

        // Ð—Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸ÐµÐ²
        const commentsContainer = document.getElementById('taskModalComments');
        commentsContainer.innerHTML = data.task.comments ? data.task.comments.map(c => `
            <div class="comment-item mb-2">
                <strong>${c.user.full_name}</strong> <small class="text-muted">${formatDate(c.created_at)}</small>
                <p class="mb-1">${escapeHTML(c.content)}</p>
            </div>
        `).join('') : '';

        // Ð—Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð²
        const filesContainer = document.getElementById('taskModalFiles');
        filesContainer.innerHTML = data.task.attachments ? data.task.attachments.map(att => `
            <a href="${att.url}" target="_blank">${att.filename}</a>
        `).join('<br>') : 'ÐÐµÑ‚ Ð¿Ñ€Ð¸ÐºÑ€ÐµÐ¿Ð»Ñ‘Ð½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²';

        const modal = new bootstrap.Modal(document.getElementById('taskModal'));
        modal.show();
    })
    .catch(err => console.error('Error loading task details:', err));
}

function updateTask() {
    if (!currentUserId || !currentTaskId) return;
    const token = localStorage.getItem('access_token');
    const newStatus = document.getElementById('taskModalStatus').value;
    updateTaskStatus(currentTaskId, newStatus, token)
        .then(() => {
            alert('Ð—Ð°Ð´Ð°Ñ‡Ð° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð°!');
            const modal = bootstrap.Modal.getInstance(document.getElementById('taskModal'));
            modal.hide();
            if (currentSection === 'tasks') {
                loadTasks(); // ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸
            }
        })
        .catch(err => {
            console.error('Update task error:', err);
            alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð·Ð°Ð´Ð°Ñ‡Ð¸');
        });
}

function debounceSaveTaskDescription() {
    debounce(async () => {
        if (!currentTaskId) return;
        const newDesc = document.getElementById('taskModalDescription').textContent;
        // Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ PUT Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð´Ð»Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ
        // PUT /api/tasks/{id}/description
        // console.log('Saving description for task', currentTaskId, ':', newDesc);
    }, 500)();
}

function addSubtask() {
    const title = prompt('Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð¸:');
    if (title) {
        // Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ POST Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¿Ð¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð¸
        // POST /api/tasks/
        // console.log('Adding subtask:', title, 'to task', currentTaskId);
    }
}

function addComment() {
    const text = document.getElementById('newCommentText').value.trim();
    if (!text) return;
    // Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ POST Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ñ
    // POST /api/tasks/{id}/comments
    // console.log('Adding comment:', text, 'to task', currentTaskId);
    document.getElementById('newCommentText').value = '';
}

function searchTasks() {
    const query = document.getElementById('searchTasksInput').value;
    if (!taskSearchFuse || !query) {
        loadTasks(); // ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð·Ð°Ð´Ð°Ñ‡Ð¸, ÐµÑÐ»Ð¸ Ð½ÐµÑ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
        return;
    }
    const results = taskSearchFuse.search(query);
    const container = document.getElementById('tasks-list');
    if (results.length === 0) {
        container.innerHTML = '<p class="text-muted">Ð—Ð°Ð´Ð°Ñ‡Ð¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹.</p>';
        return;
    }
    container.innerHTML = results.map(result => {
        const task = result.item;
        const statusColor = getStatusColor(task.status);
        const statusText = getStatusText(task.status);
        return `
            <div class="task-item task-${task.status} max-card" onclick="openTaskModal(${task.id})">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="mb-0">${task.title}</h6>
                        <p class="text-muted small mb-1">${task.description ? task.description.substring(0, 50) + '...' : ''}</p>
                        <div class="d-flex align-items-center">
                            <span class="badge bg-${statusColor} me-2">${statusText}</span>
                            <span class="text-muted small">${formatDate(task.created_at)}</span>
                        </div>
                    </div>
                    <div class="text-end">
                        <div class="text-muted small">ÐŸÑ€Ð¾ÐµÐºÑ‚: ${task.project.title}</div>
                        <div class="text-muted small">ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚: ${task.priority}</div>
                    </div>
                </div>
            </div>`;
    }).join('');
}

// --- Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ ---
async function loadNotifications() {
    if (!currentUserId) {
        document.getElementById('notifications-list').innerHTML = `
            <div class="max-card text-center">
                <i class="fas fa-bell fa-2x text-muted mb-3"></i>
                <h6>ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ</h6>
                <p class="text-muted">Ð”Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹ Ð²Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ</p>
            </div>`;
        return;
    }
    const token = localStorage.getItem('access_token');
    try {
        const data = await getNotifications(currentUserId, token);
        const container = document.getElementById('notifications-list');

        if (!data.notifications || data.notifications.length === 0) {
            container.innerHTML = `
                <div class="max-card text-center">
                    <i class="fas fa-inbox fa-2x text-muted mb-3"></i>
                    <h6>Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹ Ð½ÐµÑ‚</h6>
                    <p class="text-muted">ÐÐ¾Ð²Ñ‹Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¿Ð¾ÑÐ²ÑÑ‚ÑÑ Ð·Ð´ÐµÑÑŒ</p>
                </div>`;
            return;
        }

        container.innerHTML = data.notifications.map(notification => {
            const unreadClass = notification.is_read ? '' : 'fw-bold';
            const unreadIcon = notification.is_read ? 'âšª' : 'ðŸ”µ';
            return `
                <div class="max-card ${unreadClass}">
                    <div class="d-flex justify-content-between">
                        <h6 class="mb-0">${unreadIcon} ${notification.title}</h6>
                        <small class="text-muted">${formatDate(notification.created_at)}</small>
                    </div>
                    <p class="mb-0">${notification.message}</p>
                </div>`;
        }).join('');

    } catch (error) {
        console.error('Notifications load error:', error);
        document.getElementById('notifications-list').innerHTML = `
            <div class="max-card text-center">
                <i class="fas fa-exclamation-triangle fa-2x text-muted mb-3"></i>
                <h6>ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸</h6>
                <p class="text-muted">ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ</p>
            </div>`;
    }
}

async function markAllNotificationsRead() {
    if (!currentUserId) return;
    const token = localStorage.getItem('access_token');
    try {
        await markAllNotificationsRead(currentUserId, token);
        await loadNotifications(); // ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº
        alert('Ð’ÑÐµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¾Ñ‚Ð¼ÐµÑ‡ÐµÐ½Ñ‹ ÐºÐ°Ðº Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ðµ');
    } catch (error) {
        console.error('Mark read error:', error);
        alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¼ÐµÑ‚ÐºÐµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹');
    }
}

```

### web\js\projects.js

```js```
// web/js/projects.js
// import { getProjects, createProject } from './api.js'; // Ð•ÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ES6 modules

async function loadProjects() {
    if (!currentUserId) {
        document.getElementById('projects-list').innerHTML = `
            <div class="max-card text-center">
                <i class="fas fa-exclamation-triangle fa-2x text-muted mb-3"></i>
                <h6>ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ</h6>
                <p class="text-muted">Ð”Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð² Ð²Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ</p>
            </div>`;
        return;
    }
    const token = localStorage.getItem('access_token');
    try {
        const data = await getProjects(currentUserId, token); // ÐŸÑ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ getProjects Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð° Ð² api.js Ð¸Ð»Ð¸ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°
        const container = document.getElementById('projects-list');

        if (!data.projects || data.projects.length === 0) {
            container.innerHTML = `
                <div class="max-card text-center">
                    <i class="fas fa-folder-open fa-2x text-muted mb-3"></i>
                    <h6>ÐŸÑ€Ð¾ÐµÐºÑ‚Ð¾Ð² Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚</h6>
                    <p class="text-muted">Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÑÐ²Ð¾Ð¹ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚!</p>
                    <button class="btn max-btn-primary" onclick="createProject()"><i class="fas fa-plus"></i> Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚</button>
                </div>`;
            return;
        }

        container.innerHTML = data.projects.map(member => {
            const project = member.project;
            const stats = project.stats || { tasks_count: 0, tasks_done: 0 };
            const progress = stats.tasks_count > 0 ? Math.round((stats.tasks_done / stats.tasks_count) * 100) : 0;
            return `
                <div class="project-card max-card" onclick="openProject('${project.hash}')">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h6 class="mb-0">${project.title}</h6>
                        <span class="badge bg-${member.role === 'owner' ? 'primary' : 'secondary'}">${member.role}</span>
                    </div>
                    <p class="text-muted mb-1">${project.description || 'Ð‘ÐµÐ· Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ'}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">Ð£Ñ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²: ${project.members ? project.members.length : 0}</small>
                        <small class="text-muted">Ð—Ð°Ð´Ð°Ñ‡: ${stats.tasks_count}</small>
                    </div>
                    <div class="progress mt-2" style="height: 8px;">
                        <div class="progress-bar" style="width: ${progress}%"></div>
                    </div>
                    <small class="text-muted">${progress}% Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾</small>
                </div>`;
        }).join('');

    } catch (error) {
        console.error('Projects load error:', error);
        document.getElementById('projects-list').innerHTML = `
            <div class="max-card text-center">
                <i class="fas fa-exclamation-triangle fa-2x text-muted mb-3"></i>
                <h6>ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸</h6>
                <p class="text-muted">ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹</p>
            </div>`;
    }
}

async function createProject() {
    if (!currentUserId) {
        alert('ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°');
        return;
    }
    const title = prompt('Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°:');
    if (!title) return;
    const description = prompt('Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° (Ð½ÐµÐ¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾):') || '';

    const token = localStorage.getItem('access_token');
    try {
        const result = await createProject(title, description, token); // ÐŸÑ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ createProject Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð° Ð² api.js Ð¸Ð»Ð¸ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°
        alert(`ÐŸÑ€Ð¾ÐµÐºÑ‚ "${result.project.title}" ÑÐ¾Ð·Ð´Ð°Ð½!`);
        if (currentSection === 'projects') {
            await loadProjects();
        }
        await loadDashboardData(); // ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‡Ñ‘Ñ‚Ñ‡Ð¸ÐºÐ¸
    } catch (error) {
        console.error('Project creation error:', error);
        alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°: ' + error.message);
    }
}

function openProject(projectHash) {
    // Ð—Ð´ÐµÑÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Ñ Ð´ÐµÑ‚Ð°Ð»ÑÐ¼Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð¸Ð»Ð¸ Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
    // ÐŸÐ¾ÐºÐ° Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð¶ÐµÐ¼ QR-ÐºÐ¾Ð´ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ñ
    showProjectInviteQR(projectHash);
}

function showProjectInviteQR(projectHash) {
    const inviteUrl = `${window.location.origin}/?join=${projectHash}`;
    const modal = new bootstrap.Modal(document.createElement('div'));
    const modalHTML = `
        <div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">ÐŸÑ€Ð¸Ð³Ð»Ð°ÑÐ¸Ñ‚ÑŒ Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚</h5>
                        <button type="button" class="btn-close" onclick="this.closest('.modal').remove()"></button>
                    </div>
                    <div class="modal-body text-center">
                        <p>ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ ÑÑ‚Ð¾Ñ‚ QR-ÐºÐ¾Ð´ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ:</p>
                        <div id="qrCodeContainer"></div>
                        <p class="mt-2">Ð˜Ð»Ð¸ Ð¿Ð¾Ð´ÐµÐ»Ð¸Ñ‚ÐµÑÑŒ ÑÑÑ‹Ð»ÐºÐ¾Ð¹: <code>${inviteUrl}</code></p>
                    </div>
                </div>
            </div>
        </div>`;
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    const modalElement = document.querySelector('.modal.show');
    new QRCode(document.getElementById('qrCodeContainer'), { text: inviteUrl, width: 200, height: 200 });
    modalElement.querySelector('.btn-close').addEventListener('click', () => modalElement.remove());
}

```

### web\js\tasks.js

```js```
// web/js/tasks.js
// import { getTasks, getProjectTasks, updateTaskStatus } from './api.js'; // Ð•ÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ES6 modules

let currentTaskId = null;
let currentTaskDetails = null;
let taskSearchFuse = null;

async function loadTasks(status = null) {
    if (!currentUserId) {
        document.getElementById('tasks-list').innerHTML = `
            <div class="max-card text-center">
                <i class="fas fa-tasks fa-2x text-muted mb-3"></i>
                <h6>ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ</h6>
                <p class="text-muted">Ð”Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð·Ð°Ð´Ð°Ñ‡ Ð²Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ</p>
            </div>`;
        return;
    }
    const token = localStorage.getItem('access_token');
    try {
        const data = await getTasks(currentUserId, token); // ÐŸÑ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ getTasks Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð° Ð² api.js Ð¸Ð»Ð¸ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°
        const tasks = data.tasks || [];

        // Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾ ÑÑ‚Ð°Ñ‚ÑƒÑÑƒ
        const filteredTasks = status ? tasks.filter(t => t.status === status) : tasks;

        const container = document.getElementById('tasks-list');
        if (filteredTasks.length === 0) {
            container.innerHTML = `
                <div class="max-card text-center">
                    <i class="fas fa-tasks fa-2x text-muted mb-3"></i>
                    <h6>Ð—Ð°Ð´Ð°Ñ‡ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚</h6>
                    <p class="text-muted">Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¿ÐµÑ€Ð²ÑƒÑŽ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ!</p>
                </div>`;
            return;
        }

        container.innerHTML = filteredTasks.map(task => {
            const statusColor = getStatusColor(task.status); // ÐŸÑ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð° Ð² main.js Ð¸Ð»Ð¸ utils.js
            const statusText = getStatusText(task.status); // ÐŸÑ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð° Ð² main.js Ð¸Ð»Ð¸ utils.js
            return `
                <div class="task-item task-${task.status} max-card" onclick="openTaskModal(${task.id})">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="flex-grow-1">
                            <h6 class="mb-0">${task.title}</h6>
                            <p class="text-muted small mb-1">${task.description ? task.description.substring(0, 50) + '...' : ''}</p>
                            <div class="d-flex align-items-center">
                                <span class="badge bg-${statusColor} me-2">${statusText}</span>
                                <span class="text-muted small">${formatDate(task.created_at)}</span>
                            </div>
                        </div>
                        <div class="text-end">
                            <div class="text-muted small">ÐŸÑ€Ð¾ÐµÐºÑ‚: ${task.project.title}</div>
                            <div class="text-muted small">ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚: ${task.priority}</div>
                        </div>
                    </div>
                </div>`;
        }).join('');

        // Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð¸ÑÐºÐ°
        taskSearchFuse = new Fuse(tasks, {
            keys: ['title', 'description'],
            threshold: 0.3
        });

    } catch (error) {
        console.error('Tasks load error:', error);
        document.getElementById('tasks-list').innerHTML = `
            <div class="max-card text-center">
                <i class="fas fa-exclamation-triangle fa-2x text-muted mb-3"></i>
                <h6>ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸</h6>
                <p class="text-muted">ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸</p>
            </div>`;
    }
}

function openTaskModal(taskId) {
    currentTaskId = taskId;
    // Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð¸ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÐ½Ð°
    // ÐŸÐ¾ÐºÐ° ÑƒÐ¿Ñ€Ð¾Ñ‰Ñ‘Ð½Ð½Ð¾
    const token = localStorage.getItem('access_token');
    fetch(`${API_BASE_URL}/tasks/${taskId}`, {
        headers: { 'Authorization': `Bearer ${token}` }
    })
    .then(response => response.json())
    .then(data => {
        currentTaskDetails = data.task;
        document.getElementById('taskModalTitle').textContent = data.task.title;
        document.getElementById('taskModalProjectTitle').textContent = data.task.project.title;
        document.getElementById('taskModalDescription').textContent = data.task.description || '';
        document.getElementById('taskModalStatus').value = data.task.status;

        // Ð—Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ assignees
        const assigneeSelect = document.getElementById('taskModalAssignees');
        assigneeSelect.innerHTML = '';
        data.task.project.members.forEach(member => {
            const option = document.createElement('option');
            option.value = member.user_id;
            option.textContent = member.user.full_name;
            if (data.task.assigned_to_id === member.user_id) option.selected = true;
            assigneeSelect.appendChild(option);
        });

        // Ð—Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð´Ð·Ð°Ð´Ð°Ñ‡
        const subtasksContainer = document.getElementById('taskModalSubtasks');
        subtasksContainer.innerHTML = data.task.subtasks ? data.task.subtasks.map(st => `
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="subtask${st.id}" ${st.status === 'done' ? 'checked' : ''} disabled>
                <label class="form-check-label" for="subtask${st.id}">${st.title}</label>
            </div>
        `).join('') : '';

        // Ð—Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸ÐµÐ²
        const commentsContainer = document.getElementById('taskModalComments');
        commentsContainer.innerHTML = data.task.comments ? data.task.comments.map(c => `
            <div class="comment-item mb-2">
                <strong>${c.user.full_name}</strong> <small class="text-muted">${formatDate(c.created_at)}</small>
                <p class="mb-1">${escapeHTML(c.content)}</p>
            </div>
        `).join('') : '';

        // Ð—Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð²
        const filesContainer = document.getElementById('taskModalFiles');
        filesContainer.innerHTML = data.task.attachments ? data.task.attachments.map(att => `
            <a href="${att.url}" target="_blank">${att.filename}</a>
        `).join('<br>') : 'ÐÐµÑ‚ Ð¿Ñ€Ð¸ÐºÑ€ÐµÐ¿Ð»Ñ‘Ð½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²';

        const modal = new bootstrap.Modal(document.getElementById('taskModal'));
        modal.show();
    })
    .catch(err => console.error('Error loading task details:', err));
}

function updateTask() {
    if (!currentUserId || !currentTaskId) return;
    const token = localStorage.getItem('access_token');
    const newStatus = document.getElementById('taskModalStatus').value;
    updateTaskStatus(currentTaskId, newStatus, token) // ÐŸÑ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ updateTaskStatus Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð° Ð² api.js Ð¸Ð»Ð¸ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°
        .then(() => {
            alert('Ð—Ð°Ð´Ð°Ñ‡Ð° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð°!');
            const modal = bootstrap.Modal.getInstance(document.getElementById('taskModal'));
            modal.hide();
            if (currentSection === 'tasks') {
                loadTasks(); // ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸
            }
        })
        .catch(err => {
            console.error('Update task error:', err);
            alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð·Ð°Ð´Ð°Ñ‡Ð¸');
        });
}

function debounceSaveTaskDescription() {
    debounce(async () => { // ÐŸÑ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ debounce Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð° Ð² main.js Ð¸Ð»Ð¸ utils.js
        if (!currentTaskId) return;
        const newDesc = document.getElementById('taskModalDescription').textContent;
        // Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ PUT Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð´Ð»Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ
        // PUT /api/tasks/{id}/description
        // console.log('Saving description for task', currentTaskId, ':', newDesc);
    }, 500)();
}

function addSubtask() {
    const title = prompt('Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð¸:');
    if (title) {
        // Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ POST Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¿Ð¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð¸
        // POST /api/tasks/
        // console.log('Adding subtask:', title, 'to task', currentTaskId);
    }
}

function addComment() {
    const text = document.getElementById('newCommentText').value.trim();
    if (!text) return;
    // Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ POST Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ñ
    // POST /api/tasks/{id}/comments
    // console.log('Adding comment:', text, 'to task', currentTaskId);
    document.getElementById('newCommentText').value = '';
}

function searchTasks() {
    const query = document.getElementById('searchTasksInput').value;
    if (!taskSearchFuse || !query) {
        loadTasks(); // ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð·Ð°Ð´Ð°Ñ‡Ð¸, ÐµÑÐ»Ð¸ Ð½ÐµÑ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
        return;
    }
    const results = taskSearchFuse.search(query);
    const container = document.getElementById('tasks-list');
    if (results.length === 0) {
        container.innerHTML = '<p class="text-muted">Ð—Ð°Ð´Ð°Ñ‡Ð¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹.</p>';
        return;
    }
    container.innerHTML = results.map(result => {
        const task = result.item;
        const statusColor = getStatusColor(task.status); // ÐŸÑ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð° Ð² main.js Ð¸Ð»Ð¸ utils.js
        const statusText = getStatusText(task.status); // ÐŸÑ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð° Ð² main.js Ð¸Ð»Ð¸ utils.js
        return `
            <div class="task-item task-${task.status} max-card" onclick="openTaskModal(${task.id})">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="mb-0">${task.title}</h6>
                        <p class="text-muted small mb-1">${task.description ? task.description.substring(0, 50) + '...' : ''}</p>
                        <div class="d-flex align-items-center">
                            <span class="badge bg-${statusColor} me-2">${statusText}</span>
                            <span class="text-muted small">${formatDate(task.created_at)}</span>
                        </div>
                    </div>
                    <div class="text-end">
                        <div class="text-muted small">ÐŸÑ€Ð¾ÐµÐºÑ‚: ${task.project.title}</div>
                        <div class="text-muted small">ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚: ${task.priority}</div>
                    </div>
                </div>
            </div>`;
    }).join('');
}

```

